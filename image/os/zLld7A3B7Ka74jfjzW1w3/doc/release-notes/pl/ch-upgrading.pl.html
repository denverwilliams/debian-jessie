<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Rozdział 4. Aktualizacja z Debiana 7 (wheezy)</title><link rel="stylesheet" type="text/css" href="debian.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.pl.html" title="Uwagi do wydania, do dystrybucji Debian 8 (jessie), 64-bitowe PC" /><link rel="up" href="index.pl.html" title="Uwagi do wydania, do dystrybucji Debian 8 (jessie), 64-bitowe PC" /><link rel="prev" href="ch-installing.pl.html" title="Rozdział 3. System instalacyjny" /><link rel="next" href="ch-information.pl.html" title="Rozdział 5. Problemy, które należy mieć na uwadze, a dotyczące wydania jessie" /><meta xmlns="" name="viewport" content="width=device-width, initial-scale=1" /><style xmlns="" type="text/css">
      body {
        background-repeat: no-repeat;
        background-image: none;
      }
    </style></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Rozdział 4. Aktualizacja z Debiana 7 (wheezy)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch-installing.pl.html"><img src="images/prev.png" alt="Poprzedni" /></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch-information.pl.html"><img src="images/next.png" alt="Następny" /></a></td></tr></table><hr /></div><div xml:lang="pl" class="chapter" lang="pl"><div class="titlepage"><div><div><h1 class="title"><a id="ch-upgrading"></a>Rozdział 4. Aktualizacja z Debiana 7 (wheezy)</h1></div></div></div><div class="toc"><p><strong>Spis treści</strong></p><dl class="toc"><dt><span class="section"><a href="ch-upgrading.pl.html#backup">4.1. Przygotowanie do aktualizacji</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#data-backup">4.1.1. Kopia zapasowa danych i konfiguracji</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#inform-users">4.1.2. Uprzednie ostrzeżenie użytkowników</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#services-downtime">4.1.3. Przygotowanie do przestoju usług</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#recovery">4.1.4. Przygotowanie do odzyskiwania</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#upgrade-preparations">4.1.5. Przygotowanie bezpiecznego środowiska do uaktualnienia</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.pl.html#system-status">4.2. Sprawdzenie statusu systemu</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#review-actions">4.2.1. Przejrzenie zaplanowanych działań w menedżerze pakietów</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#disable-apt-pinning">4.2.2. Wyłączenie priorytetów APT-a (APT pinning)</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#package-status">4.2.3. Sprawdzenie statusu pakietów</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#proposed-updates">4.2.4. Sekcja proposed-updates</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#unofficial-sources">4.2.5. Nieoficjalne źródła</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.pl.html#upgrade-process">4.3. Przygotowanie źródeł do APT-a</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#network">4.3.1. Dodanie internetowych źródeł APT-a</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#localmirror">4.3.2. Dodanie źródeł APT-a do lokalnego serwera lustrzanego</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#cdroms">4.3.3. Dodanie źródeł APT-a do nośników optycznych</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.pl.html#upgradingpackages">4.4. Aktualizacja pakietów</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#record-session">4.4.1. Zapisanie sesji</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#updating-lists">4.4.2. Aktualizowanie listy pakietów</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#sufficient-space">4.4.3. Zapewnienie wystarczającej ilości wolnego miejsca </a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#minimal-upgrade">4.4.4. Minimalna aktualizacja systemu</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#upgrading-full">4.4.5. Aktualizacja systemu</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.pl.html#trouble">4.5. Możliwe problemy przy aktualizacji</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#immediate-configure">4.5.1. Podczas aktualizacji dystrybucji pojawia się błąd <span class="quote">„<span class="quote">Nie udało się
wykonać natychmiastowej konfiguracji</span>”</span>.</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#expected-removals">4.5.2. Spodziewane usunięcia pakietów</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#conflicts-loops">4.5.3. Konflikty lub pętle <span class="quote">„<span class="quote">wymaga wstępnie</span>”</span></a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#file-conflicts">4.5.4. Konflikty plików</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#configuration-changes">4.5.5. Zmiany konfiguracji</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#console-change">4.5.6. Zmiany sesji na konsoli</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#package-specific-issues">4.5.7. Pakiety specjalnej troski</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.pl.html#newkernel">4.6. Aktualizacja jądra i powiązanych pakietów</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#kernel-metapackage">4.6.1. Instalowanie metapakietu jądra</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#initramfs-tools-issues">4.6.2. Zmiany w montowaniu i sprawdzaniu systemu plików <code class="filename">/usr</code></a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.pl.html#nownownow">4.7. Sprawy do zrobienia przed ponownym uruchomieniem</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#for-next">4.8. Przygotowanie do kolejnego wydania</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#purge-removed-packages">4.8.1. Czyszczenie usuniętych pakietów</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.pl.html#deprecated">4.9. Przestarzałe składniki</a></span></dt><dt><span class="section"><a href="ch-upgrading.pl.html#obsolete">4.10. Przestarzałe pakiety</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.pl.html#dummy">4.10.1. Pakiety atrapy</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="backup"></a>4.1. Przygotowanie do aktualizacji</h2></div></div></div><p>
Przed aktualizacją zalecamy zapoznanie się z informacjami zawartymi w <a class="xref" href="ch-information.pl.html" title="Rozdział 5. Problemy, które należy mieć na uwadze, a dotyczące wydania jessie">Rozdział 5, <em>Problemy, które należy mieć na uwadze, a dotyczące wydania jessie</em></a>.  Rozdział ten opisuje również potencjalne
trudności, niezwiązane bezpośrednio z procesem aktualizacji, o których warto
wiedzieć przed rozpoczęciem całej procedury.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="data-backup"></a>4.1.1. Kopia zapasowa danych i konfiguracji</h3></div></div></div><p>
Przed zaktualizowaniem systemu zalecamy wykonanie pełnej kopii zapasowej, a
przynajmniej kopii tych danych i konfiguracji, których utrata byłaby dla nas
bolesna. Narzędzia i proces aktualizacji są dość niezawodne, lecz problem
sprzętowy w trakcie procedury może spowodować znaczne uszkodzenie systemu.
</p><p>
Główną rzeczą, którą warto skopiować jest zawartość plików
<code class="filename">/etc</code>, <code class="filename">/var/lib/dpkg</code>,
<code class="filename">/var/lib/apt/extended_states</code> oraz wynik polecenia
<code class="literal">dpkg --get-selections "*"</code> (cudzysłów jest istotny). Jeśli
do zarządzania pakietami wykorzystuje się program
<span class="command"><strong>aptitude</strong></span>, należy zachować również zawartość pliku
<code class="filename">/var/lib/aptitude/pkgstates</code>.
</p><p>
Sam proces aktualizacji nie zmienia niczego w katalogu
<code class="filename">/home</code>. Niektóre aplikacje (np. część zestawu Mozilla
oraz środowiska graficzne GNOME i KDE) nadpisują istniejące ustawienia
użytkownika wartościami domyślnymi, gdy użytkownik uruchamia dany program
jako pierwszy. Środkiem ostrożności jest wykonanie kopii zapasowych ukrytych
plików i katalogów (z kropką - <span class="quote">„<span class="quote">dotfiles</span>”</span>) z katalogów domowych
użytkowników. Ta kopia może ułatwić odtworzenie lub przywrócenie starych
ustawień. Powinno się również poinformować o tym pozostałych użytkowników.
</p><p>
Operacja związana z instalacją pakietów musi być wykonana z uprawnieniami
administratora, dlatego należy się zalogować na konto
<code class="literal">root</code>, używając polecenia <span class="command"><strong>su</strong></span> lub
wykorzystując <span class="command"><strong>sudo</strong></span> do uzyskania potrzebnych uprawnień.
</p><p>
Przed aktualizacją należy wykonać kilka czynności, dlatego trzeba zapoznać
się z poniższą listą:
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="inform-users"></a>4.1.2. Uprzednie ostrzeżenie użytkowników</h3></div></div></div><p>
Przed każdą aktualizacją powinno się poinformować innych użytkowników
systemu o tym fakcie, choć osoby uzyskujące dostęp do komputera za pomocą
<span class="command"><strong>ssh</strong></span> nie powinny napotkać większych problemów podczas
kontynuowania pracy. 
</p><p>
Jako dodatkowe zabezpieczenie można wykonać przed wykonaniem aktualizacji
kopię zapasową lub odmontować partycję z katalogiem
<code class="filename">/home</code>.
</p><p>
Przy aktualizacji do wydania jessie konieczne jest zaktualizowanie
jądra. Nie obędzie się więc bez ponownego uruchomienia komputera. Zwykle
odbywa się to po zakończeniu aktualizacji.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="services-downtime"></a>4.1.3. Przygotowanie do przestoju usług</h3></div></div></div><p>
Mogą istnieć usługi oferowane przez system, które są związane z pakietami
objętymi aktualizacją. W takim przypadku proszę pamiętać, że podczas
aktualizacji i konfiguracji będą one zatrzymane na czas zastąpienia ich
przez nowszą wersję oraz nie będą w tym czasie dostępne.
</p><p>
Dokładny czas braku dostępu do usług zależy od liczby aktualizowanych
pakietów i od okresu, w jakim administrator odpowie na pytania
konfiguracyjne. Proszę zwrócić uwagę, że jeśli proces aktualizacji nie
będzie nadzorowany, a system będzie wymagał reakcji administratora,
występuje duże prawdopodobieństwo trwania usług niedostępnych<a href="#ftn.idp44963568" class="footnote" id="idp44963568"><sup class="footnote">[1]</sup></a> w dłuższym okresie.
</p><p>
Jeśli aktualizowany system udostępnia usługi, które są krytyczne dla
użytkowników bądź sieci<a href="#ftn.idp44965248" class="footnote" id="idp44965248"><sup class="footnote">[2]</sup></a>, można
ograniczyć przerwę w ich działaniu wykonując aktualizację minimalną (zgodnie
z opisem w <a class="xref" href="ch-upgrading.pl.html#minimal-upgrade" title="4.4.4. Minimalna aktualizacja systemu">Sekcja 4.4.4, „Minimalna aktualizacja systemu”</a>) a następnie wykonać
aktualizację jądra i ponownie uruchomić komputer (aktualizując pakiety
związane z krytycznymi usługami). Dopiero później należy wykonać pełną
aktualizację opisaną w <a class="xref" href="ch-upgrading.pl.html#upgrading-full" title="4.4.5. Aktualizacja systemu">Sekcja 4.4.5, „Aktualizacja systemu”</a>.  W ten sposób można
sprawdzić, że krytyczne usługi działają i są dostępne w trakcie pełnej
aktualizacji, a przerwa w działaniu będzie zminimalizowana.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="recovery"></a>4.1.4. Przygotowanie do odzyskiwania</h3></div></div></div><p>
Choć Debian stara się zapewnić, że system będzie się uruchomiał w każdym
przypadku to zawsze istnieje możliwość, że wystąpią problemy z ponownym jego
uruchomieniem po dokonaniu aktualizacji. Rozpoznane, ewentualne problemy są
omówione w tym i kolejnych rozdziałach uwag do wydania.
</p><p>
Z tego względu należy się upewnić, że będzie istniała możliwość odzyskania
systemu jeśli nie uruchomi się on po aktualizacji (lub w przypadku systemów
zarządzanych zdalnie nie zaktywuje sieci).
</p><p>
W przypadku aktualizacji zdalnej za pomocą <span class="command"><strong>ssh</strong></span>, zaleca
się dodatkowe środki bezpieczeństwa, w celu zapewnienia sobie możliwości
dostępu do serwera za pomocą zdalnego terminala szeregowego. Istnieje
ryzyko, że po aktualizacji jądra i ponownym uruchomieniu systemu  wystąpi
konieczność poprawienia konfiguracji systemu korzystając z konsoli
lokalnej. Jeśli w trakcie aktualizacji system zostanie przypadkowo
zresetowany, możliwe że konieczne będzie odzyskiwanie za pomocą lokalnej
konsoli.
</p><p>
Zalecamy korzystanie z <span class="emphasis"><em>trybu ratunkowego</em></span> w instalatorze
Debiana jessie. Zaletą skorzystania z instalatora jest możliwość
wyboru takiej metody jaka jest najkorzystniejsza. Więcej informacji zawiera
<span class="quote">„<span class="quote">Recovering a Broken System</span>”</span> w rozdziale 8 <a class="ulink" href="https://www.debian.org/releases/jessie/installmanual" target="_top">przewodnika instalacji</a> i <a class="ulink" href="https://wiki.debian.org/DebianInstaller/FAQ" target="_top">FAQ instalatora Debiana</a>.
</p><p>
Jeśli ten sposób zawiedzie konieczne jest zapewnienie sobie alternatywnego
sposobu rozruchu systemu, by móc go naprawić. Rozwiązaniem może okazać się
specjalny obraz ratunkowy lub płyta typu live CD. Po uruchomieniu systemu za
pomocą jednej z tych metod powinno się udać podmontować główny system
plików, a następnie wykonać <code class="literal">chroot</code> w celu rozpoznania i
naprawy problemu.
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="recovery-initrd"></a>4.1.4.1. Debugowanie powłoki podczas rozruchu przy użyciu initrd</h4></div></div></div><p>
Pakiet <code class="systemitem">initramfs-tools</code><a id="idp44987920" class="indexterm"></a> udostępnia
powłokę debugowania<a href="#ftn.idp44988688" class="footnote" id="idp44988688"><sup class="footnote">[3]</sup></a> w generowanych
obrazach initrd. Na przykład: jeśli initrd nie będzie mógł zamontować
głównego systemu plików to przeniesie się do powłoki debugowania z
dostępnymi podstawowymi poleceniami, aby dać możliwość znalezienia problemu
i naprawy.
</p><p>
Podstawowymi sprawami do sprawdzenia są: obecność poprawnych plików urządzeń
w <code class="filename">/dev</code>; które moduły są załadowane (<code class="literal">cat
/proc/modules</code>); wynik <span class="command"><strong>dmesg</strong></span> pod kątem błędów
ładowania sterowników. Wynik <span class="command"><strong>dmesg</strong></span> pokaże również jakie
pliki urządzeń zostały przypisane do danych dysków; powinno się je sprawdzić
z wynikiem <code class="literal">echo $ROOT</code>, aby upewnić się, że główny system
plików znajduje się na oczekiwanym urządzeniu.
</p><p>
Jeśli problem się rozwiąże to polecenie <code class="literal">exit</code> zamknie
powłokę debugowania i proces debugowania będzie kontynuowany od momentu
wystąpienia błędu. Oczywiście, konieczne będzie naprawienie źródła problemu
i ponowne wygenerowanie initrd, aby przy następnym rozruchu nie znaleźć się
w identycznej sytuacji.
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="recovery-shell-systemd"></a>4.1.4.2. Debugowanie powłoki podczas rozruchu przy użyciu systemd</h4></div></div></div><p>
    Jeśli rozruch nie powiedzie się korzystając z systemd, można dostać się do
powłoki roota służącej do debugowania zmieniając wiersz polecenia
jądra. Jeśli podstawowy rozruch uda się, lecz część usług nie wystartuje,
można spróbować dodać do parametrów jądra
<code class="literal">systemd.unit=rescue.target</code>.
  </p><p>
    Z kolei parametr jądra <code class="literal">systemd.unit=emergency.target</code>
udostępni powłokę roota najwcześniej jak to możliwe. Będzie to jednak
jeszcze przed zamontowaniem głównego systemu plików z uprawnieniami do
odczytu i zapisu. Zajdzie konieczność ręcznego wykonania:
  </p><pre class="screen">
mount -o remount,rw /
</pre><p>
    Więcej informacji o debugowaniu rozruchu kończącego się niepowodzeniem za
pomocą systemd można znaleźć w artykule <a class="ulink" href="http://freedesktop.org/wiki/Software/systemd/Debugging/" target="_top"> Diagnosing
Boot Problems</a>.
  </p><p>
    W najgorszym scenariuszu może zajść konieczność dokonania rozruchu ze pomocą
starego systemu sysvinit. Aby to uczynić pakiet <code class="systemitem">sysvinit</code><a id="idp45004496" class="indexterm"></a> musi być wciąż zainstalowany, a plik
binarny <code class="filename">/lib/sysvinit/init</code> zawarty w initramfs. Jeśli
te wymagania są spełnione, należy dodać
<code class="literal">init=/lib/sysvinit/init</code> do wiersza polecenia jądra, co
spowoduje rozruch z wykorzystaniem pliku binarnego sysvinit.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="upgrade-preparations"></a>4.1.5. Przygotowanie bezpiecznego środowiska do uaktualnienia</h3></div></div></div><p>
Aktualizacja dystrybucji może być wykonana lokalnie, z trybu tekstowego
wirtualnej konsoli (lub przez bezpośrednio połączony terminal szeregowy)
bądź zdalnie, za pomocą <span class="command"><strong>ssh</strong></span>. 
</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Ważne]" src="images/important.png" /></td><th align="left">Ważne</th></tr><tr><td align="left" valign="top"><p>
  Jeśli korzysta się z usług VPN (takich jak <code class="systemitem">tinc</code><a id="idp45011120" class="indexterm"></a>) to mogą one nie być dostępne w czasie
aktualizacji. Proszę zapoznać się z <a class="xref" href="ch-upgrading.pl.html#services-downtime" title="4.1.3. Przygotowanie do przestoju usług">Sekcja 4.1.3, „Przygotowanie do przestoju usług”</a>.
  </p></td></tr></table></div><p>
Aby zapewnić sobie większy margines bezpieczeństwa podczas aktualizacji
zdalnej sugeruje się uruchomić proces aktualizacji w wirtualnej konsoli
(zapewnionej przez program <span class="command"><strong>screen</strong></span>, który pozwala na
bezpieczne ponowne podłączenie oraz zapewnia trwałość procesu aktualizacji,
nawet przy zerwaniu połączenia).
</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Ważne]" src="images/important.png" /></td><th align="left">Ważne</th></tr><tr><td align="left" valign="top"><p>
    <span class="emphasis"><em>Nie</em></span> należy wykonywać aktualizacji przy użyciu
<span class="command"><strong>telnet</strong></span>, <span class="command"><strong>rlogin</strong></span>, <span class="command"><strong>rsh</strong></span>
lub z sesji X zarządzanej przez <span class="command"><strong>xdm</strong></span>,
<span class="command"><strong>gdm</strong></span>, <span class="command"><strong>kdm</strong></span>, itp. na aktualizowanym
komputerze. Każda z tych usług może zostać przerwana podczas aktualizacji co
może skutkować <span class="emphasis"><em>niedostępnym</em></span> systemem, uaktualnionym
jedynie częściowo. Używanie programu GNOME <span class="command"><strong>update-manager</strong></span>
jest <span class="emphasis"><em>zdecydowanie odradzane</em></span> przy aktualizacji do
obecnego wydania, ponieważ narzędzie to wymaga, aby sesja pulpitu
pozostawała aktywna.
  </p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="system-status"></a>4.2. Sprawdzenie statusu systemu</h2></div></div></div><p>
Proces aktualizacji opisany w tym rozdziale został opracowany dla
aktualizacji z <span class="quote">„<span class="quote">czystego</span>”</span> wydania wheezy bez pakietów
pochodzących z zewnątrz. Aby zwiększyć niezawodność aktualizacji można
usunąć takie pakiety przed rozpoczęciem procesu.
</p><p>
Bezpośrednie aktualizacje z wydań Debiana starszych od 7
(wheezy) nie są wspierane. Proszę zapoznać się z instrukcjami w
<a class="ulink" href="https://www.debian.org/releases/wheezy/releasenotes" target="_top">Uwagach
do wydania Debian 7</a>, aby wykonać wpierw aktualizację do
wydania 7.
</p><p>
Procedura ta zakłada, że system został zaktualizowany do ostatniej
aktualizacji punktowej wheezy. Jeśli się tego nie wykonało lub nie
jest się tego pewnym należy wykonać instrukcje z <a class="xref" href="ap-old-stuff.pl.html#old-upgrade" title="A.1. Uaktualnienie wydania wheezy">Sekcja A.1, „Uaktualnienie wydania wheezy”</a>.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="review-actions"></a>4.2.1. Przejrzenie zaplanowanych działań w menedżerze pakietów</h3></div></div></div><p>
Niekiedy użycie do instalowania pakietów <span class="command"><strong>apt-get</strong></span> zamiast
<span class="command"><strong>aptitude</strong></span> może spowodować, że <span class="command"><strong>aptitude</strong></span>
potraktuje je jako <span class="quote">„<span class="quote">nieużywane</span>”</span> i przeznaczy do usunięcia. Z
reguły należy się upewnić, że system jest całkowicie uaktualniony i
<span class="quote">„<span class="quote">czysty</span>”</span> przed rozpoczęciem procesu aktualizacji.
</p><p>
Z tego powodu należy sprawdzić czy nie ma zaplanowanych działań w menedżerze
pakietów <span class="command"><strong>aptitude</strong></span>. Jeśli jakiś pakiet jest przeznaczony
do usunięcia lub aktualizacji może to negatywnie wpłynąć na przebieg
aktualizacji. Proszę zauważyć, że naprawienie tego problemu będzie możliwe
tylko wówczas, gdy <code class="filename">sources.list</code> wciąż wskazuje na
wydanie <span class="emphasis"><em>wheezy</em></span>, a nie na
<span class="emphasis"><em>stable</em></span> lub <span class="emphasis"><em>jessie</em></span> - patrz
<a class="xref" href="ap-old-stuff.pl.html#old-sources" title="A.2. Sprawdzenie listy źródeł">Sekcja A.2, „Sprawdzenie listy źródeł”</a>.
</p><p>
Sprawdzenie polega na uruchomieniu <span class="command"><strong>aptitude</strong></span> w
<span class="quote">„<span class="quote">trybie wizualnym</span>”</span> i wciśnięciu <span class="keycap"><strong>g</strong></span>
(<span class="quote">„<span class="quote">pobierz/instaluj/usuń</span>”</span>). Jeśli pokazane zostaną jakieś akcje
należy je przejrzeć i albo poprawić, albo wykonać. Jeśli nie będzie
sugerowanych akcji zostanie wyświetlony komunikat: <span class="quote">„<span class="quote">Nie jest
zaplanowana instalacja, aktualizacja, ani usunięcie żadnych
pakietów</span>”</span>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="disable-apt-pinning"></a>4.2.2. Wyłączenie priorytetów APT-a (APT pinning)</h3></div></div></div><p>
Jeśli skonfigurowano APT w celu instalacji konkretnych pakietów z
dystrybucji innej niż stabilna (np. testowej), konieczna może okazać się
zmiana konfiguracji priorytetów APT-a (przechowywanej w
<code class="filename">/etc/apt/preferences</code> i
<code class="filename">/etc/apt/preferences.d/</code>), aby zezwolić na aktualizację
pakietów do wersji nowego wydania stabilnego. Więcej informacji na ten temat
można znaleźć w podręczniku systemowym <span class="citerefentry"><span class="refentrytitle">apt_preferences</span>(5)</span>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="package-status"></a>4.2.3. Sprawdzenie statusu pakietów</h3></div></div></div><p>
Niezależnie od wybranej metody aktualizacji zaleca się uprzednie sprawdzenie
wszystkich pakietów i zweryfikowanie czy wszystkie nadają się do
aktualizacji. Następujące polecenie pokaże pakiety o statusie
<span class="quote">„<span class="quote">częściowo zainstalowany</span>”</span> lub <span class="quote">„<span class="quote">nieprawidłowa
konfiguracja</span>”</span> i te z jakimkolwiek statusem błędu:
</p><pre class="screen">
# dpkg --audit
</pre><p>
Można również sprawdzić stan wszystkich pakietów za pomocą
<span class="command"><strong>aptitude</strong></span> lub np.:
</p><pre class="screen">
# dpkg -l | pager
</pre><p>
albo:
</p><pre class="screen">
# dpkg --get-selections "*" &gt; ~/curr-pkgs.txt
</pre><p>
Pożądane może okazać się usunięcie wszelkich zatrzymań z pakietów. Jeśli
jakikolwiek aktualizowany pakiet o statusie <span class="quote">„<span class="quote">istotny</span>”</span> będzie
zatrzymany to aktualizacja nie powiedzie się.
</p><p>
Proszę zauważyć, że <span class="command"><strong>aptitude</strong></span> używa innej metody
rejestrowania zatrzymanych pakietów niż <span class="command"><strong>apt-get</strong></span> i
<span class="command"><strong>dselect</strong></span>. Pakiety zatrzymane w <span class="command"><strong>aptitude</strong></span>
można sprawdzić za pomocą polecenia:
</p><pre class="screen">
# aptitude search "~ahold" 
</pre><p>
Pakiety zatrzymane w <span class="command"><strong>apt-get</strong></span> można sprawdzić korzystając
z:
</p><pre class="screen">
# dpkg --get-selections | grep 'hold$'
</pre><p>
Jeśli zmieniono jakiś pakiet lub ponownie skompilowano go lokalnie bez
zmiany nazwy ani dodania epoki do nazwy, konieczne będzie zatrzymanie go,
aby zapobiec uaktualnieniu.
</p><p>
Stan <span class="quote">„<span class="quote">zatrzymania</span>”</span> pakietu w <span class="command"><strong>apt-get</strong></span> można
zmienić za pomocą:
</p><pre class="screen">
# echo <em class="replaceable"><code>package_name</code></em> hold | dpkg --set-selections
</pre><p>
Proszę zastąpić <code class="literal">hold</code> słowem <code class="literal">install</code>
aby cofnąć <span class="quote">„<span class="quote">zatrzymanie</span>”</span> pakietu.
</p><p>
Jeśli sygnalizowana jest potrzeba poprawy najlepiej jest upewnić się, że
lista <code class="filename">sources.list</code> wciąż odnosi się do wydania
wheezy, zgodnie z opisem <a class="xref" href="ap-old-stuff.pl.html#old-sources" title="A.2. Sprawdzenie listy źródeł">Sekcja A.2, „Sprawdzenie listy źródeł”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proposed-updates"></a>4.2.4. Sekcja proposed-updates</h3></div></div></div><p>
    Jeśli w pliku <code class="filename">/etc/apt/sources.list</code> znajduje się sekcja
<code class="literal">proposed-updates</code> należy usunąć ją przed rozpoczęciem
aktualizacji systemu. Jest to środek ostrożności zmniejszający
prawdopodobieństwo konfliktów.
  </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="unofficial-sources"></a>4.2.5. Nieoficjalne źródła</h3></div></div></div><p>
Jeśli zainstalowano pakiety pochodzące spoza Debiana należy pamiętać, że
mogą one zostać usunięte podczas aktualizacji z powodu konfliktów w
zależnościach. Jeśli pakiety zostały zainstalowane przez dodanie dodatkowego
archiwum pakietów w <code class="filename">/etc/apt/sources.list</code> należy
sprawdzić czy nie oferuje ono pakietów skompilowanych dla wydania
jessie. Wówczas należy odpowiednio zmienić wiersz dotyczący tego
archiwum we wspomnianym pliku, w tym samym czasie co pozostałe wiersze
związane z pakietami Debiana.
</p><p>
Część użytkowników może posiadać <span class="emphasis"><em>nieoficjalne</em></span>,
backportowane wersje pakietów, które są <span class="quote">„<span class="quote">nowsze</span>”</span> niż pakiety
<span class="emphasis"><em>zainstalowane</em></span> w Debianie wheezy. Te pakiety
będą prawdopodobnie sprawiać kłopoty z powodu konfliktów plików<a href="#ftn.idp45075040" class="footnote" id="idp45075040"><sup class="footnote">[4]</sup></a>.  <a class="xref" href="ch-upgrading.pl.html#trouble" title="4.5. Możliwe problemy przy aktualizacji">Sekcja 4.5, „Możliwe problemy przy aktualizacji”</a> opisuje sposoby
rozwiązywania konfliktów plików.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="upgrade-process"></a>4.3. Przygotowanie źródeł do APT-a</h2></div></div></div><p>
Przed rozpoczęciem aktualizacji należy przygotować plik konfiguracyjny
<code class="systemitem">apt</code><a id="idp45079360" class="indexterm"></a> z listami pakietów -
<code class="filename">/etc/apt/sources.list</code>.
</p><p>
<code class="systemitem">apt</code><a id="idp45082096" class="indexterm"></a> weźmie pod uwagę wszystkie
pakiety oznaczone za pomocą wpisu <span class="quote">„<span class="quote"><code class="literal">deb</code></span>”</span> i
zainstaluje pakiety o najwyższym numerze wersji, dając priorytet
wcześniejszym wierszom w pliku (stąd, jeśli wymieniono kilka położeń powinno
się zwykle jako pierwszy umieścić lokalny dysk twardy, następnie
<acronym title="Compact Disc Read Only Memory">CD-ROM</acronym>-y, a na końcu serwery lustrzane HTTP/FTP).
</p><p>
Wydanie można określić dzięki nazwie kodowej
(np. <code class="literal">wheezy</code>, <code class="literal">jessie</code>)
lub statusowi wydania (<code class="literal">oldstable</code> - stare stabilne,
<code class="literal">stable</code> - stabilne, <code class="literal">testing</code> - testowe,
<code class="literal">unstable</code> - niestabilne). Zapis odnoszący się do nazwy
kodowej ma tę zaletę, że użytkownik nie zostanie nigdy zaskoczony nowym
wydaniem. Z tego powodu to rozwiązanie jest preferowane w niniejszym
dokumencie. Z drugiej strony, powoduje to konieczność samodzielnego
sprawdzania czy nie wydano nowej wersji systemu. Jeśli użyje się nazwy
statusu pokaże się wówczas bardzo dużo dostępnych aktualizacji pakietów.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="network"></a>4.3.1. Dodanie internetowych źródeł APT-a</h3></div></div></div><p>
Domyślna konfiguracja jest przeznaczona do instalacji z głównych serwerów
internetowych Debiana, ale można zmodyfikować plik
<code class="filename">/etc/apt/sources.list</code> w celu użycia innych serwerów
lustrzanych, najlepiej położonych najbliżej użytkownika (w infrastrukturze
sieciowej).
</p><p>
Adresy serwerów lustrzanych HTTP i FTP można znaleźć na stronie <a class="ulink" href="https://www.debian.org/distrib/ftplist" target="_top">https://www.debian.org/distrib/ftplist</a> (w rozdziale <span class="quote">„<span class="quote">lista serwerów
lustrzanych Debiana</span>”</span>). Serwery HTTP są zwykle szybsze niż FTP.
</p><p>
Załóżmy na przykład, że najbliższym serwerem lustrzanym jest
<code class="literal">http://mirrors.kernel.org</code>. Przy sprawdzaniu go przeglądarką
internetową lub programem FTP, można zauważyć, że główne katalogi są ułożone
podobnie do:
</p><pre class="programlisting">
http://mirrors.kernel.org/debian/dists/jessie/main/binary-<span class="phrase">amd64</span>/...
http://mirrors.kernel.org/debian/dists/jessie/contrib/binary-<span class="phrase">amd64</span>/...
</pre><p>
Aby użyć tego serwera lustrzanego z <code class="systemitem">apt</code><a id="idp45099648" class="indexterm"></a>, należy dodać poniższy wiersz do pliku
<code class="filename">sources.list</code>:
</p><pre class="programlisting">deb http://mirrors.kernel.org/debian jessie main contrib</pre><p>
Proszę zwrócić uwagę, że <span class="quote">„<span class="quote"><code class="literal">dists</code></span>”</span> jest dodane
jawnie, a argumenty po nazwie wydania są używane do rozwinięcia ścieżki na
wiele katalogów.
</p><p>
Pod dodaniu nowych źródeł należy wyłączyć istniejące wcześniej wiersze
<span class="quote">„<span class="quote"><code class="literal">deb</code></span>”</span> w <code class="filename">sources.list</code>,
dodając na ich początku znak kratki (<code class="literal">#</code>).
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="localmirror"></a>4.3.2. Dodanie źródeł APT-a do lokalnego serwera lustrzanego</h3></div></div></div><p>
Zamiast używania serwerów lustrzanych HTTP lub FTP, można zmodyfikować swój
plik <code class="filename">/etc/apt/sources.list</code> tak, aby skorzystać z kopii
na dysku lokalnym (np. zamontowanej za pomocą <acronym title="Network File System (sieciowy system plików)">NFS</acronym>).
</p><p>
Kopia serwera lustrzanego może się znajdować np. w
<code class="filename">/var/ftp/debian/</code> i posiadać główne katalogi, takie jak:
</p><pre class="programlisting">
/var/ftp/debian/dists/jessie/main/binary-<span class="phrase">amd64</span>/...
/var/ftp/debian/dists/jessie/contrib/binary-<span class="phrase">amd64</span>/...
</pre><p>
Aby użyć jej ze swoim <code class="systemitem">apt</code><a id="idp45114048" class="indexterm"></a>em, proszę
dodać ten wiersz do pliku <code class="filename">sources.list</code>:
</p><pre class="programlisting">deb file:/var/ftp/debian jessie main contrib</pre><p>
Proszę zwrócić uwagę, że <span class="quote">„<span class="quote"><code class="literal">dists</code></span>”</span> jest dodane
jawnie, a argumenty po nazwie wydania są używane do rozwinięcia ścieżki na
wiele katalogów.
</p><p>
Pod dodaniu nowych źródeł należy wyłączyć istniejące wcześniej wiersze
<span class="quote">„<span class="quote"><code class="literal">deb</code></span>”</span> w <code class="filename">sources.list</code>,
dodając na ich początku znak kratki (<code class="literal">#</code>).
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="cdroms"></a>4.3.3. Dodanie źródeł APT-a do nośników optycznych</h3></div></div></div><p>
Aby korzystać <span class="emphasis"><em>wyłącznie</em></span> z płyt (CD, DVD lub Blu-ray),
proszę wyłączyć istniejące wiersze <span class="quote">„<span class="quote"><code class="literal">deb</code></span>”</span> w
pliku <code class="filename">/etc/apt/sources.list</code> dodając na początku znak
kratki (<code class="literal">#</code>).
</p><p>
Proszę upewnić się, że w pliku <code class="filename">/etc/fstab</code> istnieje
wiersz pozwalający na zamontowanie CD-ROM-u w punkcie montowania
<code class="filename">/media/cdrom</code>. Na przykład, jeśli napęd CD-ROM jest
urządzeniem <code class="filename">/dev/sr0</code>, to plik
<code class="filename">/etc/fstab</code> powinien zawierać wiersz podobny do
poniższego:
</p><pre class="programlisting">
/dev/sr0 /media/cdrom auto noauto,ro 0 0
</pre><p>
Proszę zauważyć, że w czwartym polu, między słowami
<code class="literal">noauto,ro</code> <span class="emphasis"><em>nie mogą występować
spacje</em></span>.
</p><p>
Aby sprawdzić, czy wszystko działa, proszę włożyć płytę i spróbować wykonać
</p><pre class="screen">
# mount /media/cdrom    # montowanie płyty w punkcie montowania
# ls -alF /media/cdrom  # wyświetlenie głównego katalogu płyty
# umount /media/cdrom   # odmontowanie płyty
</pre><p>
Następnie, proszę uruchomić:
</p><pre class="screen">
# apt-cdrom add
</pre><p>
dla każdej płyty binarnej Debiana, aby dodać dane z każdego CD do bazy
danych APT-a.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="upgradingpackages"></a>4.4. Aktualizacja pakietów</h2></div></div></div><p>
Zalecanym sposobem aktualizacji z poprzedniego wydania systemu Debian jest
narzędzie zarządzania pakietami <span class="command"><strong>apt-get</strong></span>. W poprzednich
wydaniach zalecano skorzystanie z <span class="command"><strong>aptitude</strong></span>, lecz
najnowsze wersje <span class="command"><strong>apt-get</strong></span> zawierają równorzędną
funkcjonalność i dają lepsze rezultaty w procesie aktualizacji.
</p><p>
Proszę nie zapomnieć o zamontowaniu potrzebnych partycji do odczytu i zapisu
(przede wszystkim partycji głównej i <code class="filename">/usr</code>), za pomocą
polecenia podobnego do poniższego:
</p><pre class="screen">
# mount -o remount,rw /<em class="replaceable"><code>punkt-montowania</code></em>
</pre><p>
Proszę dobrze sprawdzić czy źródła APT-a (w
<code class="filename">/etc/apt/sources.list</code>) odnoszą się do wydania
<span class="quote">„<span class="quote"><code class="literal">jessie</code></span>”</span> lub
<span class="quote">„<span class="quote"><code class="literal">stable</code></span>”</span>.  Nie powinno być tam wpisów
dotyczących wheezy.
</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Uwaga]" src="images/note.png" /></td><th align="left">Uwaga</th></tr><tr><td align="left" valign="top"><p>
    Wiersze źródeł CD-ROM-u mogą niekiedy wskazywać na
<span class="quote">„<span class="quote"><code class="literal">unstable</code></span>”</span>; choć może być to mylące,
<span class="emphasis"><em>nie</em></span> należy tego zmieniać.
  </p></td></tr></table></div><p>
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="record-session"></a>4.4.1. Zapisanie sesji</h3></div></div></div><p>
Zaleca się skorzystanie z programu <span class="command"><strong>/usr/bin/script</strong></span>, aby
zapisać wyniki sesji aktualizacji. Wówczas, jeśli wystąpi problem, gotowy
będzie log, który będzie można wykorzystać np. do zgłoszenia błędu. Aby
rozpocząć zapisywanie, proszę wpisać:
</p><pre class="screen">
# script -t 2&gt;~/upgrade-jessie<em class="replaceable"><code>krok</code></em>.time -a ~/upgrade-jessie<em class="replaceable"><code>krok</code></em>.script
</pre><p>
lub coś podobnego. Jeśli będzie trzeba uruchomić zapis ponownie (np. po
ponownym uruchomieniu systemu), proszę użyć innej wartości
<em class="replaceable"><code>krok</code></em>, aby wskazać zapisywany krok
aktualizacji. Nie należy umieszczać pliku (do którego będzie się zapisywało)
w katalogu tymczasowym, takim jak <code class="filename">/tmp</code> lub
<code class="filename">/var/tmp</code>. Pliki w tych katalogach będą usuwane przy
aktualizacjach i po restarcie.
</p><p>
Zapis ten pozwoli również na przejrzenie informacji, które już zniknęły z
ekranu. Jeśli jest się w konsoli systemowej wystarczy przełączyć się do VT2
(za pomocą <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span>) i (po
zalogowaniu się) skorzystać z polecenia <code class="literal">less -R
~root/upgrade-jessie.script</code>, aby przejrzeć plik.
</p><p>
Po zakończeniu aktualizacji można zatrzymać polecenie
<span class="command"><strong>script</strong></span> poleceniem <code class="literal">exit</code>.
</p><p>
Jeśli użyto przełącznika <span class="emphasis"><em>-t</em></span> do polecenia
<span class="command"><strong>script</strong></span> można skorzystać z programu
<span class="command"><strong>scriptreplay</strong></span>, aby odtworzyć całą sesję:
</p><pre class="screen">
# scriptreplay ~/upgrade-jessie.time ~/upgrade-jessie.script
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="updating-lists"></a>4.4.2. Aktualizowanie listy pakietów</h3></div></div></div><p>
Na początku, należy pobrać listę dostępnych pakietów nowego wydania. Można
to zrobić za pomocą polecenia:
</p><pre class="screen">
# apt-get update
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sufficient-space"></a>4.4.3. Zapewnienie wystarczającej ilości wolnego miejsca </h3></div></div></div><p>
Konieczne jest upewnienie się, że system posiada wystarczająco dużo wolnej
przestrzeni dyskowej przed pełną aktualizacją systemu, opisaną w sekcji
<a class="xref" href="ch-upgrading.pl.html#upgrading-full" title="4.4.5. Aktualizacja systemu">Sekcja 4.4.5, „Aktualizacja systemu”</a>. Wszystkie pakiety potrzebne do instalacji
są najpierw pobierane z sieci i przechowywane w
<code class="filename">/var/cache/apt/archives</code> (przy pobieraniu w podkatalogu
<code class="filename">partial/</code>), dlatego trzeba zapewnić sobie wolne miejsce
na partycji z katalogiem <code class="filename">/var/</code>. Po zakończeniu
pobierania wolne miejsce potrzebne będzie na innych partycjach, aby
zainstalować aktualizowane pakiety (które mogą zawierać większe pliki
wykonywalne lub więcej danych) i nowe pakiety, pobrane przy
aktualizacji. Jeśli jest zbyt mało wolnego miejsca można doprowadzić do
trudnej w opanowaniu, niedokończonej aktualizacji.
</p><p>
Polecenie <span class="command"><strong>apt-get</strong></span> może pokazać szczegółowe informacje o
potrzebnym miejscu. Przed wykonaniem aktualizacji przybliżoną wartość
wymaganej przestrzeni można zobaczyć wykonując:
</p><pre class="screen">
# apt-get -o APT::Get::Trivial-Only=true dist-upgrade
[ ... ]
XXX aktualizowanych, XXX nowo instalowanych, XXX do usunięcia i XXX nieaktualizowanych.
Konieczne pobranie xx.x MB archiwów. 
Po tej operacji zostanie dodatkowo użyte AAA MB miejsca na dysku.
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Uwaga]" src="images/note.png" /></td><th align="left">Uwaga</th></tr><tr><td align="left" valign="top"><p>
Wykonanie tego polecenia na początku procesu aktualizacji może wypisać błąd,
z powodów opisanych w następnych rozdziałach. Trzeba wówczas poczekać z
komendą do zakończenia minimalnej aktualizacji systemu (opisanej w rozdziale
<a class="xref" href="ch-upgrading.pl.html#minimal-upgrade" title="4.4.4. Minimalna aktualizacja systemu">Sekcja 4.4.4, „Minimalna aktualizacja systemu”</a>)
</p></td></tr></table></div><p>
Jeśli zabraknie miejsca <span class="command"><strong>apt-get</strong></span> wyświetli ostrzeżenie:
</p><pre class="screen">
E: Niestety w /var/cache/apt/archives/ nie ma wystarczającej ilości wolnego miejsca.
</pre><p>W takim przypadku, konieczne będzie zwolnienie miejsca na dysku. Można:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
Usunąć pakiety pobrane wcześniej do instalacji (z
<code class="filename">/var/cache/apt/archives</code>). Zwolnienie bufora pakietów za
pomocą polecenia <span class="command"><strong>apt-get clean</strong></span> usunie wszystkie pobrane
wcześniej pliki pakietów.
</p></li><li class="listitem"><p>
Usunąć zapomniane pakiety. Jeśli w wheezy korzystano z poleceń
<span class="command"><strong>aptitude</strong></span> lub <span class="command"><strong>apt-get</strong></span> do ręcznego
instalowania pakietów to programy te przechowują o nich informacje i będą w
stanie oznaczyć jako przestarzałe pakiety, pobrane jedynie przez zależności,
które nie są dłużej potrzebne po usunięciu pakietu. Nie przeznaczą one do
usunięcia pakietów zainstalowanych ręcznie lecz jedynie te zainstalowane
automatycznie. Aby usunąć nieużywane obecnie pakiety zainstalowane
automatycznie proszę wykonać:
</p><pre class="screen">
# apt-get autoremove
</pre><p>
Do znalezienia zbędnych pakietów można również użyć programów
<span class="command"><strong>deborphan</strong></span>, <span class="command"><strong>debfoster</strong></span> lub
<span class="command"><strong>cruft</strong></span>. Nie należy usuwać wszystkich proponowanych przez
to narzędzie pakietów bez zastanowienia (szczególnie, jeśli skorzysta się z
agresywnych opcji, które nie są domyślne, a są podatne na nieprawidłowe
wskazania). Powinno się osobiście przejrzeć pakiety sugerowane do usunięcia
(ich zawartość, rozmiar i opis) przed ostateczną decyzją.
</p></li><li class="listitem"><p>
Usunąć pakiety zajmujące zbyt dużo miejsca, które nie są obecnie potrzebne
(można je zawsze doinstalować po aktualizacji). Jeśli zainstalowano pakiet
<code class="systemitem">popularity-contest</code><a id="idp45188816" class="indexterm"></a> to do
wyświetlenia listy nieużywanych pakietów zajmujących najwięcej miejsca można
posłużyć się poleceniem <span class="command"><strong>popcon-largest-unused</strong></span>. Największe
pakiety można znaleźć poleceniem <span class="command"><strong>dpigs</strong></span> (z pakietu
<code class="systemitem">debian-goodies</code><a id="idp45192256" class="indexterm"></a>) lub programem
<span class="command"><strong>wajig</strong></span> (poleceniem <code class="literal">wajig size</code>). Można
użyć także programu <code class="systemitem">aptitude</code><a id="idp45195440" class="indexterm"></a>. W tym
celu proszę uruchomić <span class="command"><strong>aptitude</strong></span> w <span class="quote">„<span class="quote">trybie
wizualnym</span>”</span>, wybrać
<span class="guimenu">Widoki</span> → <span class="guimenuitem">Nowy płaski widok
pakietów</span>, wcisnąć <span class="keycap"><strong>l</strong></span>, wpisać
<code class="literal">~i</code>, następnie wcisnąć <span class="keycap"><strong>S</strong></span> i wpisać
<code class="literal">~installsize</code>. W ten sposób można otrzymać zwięzłą listę
do dalszych działań. 
</p></li><li class="listitem"><p>
  Usunąć niepotrzebne tłumaczenia i pliki lokalizacji. Można zainstalować
pakiet <code class="systemitem">localepurge</code><a id="idp45204016" class="indexterm"></a> i skonfigurować
go tak, aby zachował w systemie jedynie potrzebne tłumaczenia. Zredukuje to
przestrzeń zajętą przez katalog <code class="filename">/usr/share/locale</code>.
</p></li><li class="listitem"><p>
   Tymczasowo przenieść na inny system lub usunąć całkowicie dzienniki
systemowe z katalogu <code class="filename">/var/log/</code>.
</p></li><li class="listitem"><p>
    Użyć tymczasowego <code class="filename">/var/cache/apt/archives</code>; można użyć
tymczasowego katalogu bufora z innego systemu plików (urządzenia
<acronym title="Universal Serial Bus (uniwersalna magistrala szeregowa)">USB</acronym>, przenośnego dysku, używanego systemu plików, ...)
  </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Uwaga]" src="images/note.png" /></td><th align="left">Uwaga</th></tr><tr><td align="left" valign="top"><p>
      Proszę nie używać montowań <acronym title="Network File System (sieciowy system plików)">NFS</acronym>, ponieważ połączenie
sieciowe może zostać przerwane przy aktualizacji.
    </p></td></tr></table></div><p>
  Na przykład, jeśli napęd <acronym title="Universal Serial Bus (uniwersalna magistrala szeregowa)">USB</acronym> jest zamontowany w
<code class="filename">/media/usbkey</code>:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	usunięcie poprzednio pobranych pakietów do instalacji:

	</p><pre class="screen"># apt-get clean</pre><p>
      </p></li><li class="listitem"><p>
	skopiowanie katalogu <code class="filename">/var/cache/apt/archives</code> na napęd
<acronym title="Universal Serial Bus (uniwersalna magistrala szeregowa)">USB</acronym>:

	</p><pre class="screen"># cp -ax /var/cache/apt/archives /media/usbkey/</pre><p>
      </p></li><li class="listitem"><p>
	zamontowanie tymczasowego bufora w obecnym:

	</p><pre class="screen"># mount --bind /media/usbkey/archives /var/cache/apt/archives</pre><p>
      </p></li><li class="listitem"><p>
	przywrócenie pierwotnego katalogu
<code class="filename">/var/cache/apt/archives</code> po aktualizacji:

	</p><pre class="screen"># umount /media/usbkey/archives</pre><p>
      </p></li><li class="listitem"><p>
	usunięcie pozostałego <code class="filename">/media/usbkey/archives</code>.
      </p></li></ol></div><p>
  Tymczasowy bufor można utworzyć w dowolnym systemie plików zamontowanym w
systemie.
  </p></li><li class="listitem"><p>
    Wykonanie minimalnej aktualizacji (opisanej w <a class="xref" href="ch-upgrading.pl.html#minimal-upgrade" title="4.4.4. Minimalna aktualizacja systemu">Sekcja 4.4.4, „Minimalna aktualizacja systemu”</a>) lub częściowych aktualizacji systemu przed
pełną aktualizacją. Umożliwi to częściową aktualizację systemu i pozwoli na
wyczyszczenie bufora pakietów przed pełną aktualizacją.
  </p></li></ul></div><p>
Proszę zwrócić uwagę, że w celu bezpiecznego usunięcia pakietów zaleca się
przełączenie swojego pliku <code class="filename">sources.list</code> z powrotem na
wydanie wheezy zgodnie z opisem w <a class="xref" href="ap-old-stuff.pl.html#old-sources" title="A.2. Sprawdzenie listy źródeł">Sekcja A.2, „Sprawdzenie listy źródeł”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="minimal-upgrade"></a>4.4.4. Minimalna aktualizacja systemu</h3></div></div></div><p>
W niektórych przypadkach bezpośrednie wykonanie pełnej aktualizacji
(opisanej poniżej) może usunąć wiele pakietów które mają być zachowane. Z
tego powodu zaleca się wykonanie dwustopniowej aktualizacji. Najpierw
minimalnej, pozwalającej uporać się z tymi konfliktami, a następnie pełnej,
zgodnie z opisem w <a class="xref" href="ch-upgrading.pl.html#upgrading-full" title="4.4.5. Aktualizacja systemu">Sekcja 4.4.5, „Aktualizacja systemu”</a>. 
</p><p>
Aby to zrobić, proszę wykonać
</p><pre class="screen">
# apt-get upgrade
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Uwaga]" src="images/note.png" /></td><th align="left">Uwaga</th></tr><tr><td align="left" valign="top"><p>
      Proces aktualizacji innych wydań zalecał używanie programu
<span class="command"><strong>aptitude</strong></span> do aktualizacji. To narzędzie nie jest zalecane
do aktualizacji z wydania wheezy do jessie.
    </p></td></tr></table></div><p>
W ten sposób zaktualizowane zostaną pakiety, które nie wymagają usunięcia
lub instalacji innych pakietów.
</p><p>
Minimalna aktualizacja systemu może okazać się przydatna również w systemach
z niewielką ilością wolnego miejsca, na których pełna aktualizacja nie może
być wykonana z tego powodu.
</p><p>
  Jeśli zainstalowano pakiet <code class="systemitem">apt-listchanges</code><a id="idp45236144" class="indexterm"></a> to (w domyślnej konfiguracji)
wyświetli on ważne informacje o aktualizowanych pakietach w programie
stronicującym. Po zapoznaniu się z ich treścią należy wcisnąć
<span class="keycap"><strong>q</strong></span> aby kontynuować aktualizację.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="upgrading-full"></a>4.4.5. Aktualizacja systemu</h3></div></div></div><p>
Po wykonaniu poprzednich kroków, nadszedł czas na główną część
aktualizacji. Proszę wykonać
</p><pre class="screen">
# apt-get dist-upgrade
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Uwaga]" src="images/note.png" /></td><th align="left">Uwaga</th></tr><tr><td align="left" valign="top"><p>
      Proces aktualizacji innych wydań zalecał używanie programu
<span class="command"><strong>aptitude</strong></span> do aktualizacji. To narzędzie nie jest zalecane
do aktualizacji z wydania wheezy do jessie.
    </p></td></tr></table></div><p>
Przeprowadzona zostanie w ten sposób pełna aktualizacja systemu, instalacja
najnowszych dostępnych wersji wszystkich pakietów i rozwiązanie wszystkich
możliwych zmian zależności pakietów w innych wydaniach. Jeśli jest to
konieczne zainstalowane zostaną nowe pakiety (najczęściej nowe wersje
bibliotek lub pakiety o nowych nazwach) i usunięte wszystkie niepotrzebne
pakiety powodujące konflikty.
</p><p>
Przy aktualizacji z zestawu CD-ROM-ów (lub płyt DVD), użytkownik będzie
proszony o włożenie określonej płyty w wielu miejscach aktualizacji. Z
powodu zależności między pakietami rozproszonymi na poszczególnych nośnikach
konieczne może okazać się wielokrotne wkładanie tej samej płyty.
</p><p>
Nowe wersje zainstalowanych pakietów, które nie mogą być zainstalowane bez
zmiany statusu innego pakietu zostaną pozostawione w bieżącej wersji
(wyświetlone jako <span class="quote">„<span class="quote">zatrzymane</span>”</span>). Można to rozwiązać za pomocą
<span class="command"><strong>aptitude</strong></span>, wybierając te pakiety do instalacji; można też
spróbować wykonać <code class="literal">apt-get install
<em class="replaceable"><code>pakiet</code></em></code>.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="trouble"></a>4.5. Możliwe problemy przy aktualizacji</h2></div></div></div><p>
Poniższe sekcje opisują znane problemy, które mogą pojawić się przy
aktualizacji do wydania jessie.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="immediate-configure"></a>4.5.1. Podczas aktualizacji dystrybucji pojawia się błąd <span class="quote">„<span class="quote">Nie udało się
wykonać natychmiastowej konfiguracji</span>”</span>.</h3></div></div></div><p>
W niektórych przypadkach polecenie <span class="command"><strong>apt-get dist-upgrade</strong></span>
po pobraniu pakietów może wypisać następujący błąd:
</p><pre class="screen">
E: Nie udało się wykonać natychmiastowej konfiguracji "<em class="replaceable"><code>pakietu</code></em>". Proszę wykonać "man 5 apt.conf" i zapoznać się z wpisem APT::Immediate-Configure aby dowiedzieć się więcej.
</pre><p>
</p><p>
W takim wypadku, polecenie <span class="command"><strong>apt-get dist-upgrade -o
APT::Immediate-Configure=0</strong></span> powinno pozwolić przeprowadzić
aktualizację pomyślnie.
</p><p>
Innym wyjściem pozwalającym obejść problem jest tymczasowe dodanie do pliku
<code class="filename">sources.list</code> źródeł wydań wheezy i
jessie, a następnie uruchomienie <span class="command"><strong>apt-get update</strong></span>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="expected-removals"></a>4.5.2. Spodziewane usunięcia pakietów</h3></div></div></div><p>
Proces aktualizacji do wydania jessie może prosić o usunięcie pewnych
pakietów. Dokładna lista będzie zależała od obecnie zainstalowanych
pakietów. Niniejsze uwagi do wydania dają ogólny obraz tego zabiegu. W razie
wątpliwości przed kontynuowaniem należy sprawdzić kasowanie proponowane
przez każdą z metod. Więcej informacji o pakietach przestarzałych w
jessie znajduje się w <a class="xref" href="ch-upgrading.pl.html#obsolete" title="4.10. Przestarzałe pakiety">Sekcja 4.10, „Przestarzałe pakiety”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="conflicts-loops"></a>4.5.3. Konflikty lub pętle <span class="quote">„<span class="quote">wymaga wstępnie</span>”</span></h3></div></div></div><p>
Czasami potrzebne jest włączenie opcji
<code class="literal">APT::Force-LoopBreak</code> w APT, aby móc tymczasowo usunąć
pakiet istotny z powodu pętli konfliktów/zależności wstępnych. Polecenie
<span class="command"><strong>apt-get</strong></span> wyświetli o tym ostrzeżenie i przerwie
aktualizację. Można obejść problem podając opcję <code class="literal">-o
APT::Force-LoopBreak=1</code> w wierszu polecenia
<span class="command"><strong>apt-get</strong></span>.
</p><p>
Istnieje możliwość, że struktura zależności systemowych będzie na tyle
naruszona, że konieczna będzie ręczna interwencja. Zwykle oznacza to użycie
polecenia <span class="command"><strong>apt-get</strong></span> lub
</p><pre class="screen">
# dpkg --remove <em class="replaceable"><code>nazwa-pakietu</code></em>
</pre><p>
aby wyeliminować część przeszkadzających pakietów lub
</p><pre class="screen">
# apt-get -f install
# dpkg --configure --pending
</pre><p>
W sytuacjach ekstremalnych konieczne może być wymuszenie reinstalacji za
pomocą polecenia
</p><pre class="screen">
# dpkg --install <em class="replaceable"><code>/ścieżka/do/nazwy-pakietu.deb</code></em>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="file-conflicts"></a>4.5.4. Konflikty plików</h3></div></div></div><p>
Konflikty plików nie powinny wystąpić przy aktualizacji z
<span class="quote">„<span class="quote">czystego</span>”</span> wydania wheezy, lecz mogą się pojawić przy
zainstalowanych nieoficjalnych backportach. Konflikty plików objawiają się
komunikatami błędów, podobnymi do poniższego:
</p><pre class="screen">
Rozpakowywanie <em class="replaceable"><code>&lt;pakiet-foo&gt;</code></em> (z <em class="replaceable"><code>&lt;plik-pakietu-foo&gt;</code></em>) ...
dpkg: błąd przetwarzania <em class="replaceable"><code>&lt;pakiet-foo&gt;</code></em> (--install):
 próba nadpisania "<em class="replaceable"><code>&lt;jakiś-plik&gt;</code></em>",
 który istnieje także w pakiecie <em class="replaceable"><code>&lt;pakiet-bar&gt;</code></em>
dpkg-deb: podproces wklej zabity przez sygnał (Przerwany potok)
 Wystąpiły błędy podczas przetwarzania:
 <em class="replaceable"><code>&lt;pakiet-foo&gt;</code></em>
</pre><p>
Można spróbować rozwiązać konflikt plików przez wymuszenie usunięcia pakietu
wymienionego w <span class="emphasis"><em>ostatnim</em></span> wierszu komunikatu błędu:
</p><pre class="screen">
# dpkg -r --force-depends <em class="replaceable"><code>nazwa-pakietu</code></em>
</pre><p>
Po zakończeniu naprawy powinno się dać wznowić aktualizację, ponawiając
poprzednio wymienione polecenia <span class="command"><strong>apt-get</strong></span>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-changes"></a>4.5.5. Zmiany konfiguracji</h3></div></div></div><p>
Podczas aktualizacji zostaną wyświetlone pytania dotyczące konfiguracji lub
ponownej konfiguracji kilku pakietów. Gdy pytanie będzie dotyczyło tego czy
plik w katalogu <code class="filename">/etc/init.d</code> lub plik
<code class="filename">/etc/manpath.config</code> ma zostać zastąpiony wersją
opiekuna pakietu to odpowiedź powinna z reguły brzmieć <span class="quote">„<span class="quote">tak</span>”</span>
(aby zapewnić spójność systemu). Zawsze można cofnąć się do starszej wersji,
ponieważ są one zapisywane z rozszerzeniem <code class="literal">.dpkg-old</code>.
</p><p>
W razie wątpliwości, proszę zapisać nazwę pakietu lub pliku i zdecydować o
tym później. Można przeszukać plik z zapisem sesji, aby znaleźć informację
wyświetloną na ekranie przy aktualizacji.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="console-change"></a>4.5.6. Zmiany sesji na konsoli</h3></div></div></div><p>
Jeśli aktualizacja jest wykonywana z lokalnej konsoli systemowej, w którymś
momencie aktualizacji może zdarzyć się, że konsola zostanie przesunięta na
inny widok i straci się obraz procesu aktualizacji. Prawdopodobieństwo
takiego zdarzenia istnieje np. podczas korzystania z interfejsu graficznego,
gdy restartowany jest menedżer logowania.
</p><p>
Aby odzyskać konsolę, na której trwa aktualizacja, należy wcisnąć <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span>,
aby przełączyć się z powrotem na terminal wirtualny 1 z graficznego ekranu
powitalnego lub <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span> z trybu
lokalnej konsoli tekstowej. Proszę zastąpić F1 klawiszem funkcyjnym o tym
samym numerze co terminal wirtualny, na którym trwa aktualizacja. Można
również skorzystać ze kombinacji <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>strzałka w
lewo</strong></span> lub <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>strzałka w
prawo</strong></span> aby przenosić się na kolejne terminale tekstowe.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="package-specific-issues"></a>4.5.7. Pakiety specjalnej troski</h3></div></div></div><p>
Pakiety powinny się zwykle aktualizować bez problemów, z wydania
wheezy do jessie. Jest jednak kilka przypadków, gdzie może
okazać się potrzebna interwencja albo przed, albo w trakcie
aktualizacji. Szczegółowa rozpiska dla poszczególnych pakietów znajduje się
poniżej.
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="issues-systemd"></a>4.5.7.1. systemd</h4></div></div></div><p>
    Aktualizacja Debiana z wydania wheezy do jessie domyślnie
zmieni domyślny system init z SysV na systemd. W zależności od systemu i
ustawień użytkownika może zajść potrzeba dokonania pewnych zmian
ręcznie. Szczegółowy opis znanych problemów znajduje się w <a class="xref" href="ch-information.pl.html#systemd-upgrade-default-init-system" title="5.6. Aktualizacja instaluje nowy domyślny system init wydania Jessie">Sekcja 5.6, „Aktualizacja instaluje nowy domyślny system init wydania Jessie”</a>.
  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="issues-lxc"></a>4.5.7.2. LXC</h4></div></div></div><p>
    W przypadku zainstalowanego LXC przy aktualizacji systemu i kontenerów
należy zachować szczególną ostrożność. Potencjalne problemy i ich
rozwiązania opisano w <a class="xref" href="ch-information.pl.html#lxc-upgrade-issues" title="5.8. Zastrzeżenia przy aktualizacji gospodarzy i kontenerów LXC">Sekcja 5.8, „Zastrzeżenia przy aktualizacji gospodarzy i kontenerów LXC”</a>.
  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="newkernel"></a>4.6. Aktualizacja jądra i powiązanych pakietów</h2></div></div></div><p>
Niniejszy rozdział opisuje sposób aktualizacji jądra i identyfikacji
potencjalnych problemów który mogą się pojawić. Można zainstalować jeden z
pakietów <code class="systemitem">linux-image-*</code><a id="idp45307200" class="indexterm"></a>
udostępnionych przez Debiana lub skompilować dostosowany do swoich potrzeb.
</p><p>
Proszę zauważyć, że wiele poniższych informacji zakłada, że używa się
jednego z modularnych jąder Debiana razem z <code class="systemitem">initramfs-tools</code><a id="idp45309696" class="indexterm"></a> i <code class="systemitem">udev</code><a id="idp45311360" class="indexterm"></a>. Jeśli korzysta się z własnego,
dostosowanego jądra, które nie wymaga initrd lub wykorzystuje się inny
program tworzący initrd to część informacji będzie nieprzydatna.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kernel-metapackage"></a>4.6.1. Instalowanie metapakietu jądra</h3></div></div></div><p>
Przy aktualizowaniu dystrybucji z wydania wheezy do jessie
zaleca się zainstalowanie metapakietu linux-image-*, jeśli nie dokonano tego
wcześniej. Te metapakiety będą zainstalowane automatycznie w nowszych
wersjach jądra przy dokonywaniu aktualizacji. To, czy są zainstalowane,
można sprawdzić za pomocą:
</p><pre class="screen">
# dpkg -l "linux-image*" | grep ^ii | grep -i meta
</pre><p>
Jeśli nie zostanie wypisany żaden wynik potrzeba będzie albo zainstalować
ręcznie nowy pakiet linux-image lub zainstalować metapakiet linux-image. Aby
zobaczyć listę dostępnych metapakietów linux-image, proszę wykonać:
</p><pre class="screen">
# apt-cache search linux-image- | grep -i meta | grep -v transition
</pre><p>
W razie wątpliwości co do wyboru pakietu proszę uruchomić <code class="literal">uname
-r</code> i znaleźć pakiet o podobnej nazwie. Na przykład jeśli widać
<span class="quote">„<span class="quote"><code class="literal">2.6.32-5-amd64</code></span>”</span>, to zaleca się
zainstalowanie <code class="systemitem">linux-image-amd64</code><a id="idp45320016" class="indexterm"></a>. Można również użyć
<span class="command"><strong>apt-cache</strong></span>, aby zobaczyć długi opis każdego pakietu,
pomocny do wyboru najlepszego z nich. Na przykład:
</p><pre class="screen">
# apt-cache show linux-image-amd64
</pre><p>
Powinno się następnie uruchomić <code class="literal">apt-get install</code>, aby go
zainstalować. Po zainstalowaniu nowego jądra należy uruchomić system
ponownie przy możliwie najbliższej okazji, aby zyskać zalety nowego
jądra. Przed wykonaniem pierwszego ponownego uruchomienia proszę zapoznać
się z <a class="xref" href="ch-upgrading.pl.html#nownownow" title="4.7. Sprawy do zrobienia przed ponownym uruchomieniem">Sekcja 4.7, „Sprawy do zrobienia przed ponownym uruchomieniem”</a>.
</p><p>
Dla bardziej doświadczonych użytkowników istnieje łatwy sposób skompilowania
swojego, dostosowanego jądra w systemie Debian. Proszę zainstalować źródła
jądra zawarte w pakiecie <code class="systemitem">linux-source</code><a id="idp45326320" class="indexterm"></a>. Do zbudowania pakietu binarnego
można wykorzystać <code class="literal">deb-pkg</code>, dostępne w źródłach
makefile. Więcej informacji można znaleźć na stronie <a class="ulink" href="http://kernel-handbook.alioth.debian.org/" target="_top">Debian Linux Kernel
Handbook</a>, dostępnej również jako pakiet <code class="systemitem">debian-kernel-handbook</code><a id="idp45329792" class="indexterm"></a> (w języku angielskim).
</p><p>
Jeśli to możliwe, to osobna aktualizacja pakietu jądra od głównego
<code class="literal">dist-upgrade</code> jest dobrym rozwiązaniem - redukuje szanse
na otrzymanie tymczasowo pozbawionego możliwości rozruchu systemu. Należy to
zrobić wyłącznie po aktualizacji minimalnej, opisanej w <a class="xref" href="ch-upgrading.pl.html#minimal-upgrade" title="4.4.4. Minimalna aktualizacja systemu">Sekcja 4.4.4, „Minimalna aktualizacja systemu”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="initramfs-tools-issues"></a>4.6.2. Zmiany w montowaniu i sprawdzaniu systemu plików <code class="filename">/usr</code></h3></div></div></div><p>
    Obecnie, <code class="systemitem">initramfs-tools</code><a id="idp45335792" class="indexterm"></a> będzie
sprawdzało również główny system plików przed zamontowaniem go, za
pomocą <code class="literal">fsck</code>. Jeśli wybrano <code class="literal">systemd</code>
jako swój system init oraz istnieje oddzielny system plików
<code class="filename">/usr</code>, sprawdzany i montowany będzie również
<code class="filename">/usr</code>.
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	Jeśli <code class="filename">/usr</code> jest oddzielnym systemem plików na
urządzeniu RAID, a ustawienie <code class="literal">INITRDSTART</code> w
<code class="filename">/etc/default/mdadm</code> nie ma wartości
"<code class="literal">all</code>", konieczna będzie jego zmiana, aby objąć również to
urządzenie.
      </p></li><li class="listitem"><p>
	Jeśli <code class="filename">/usr</code> jest oddzielnym system plików na woluminie
logicznym LVM, a wiersz <code class="filename">/usr</code> w
<code class="filename">/etc/fstab</code> określa urządzenie przez
<code class="literal">UUID</code> lub <code class="literal">LABEL</code>, konieczna jest jego
zmiana i zapis w formacie
<code class="filename">/dev/mapper/<em class="replaceable"><code>VG</code></em>-<em class="replaceable"><code>LV</code></em></code>
lub
<code class="filename">/dev/<em class="replaceable"><code>VG</code></em>/<em class="replaceable"><code>LV</code></em></code>.
      </p></li><li class="listitem"><p>
	Nie jest obecnie możliwe montowanie za pomocą podpięcia ("bind") systemu
plików <code class="filename">/usr</code>.
      </p></li><li class="listitem"><p>
	Jeśli RTC (zegar czasu rzeczywistego) jest ustawiony na czas lokalny i
wyprzedza on UTC, <code class="literal">e2fsck</code> wypisze ostrzeżenie w trakcie
rozruchu o zmianie czasu do tyłu (<a class="ulink" href="https://bugs.debian.org/767040" target="_top">błąd #767040</a>). Można to
wyłączyć za pomocą następujących wierszy w
<code class="filename">/etc/e2fsck.conf</code>:
      </p><pre class="screen">
[options]
broken_system_clock=1
</pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nownownow"></a>4.7. Sprawy do zrobienia przed ponownym uruchomieniem</h2></div></div></div><p>
Po zakończeniu <code class="literal">apt-get dist-upgrade</code>
<span class="quote">„<span class="quote">formalna</span>”</span> aktualizacja jest zakończona, lecz są pewne rzeczy
do sprawdzenia <span class="emphasis"><em>przed</em></span> ponownym uruchomieniem.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
      Przy aktualizacji z wydania Wheezy do Jessie dobrym
pomysłem może być wyczyszczenie starych pakietów <span class="emphasis"><em>przed</em></span>
pierwszym ponownym uruchomieniem. W szczególności problemy mogą sprawiać
stare skrypty init. Proszę zapoznać się z <a class="xref" href="ch-upgrading.pl.html#purge-removed-packages" title="4.8.1. Czyszczenie usuniętych pakietów">Sekcja 4.8.1, „Czyszczenie usuniętych pakietów”</a> aby dowiedzieć się więcej o znajdowaniu
i czyszczeniu usuniętych pakietów.
    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="for-next"></a>4.8. Przygotowanie do kolejnego wydania</h2></div></div></div><p>
Po aktualizacji jest kilka rzeczy, które można zrobić w celu przygotowania
do następnego wydania.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
Usunięcie pakietów oznaczonych teraz jako przestarzałe zgodnie z opisem w
rozdziałach <a class="xref" href="ch-upgrading.pl.html#sufficient-space" title="4.4.3. Zapewnienie wystarczającej ilości wolnego miejsca">Sekcja 4.4.3, „Zapewnienie wystarczającej ilości wolnego miejsca ”</a> i <a class="xref" href="ch-upgrading.pl.html#obsolete" title="4.10. Przestarzałe pakiety">Sekcja 4.10, „Przestarzałe pakiety”</a>. Proszę przejrzeć używane pliki konfiguracyjne i
rozważyć całkowite wyczyszczenie (ang. purge) pakietów, w celu usunięcia ich
plików konfiguracyjnych. Zob. też <a class="xref" href="ch-upgrading.pl.html#purge-removed-packages" title="4.8.1. Czyszczenie usuniętych pakietów">Sekcja 4.8.1, „Czyszczenie usuniętych pakietów”</a>.
</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="purge-removed-packages"></a>4.8.1. Czyszczenie usuniętych pakietów</h3></div></div></div><p>
    Ogólnym zaleceniem jest czyszczenie usuniętych pakietów. Ma to szczególny
sens, jeśli pakiety zostały usunięte we wcześniejszej aktualizacji wydania
(np. przy aktualizacji do wheezy) lub pochodzą od zewnętrznych
dostawców. W szczególności znane są problemy ze starymi skryptami init.d.
  </p><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Ostrzeżenie]" src="images/caution.png" /></td><th align="left">Ostrzeżenie</th></tr><tr><td align="left" valign="top"><p>
      Wyczyszczenie pakietu zazwyczaj usuwa również jego pliki dziennika, dlatego
można rozważyć uprzednie wykonanie ich kopii zapasowej.
    </p></td></tr></table></div><p>
    Poniższe polecenie wyświetla listę wszystkich usuniętych pakietów z
pozostawionymi w systemie plikami konfiguracyjnymi:
  </p><pre class="screen">
# dpkg -l | awk '/^rc/ { print $2 }'
</pre><p>
    Pakiety można wyczyścić poleceniem <span class="command"><strong>apt-get purge</strong></span>. Aby
wyczyścić od razu wszystkie, można skorzystać z następującego polecenia:
  </p><pre class="screen">
# apt-get purge $(dpkg -l | awk '/^rc/ { print $2 }')
</pre><p>
    Jeśli korzysta się z programu <code class="systemitem">aptitude</code><a id="idp45380288" class="indexterm"></a>, można rozważyć użycie następującego
odpowiednika powyższych poleceń:
  </p><pre class="screen">
$ aptitude search '~c'
$ aptitude purge '~c'
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deprecated"></a>4.9. Przestarzałe składniki</h2></div></div></div><p>
Od następnego wydania systemu Debian 9 (nazwa kodowa
stretch) część funkcji zostanie porzucona. Użytkownicy powinni
przejść na rozwiązania alternatywne, aby uniknąć problemów przy aktualizacji
do 9.
</p><p>
Dotyczy do między innymi:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Pakiet <code class="systemitem">hardening-wrapper</code><a id="idp45386336" class="indexterm"></a> jest
przestarzały i będzie prawdopodobnie usunięty w wydaniu Stretch.
		</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="obsolete"></a>4.10. Przestarzałe pakiety</h2></div></div></div><p>
Wprowadzając wiele nowych pakietów, jessie porzuca i pomija również
sporo starych pakietów z wydania wheezy. Nie ma dla nich ścieżki
aktualizacji. Choć nic nie stoi na przeszkodzie, aby w razie potrzeby używać
takich pakietów to projekt Debian kończy wsparcie bezpieczeństwa po roku od
wydania jessie<a href="#ftn.idp45389728" class="footnote" id="idp45389728"><sup class="footnote">[5]</sup></a> i nie dostarczy
innego wsparcie w międzyczasie. Zaleca się zastąpienie ich dostępnymi
alternatywami jeśli takie istnieją.
</p><p>
Jest wiele powodów, dla których pakiet mógł zostać usunięty z dystrybucji:
nie jest dłużej utrzymywany przez projekt macierzysty, nie ma chętnego
Dewelopera Debiana, który byłby zainteresowany opiekowaniem się pakietem,
funkcja którą pełnił została przejęta przez inne programy (lub nowszą
wersję), nie jest dłużej uważany za odpowiedni dla wydania jessie ze
względu na poważne błędy. W tym ostatnim przypadku pakiet może być wciąż
obecny w dystrybucji <span class="quote">„<span class="quote">niestabilnej</span>”</span>.
</p><p>
Znalezienie pakietów <span class="quote">„<span class="quote">przestarzałych</span>”</span> w zaktualizowanym
systemie jest łatwe ponieważ interfejsy zarządzania pakietami oznaczają je
odpowiednio. W <span class="command"><strong>aptitude</strong></span> znajdują się one w sekcji
<span class="quote">„<span class="quote">Pakiety przestarzałe i lokalne</span>”</span>.
</p><p>
<a class="ulink" href="https://bugs.debian.org/" target="_top">System śledzenia błędów Debiana</a> często
udostępnia dodatkowe informacje nt. powodów usunięcia danego pakietu. Należy
przejrzeć zarówno archiwalne zgłoszenia błędów samego pakietu jak i
archiwalne zgłoszenia <a class="ulink" href="https://bugs.debian.org/cgi-bin/pkgreport.cgi?pkg=ftp.debian.org&amp;archive=yes" target="_top">pseudopakietu
ftp.debian.org</a>.
</p><p>
  Lista przestarzałych pakietów obejmuje:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	<code class="systemitem">postgresql-9.1</code><a id="idp45399120" class="indexterm"></a>, zastąpiony przez
<code class="systemitem">postgresql-9.4</code><a id="idp45400848" class="indexterm"></a>. Po ukończeniu
aktualizacji systemu powinno się zaplanować aktualizację swoich baz danych
PostgreSQL 9.1 do nowej wersji 9.4 za pomocą narzędzia
<span class="command"><strong>pg_upgradecluster</strong></span>. Użytkownikom języka proceduralnego
PL/perl wydanie Jessie zapewnia zaktualizowany pakiet <code class="systemitem">postgresql-plperl-9.1</code><a id="idp45403728" class="indexterm"></a> zlinkowany z wersją
biblioteki libperl z Jessie, aby umożliwić aktualizację do nowej wersji
perla w Jessie przy zachowaniu działających starych funkcji bazy danych
PL/perl aż do momentu zaktualizowania samej bazy.
      </p></li><li class="listitem"><p>
        
        
<code class="systemitem">python3.2</code><a id="idp45406640" class="indexterm"></a>, zastąpiony przez
<code class="systemitem">python3.4</code><a id="idp45408368" class="indexterm"></a> (wersja 2.7 jest wspierana
w wheezy i jessie).
      </p></li><li class="listitem"><p>
        <code class="systemitem">ruby1.8</code><a id="idp45410864" class="indexterm"></a> i <code class="systemitem">ruby1.9.1</code><a id="idp45412528" class="indexterm"></a>; zastąpione przez <code class="systemitem">ruby2.1</code><a id="idp45414256" class="indexterm"></a>. Proszę zainstalować pakiet <code class="systemitem">ruby</code><a id="idp45416000" class="indexterm"></a> aby automatycznie śledzić bieżącą wersję
ruby.
      </p></li><li class="listitem"><p>
        <code class="systemitem">mplayer</code><a id="idp45418576" class="indexterm"></a>; można go zastąpić pakietem
<code class="systemitem">mplayer2</code><a id="idp45420320" class="indexterm"></a> lub <code class="systemitem">mpv</code><a id="idp45421984" class="indexterm"></a> (nowość w jessie). Stary pakiet
był najbardziej kompatybilny gdy idzie o argumenty wiersza poleceń i
konfigurację (dodając przy tym kilka nowych funkcji), natomiast nowszy
dodaje wiele nowych funkcji i usprawnień i jest aktywnie rozwijany przez
swój projekt macierzysty.
      </p></li><li class="listitem"><p>
        <code class="systemitem">openoffice.org</code><a id="idp45424976" class="indexterm"></a>; proszę przejść na
<code class="systemitem">libreoffice</code><a id="idp45426704" class="indexterm"></a>.
      </p></li><li class="listitem"><p>
        <code class="systemitem">squid</code><a id="idp45429168" class="indexterm"></a>, zastąpiony przez <code class="systemitem">squid3</code><a id="idp45430896" class="indexterm"></a>.
      </p></li><li class="listitem"><p>
        <code class="systemitem">libjpeg-progs</code><a id="idp45433360" class="indexterm"></a>, zastąpiony przez
<code class="systemitem">libjpeg-turbo-progs</code><a id="idp45435088" class="indexterm"></a>.
      </p></li><li class="listitem"><p>
        <code class="systemitem">openjdk-6-*</code><a id="idp45437552" class="indexterm"></a>, zastąpiony przez
<code class="systemitem">openjdk-7-*</code><a id="idp45439280" class="indexterm"></a>.
      </p></li></ul></div><p>
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dummy"></a>4.10.1. Pakiety atrapy</h3></div></div></div><p>
Część pakietów z wydania wheezy w jessie została podzielona
na kilka pakietów, często w celu ułatwienia zarządzania systemem. Aby
ułatwić ścieżkę aktualizacji jessie często udostępnia pakiety
<span class="quote">„<span class="quote">atrapy</span>”</span>: puste pakiety o tej samej nazwie co stary pakiet w
wydaniu wheezy, z zależnościami, które spowodują instalację nowych
pakietów. Te pakiety <span class="quote">„<span class="quote">atrapy</span>”</span> stają się niepotrzebne po
aktualizacji i mogą zostać usunięte.
</p><p>
Większość (choć nie wszystkie) opisów pakietów atrap wskazuje ich
przeznaczenie. Opisy pakietów nie są jednak ustandaryzowane, można
skorzystać więc z <span class="command"><strong>deborphan</strong></span> z opcjami
<code class="literal">--guess-<em class="replaceable"><code>*</code></em></code> (np.
<code class="literal">--guess-dummy</code>), aby je odszukać. Proszę zwrócić uwagę, że
część pakietów atrap nie jest przeznaczona do usunięcia po aktualizacji,
lecz są używane do śledzenia obecnie dostępnych wersji danego pakietu.
</p></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div id="ftn.idp44963568" class="footnote"><p><a href="#idp44963568" class="para"><sup class="para">[1] </sup></a>Jeśli priorytet debconfa jest ustawiony na bardzo wysoką wartość to może
spowodować niewyświetlanie pytań konfiguracyjnych. Usługi zależne od
domyślnych odpowiedzi, które nie będą pasowały do danego systemu, nie
uruchomią się.</p></div><div id="ftn.idp44965248" class="footnote"><p><a href="#idp44965248" class="para"><sup class="para">[2] </sup></a>Przykład: usługi DNS i DHCP, szczególnie jeśli nie ma redundancji lub
tzw. failover. W przypadku DHCP użytkownicy mogą zostać odłączeni z sieci,
jeśli czas dzierżawy jest mniejszy niż czas trwania aktualizacji.</p></div><div id="ftn.idp44988688" class="footnote"><p><a href="#idp44988688" class="para"><sup class="para">[3] </sup></a> Można wyłączyć tę funkcję dodając parametr <code class="literal">panic=0</code> do
parametrów rozruchowych.  </p></div><div id="ftn.idp45075040" class="footnote"><p><a href="#idp45075040" class="para"><sup class="para">[4] </sup></a> System zarządzania pakietami Debiana nie pozwala zwykle na usunięcie lub
zastąpienie pliku będącego własnością innego pakietu, chyba że pakiet został
zdefiniowany jako zastępujący dany pakiet.  </p></div><div id="ftn.idp45389728" class="footnote"><p><a href="#idp45389728" class="para"><sup class="para">[5] </sup></a> Lub tak długo, aż nie pojawi się nowe wydanie w tym czasie. Zwykle jedynie
dwa wydania stabilne są wspierane w dowolnym czasie.  </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch-installing.pl.html"><img src="images/prev.png" alt="Poprzedni" /></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch-information.pl.html"><img src="images/next.png" alt="Następny" /></a></td></tr><tr><td width="40%" align="left" valign="top">Rozdział 3. System instalacyjny </td><td width="20%" align="center"><a accesskey="h" href="index.pl.html"><img src="images/home.png" alt="Spis treści" /></a></td><td width="40%" align="right" valign="top"> Rozdział 5. Problemy, które należy mieć na uwadze, a dotyczące wydania jessie</td></tr></table></div></body></html>