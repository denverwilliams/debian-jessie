<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 4. Upgrades from Debian 7 (wheezy)</title><link rel="stylesheet" type="text/css" href="debian.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.en.html" title="Release Notes for Debian 8 (jessie), 64-bit PC" /><link rel="up" href="index.en.html" title="Release Notes for Debian 8 (jessie), 64-bit PC" /><link rel="prev" href="ch-installing.en.html" title="Chapter 3. Installation System" /><link rel="next" href="ch-information.en.html" title="Chapter 5. Issues to be aware of for jessie" /><meta xmlns="" name="viewport" content="width=device-width, initial-scale=1" /><style xmlns="" type="text/css">
      body {
        background-repeat: no-repeat;
        background-image: none;
      }
    </style></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 4. Upgrades from Debian 7 (wheezy)</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch-installing.en.html"><img src="images/prev.png" alt="Prev" /></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch-information.en.html"><img src="images/next.png" alt="Next" /></a></td></tr></table><hr /></div><div xml:lang="en" class="chapter" lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="ch-upgrading"></a>Chapter 4. Upgrades from Debian 7 (wheezy)</h1></div></div></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="ch-upgrading.en.html#backup">4.1. Preparing for the upgrade</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#data-backup">4.1.1. Back up any data or configuration information</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#inform-users">4.1.2. Inform users in advance</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#services-downtime">4.1.3. Prepare for downtime on services</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#recovery">4.1.4. Prepare for recovery</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#upgrade-preparations">4.1.5. Prepare a safe environment for the upgrade</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.en.html#system-status">4.2. Checking system status</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#review-actions">4.2.1. Review actions pending in package manager</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#disable-apt-pinning">4.2.2. Disabling APT pinning</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#package-status">4.2.3. Checking packages status</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#proposed-updates">4.2.4. The proposed-updates section</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#unofficial-sources">4.2.5. Unofficial sources</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.en.html#upgrade-process">4.3. Preparing sources for APT</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#network">4.3.1. Adding APT Internet sources</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#localmirror">4.3.2. Adding APT sources for a local mirror</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#cdroms">4.3.3. Adding APT sources from optical media</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.en.html#upgradingpackages">4.4. Upgrading packages</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#record-session">4.4.1. Recording the session</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#updating-lists">4.4.2. Updating the package list</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#sufficient-space">4.4.3. Make sure you have sufficient space for the upgrade</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#minimal-upgrade">4.4.4. Minimal system upgrade</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#upgrading-full">4.4.5. Upgrading the system</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.en.html#trouble">4.5. Possible issues during upgrade</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#immediate-configure">4.5.1. Dist-upgrade fails with <span class="quote">“<span class="quote">Could not perform immediate configuration</span>”</span></a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#expected-removals">4.5.2. Expected removals</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#conflicts-loops">4.5.3. Conflicts or Pre-Depends loops</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#file-conflicts">4.5.4. File conflicts</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#configuration-changes">4.5.5. Configuration changes</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#console-change">4.5.6. Change of session to console</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#package-specific-issues">4.5.7. Special care for specific packages</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.en.html#newkernel">4.6. Upgrading your kernel and related packages</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#kernel-metapackage">4.6.1. Installing a kernel metapackage</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#initramfs-tools-issues">4.6.2. Changes to root and <code class="filename">/usr</code> filesystem mounting and checking</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.en.html#nownownow">4.7. Things to do before rebooting</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#for-next">4.8. Preparing for the next release</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#purge-removed-packages">4.8.1. Purging removed packages</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.en.html#deprecated">4.9. Deprecated components</a></span></dt><dt><span class="section"><a href="ch-upgrading.en.html#obsolete">4.10. Obsolete packages</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.en.html#dummy">4.10.1. Dummy packages</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="backup"></a>4.1. Preparing for the upgrade</h2></div></div></div><p>
We suggest that before upgrading you also read the information in <a class="xref" href="ch-information.en.html" title="Chapter 5. Issues to be aware of for jessie">Chapter 5, <em>Issues to be aware of for jessie</em></a>.  That chapter covers potential issues which are not directly
related to the upgrade process but could still be important to know about
before you begin.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="data-backup"></a>4.1.1. Back up any data or configuration information</h3></div></div></div><p>
Before upgrading your system, it is strongly recommended that you make a full
backup, or at least back up any data or configuration information you can't
afford to lose.  The upgrade tools and process are quite reliable, but a
hardware failure in the middle of an upgrade could result in a severely damaged
system.
</p><p>
The main things you'll want to back up are the contents of
<code class="filename">/etc</code>, <code class="filename">/var/lib/dpkg</code>,
<code class="filename">/var/lib/apt/extended_states</code> and the output of
<code class="literal">dpkg --get-selections "*"</code> (the quotes are important).  If
you use <span class="command"><strong>aptitude</strong></span> to manage packages on your system, you
will also want to back up <code class="filename">/var/lib/aptitude/pkgstates</code>.
</p><p>
The upgrade process itself does not modify anything in the
<code class="filename">/home</code> directory.  However, some applications (e.g.  parts
of the Mozilla suite, and the GNOME and KDE desktop environments) are known to
overwrite existing user settings with new defaults when a new version of the
application is first started by a user.  As a precaution, you may want to make
a backup of the hidden files and directories (<span class="quote">“<span class="quote">dotfiles</span>”</span>) in users' home
directories.  This backup may help to restore or recreate the old settings.
You may also want to inform users about this.
</p><p>
Any package installation operation must be run with superuser privileges, so
either log in as <code class="literal">root</code> or use <span class="command"><strong>su</strong></span> or <span class="command"><strong>sudo</strong></span> to
gain the necessary access rights.
</p><p>
The upgrade has a few preconditions; you should check them before actually
executing the upgrade.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="inform-users"></a>4.1.2. Inform users in advance</h3></div></div></div><p>
It's wise to inform all users in advance of any upgrades you're planning,
although users accessing your system via an <span class="command"><strong>ssh</strong></span> connection
should notice little during the upgrade, and should be able to continue
working. 
</p><p>
If you wish to take extra precautions, back up or unmount the
<code class="filename">/home</code> partition before upgrading.
</p><p>
You will have to do a kernel upgrade when upgrading to jessie, so a
reboot will be necessary. 
Typically, this will be done after the upgrade is finished.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="services-downtime"></a>4.1.3. Prepare for downtime on services</h3></div></div></div><p>
There might be services that are offered by the system which are associated with packages
that will be included in the upgrade. If this is the case, please note that,
during the upgrade, these services will be stopped while their associated packages 
are being replaced and configured. During this time, these services will not be
available.
</p><p>
The precise downtime for these services will vary depending on the number of
packages being upgraded in the system, and it also includes the time the system
administrator spends answering any configuration questions from package
upgrades.  Notice that if the upgrade process is left unattended and
the system requests input during the upgrade there is a high
possibility of services being unavailable<a href="#ftn.idp49286960" class="footnote" id="idp49286960"><sup class="footnote">[1]</sup></a> for a significant period of time.
</p><p>
If the system being upgraded provides critical services for your users or the
network<a href="#ftn.idp49288208" class="footnote" id="idp49288208"><sup class="footnote">[2]</sup></a>, you can reduce the downtime if
you do a minimal system upgrade, as described in <a class="xref" href="ch-upgrading.en.html#minimal-upgrade" title="4.4.4. Minimal system upgrade">Section 4.4.4, “Minimal system upgrade”</a>, followed by a kernel upgrade and reboot,
and then upgrade the packages associated with your
critical services. Upgrade these packages  prior to doing the full upgrade
described in <a class="xref" href="ch-upgrading.en.html#upgrading-full" title="4.4.5. Upgrading the system">Section 4.4.5, “Upgrading the system”</a>.  This way you can ensure that
these critical services are running and available through the full upgrade
process, and their downtime is reduced.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="recovery"></a>4.1.4. Prepare for recovery</h3></div></div></div><p>
Although Debian tries to ensure that your system stays bootable at all times,
there is always a chance that you may experience problems
rebooting your system after the upgrade.  Known potential issues are
documented in this and the next chapters of these Release Notes.
</p><p>
For this reason it makes sense to ensure that you will be able to recover if
your system should fail to reboot or, for remotely managed systems, fail to
bring up networking.
</p><p>
If you are upgrading remotely via an <span class="command"><strong>ssh</strong></span> link it is
recommended that you take the necessary precautions to be able to access the
server through a remote serial terminal.  There is a chance that, after
upgrading the kernel and rebooting, you will have to fix the system
configuration through a local console.  Also, if the system is rebooted
accidentally in the middle of an upgrade there is a chance you will need to
recover using a local console.
</p><p>
Generally we recommend using the <span class="emphasis"><em>rescue
mode</em></span> of the jessie Debian Installer.  The advantage of using the
installer is that you can choose between its many methods to find one
that best suits your situation.  For more information, please consult the
section <span class="quote">“<span class="quote">Recovering a Broken System</span>”</span> in chapter 8 of the <a class="ulink" href="https://www.debian.org/releases/jessie/installmanual" target="_top">Installation
Guide</a> and the <a class="ulink" href="https://wiki.debian.org/DebianInstaller/FAQ" target="_top">Debian Installer FAQ</a>.
</p><p>
If that fails, you will need an alternative way to boot your system so you can
access and repair it.  One option is to use a special rescue image or a Linux
live CD.  After booting from that, you should be able to mount your root file
system and <code class="literal">chroot</code> into it to investigate and fix the
problem.
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="recovery-initrd"></a>4.1.4.1. Debug shell during boot using initrd</h4></div></div></div><p>
The <code class="systemitem">initramfs-tools</code><a id="idp49300416" class="indexterm"></a> package includes a debug
shell<a href="#ftn.idp49301296" class="footnote" id="idp49301296"><sup class="footnote">[3]</sup></a> in the
initrds it generates.  If for example the initrd is unable to mount your root
file system, you will be dropped into this debug shell which has basic commands
available to help trace the problem and possibly fix it.
</p><p>
Basic things to check are: presence of correct device files in
<code class="filename">/dev</code>; what modules are loaded (<code class="literal">cat
/proc/modules</code>); output of <span class="command"><strong>dmesg</strong></span> for errors loading
drivers.  The output of <span class="command"><strong>dmesg</strong></span> will also show what device
files have been assigned to which disks; you should check that against the
output of <code class="literal">echo $ROOT</code> to make sure that the root file system
is on the expected device.
</p><p>
If you do manage to fix the problem, typing <code class="literal">exit</code> will quit
the debug shell and continue the boot process at the point it failed.  Of
course you will also need to fix the underlying problem and regenerate the
initrd so the next boot won't fail again.
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="recovery-shell-systemd"></a>4.1.4.2. Debug shell during boot using systemd</h4></div></div></div><p>
    If the boot fails under systemd, it is possible to obtain a
    debug root shell by changing the kernel command line.  If the
    basic boot succeeds, but some services fail to start, it
    may be useful to add <code class="literal">systemd.unit=rescue.target</code>
    to the kernel parameters.
  </p><p>
    Otherwise, the kernel parameter
    <code class="literal">systemd.unit=emergency.target</code> will provide you
    with a root shell at the earliest possible point.  However, this
    is done before mounting the root file system with read-write
    permissions.  You will have to do that manually with:
  </p><pre class="screen">
mount -o remount,rw /
</pre><p>
    More information on debugging a broken boot under systemd
    can be found in the <a class="ulink" href="http://freedesktop.org/wiki/Software/systemd/Debugging/" target="_top">
    Diagnosing Boot Problems</a> article.
  </p><p>
    If everything else fails, you might be able to boot via the old
    sysvinit system.  This requires that <code class="systemitem">sysvinit</code><a id="idp49315712" class="indexterm"></a> is still installed and the
    binary <code class="filename">/lib/sysvinit/init</code> is included in your
    initramfs.  If these requirements are met, add
    <code class="literal">init=/lib/sysvinit/init</code> on the kernel
    command-line and it will boot with the sysvinit binary.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="upgrade-preparations"></a>4.1.5. Prepare a safe environment for the upgrade</h3></div></div></div><p>
The distribution upgrade should be done either locally from a textmode virtual
console (or a directly connected serial terminal), or remotely via an
<span class="command"><strong>ssh</strong></span> link. 
</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png" /></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>
  If you are using some VPN services (such as <code class="systemitem">tinc</code><a id="idp49322160" class="indexterm"></a>) they might not be available
  throughout the upgrade process. Please see 
  <a class="xref" href="ch-upgrading.en.html#services-downtime" title="4.1.3. Prepare for downtime on services">Section 4.1.3, “Prepare for downtime on services”</a>.
  </p></td></tr></table></div><p>
In order to gain extra safety margin when upgrading remotely, we suggest that
you run upgrade processes in the virtual console provided by the
<span class="command"><strong>screen</strong></span> program, which enables safe reconnection and ensures
the upgrade process is not interrupted even if the remote connection process
fails.
</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/important.png" /></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>
    You should <span class="emphasis"><em>not</em></span> upgrade using <span class="command"><strong>telnet</strong></span>,
    <span class="command"><strong>rlogin</strong></span>, <span class="command"><strong>rsh</strong></span>, or from an X
    session managed by <span class="command"><strong>xdm</strong></span>, <span class="command"><strong>gdm</strong></span>
    or <span class="command"><strong>kdm</strong></span> etc. on the machine you are upgrading.
    That is because each of those services may well be terminated
    during the upgrade, which can result in an
    <span class="emphasis"><em>inaccessible</em></span> system that is only half-upgraded.
    Use of the GNOME application <span class="command"><strong>update-manager</strong></span> is
    <span class="emphasis"><em>strongly discouraged</em></span> for upgrades to new releases, as
    this tool relies on the desktop session remaining active.
  </p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="system-status"></a>4.2. Checking system status</h2></div></div></div><p>
The upgrade process described in this chapter has been designed for upgrades
from <span class="quote">“<span class="quote">pure</span>”</span> wheezy systems without third-party packages.
For the greatest reliability of the
upgrade process, you may wish to remove third-party packages from your system
before you begin upgrading.
</p><p>
Direct upgrades from Debian releases older than 7 (wheezy)
are not supported.
Please follow the instructions in the <a class="ulink" href="https://www.debian.org/releases/wheezy/releasenotes" target="_top">Release
Notes for Debian 7</a> to upgrade to 7 first.
</p><p>
This procedure also assumes your system has been updated to the latest point
release of wheezy.  If you have not done this or are unsure, follow the
instructions in <a class="xref" href="ap-old-stuff.en.html#old-upgrade" title="A.1. Upgrading your wheezy system">Section A.1, “Upgrading your wheezy system”</a>.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="review-actions"></a>4.2.1. Review actions pending in package manager</h3></div></div></div><p>
In some cases, the use of <span class="command"><strong>apt-get</strong></span> for installing packages
instead of <span class="command"><strong>aptitude</strong></span> might make <span class="command"><strong>aptitude</strong></span>
consider a package as <span class="quote">“<span class="quote">unused</span>”</span> and schedule it for removal.  In general, you
should make sure the system is fully up-to-date and <span class="quote">“<span class="quote">clean</span>”</span> before proceeding
with the upgrade.
</p><p>
Because of this you should review if there are any pending actions in the
package manager <span class="command"><strong>aptitude</strong></span>.  If a package is scheduled for
removal or update in the package manager, it might negatively impact the
upgrade procedure.  Note that correcting this is only possible if your
<code class="filename">sources.list</code> still points to <span class="emphasis"><em>wheezy</em></span>
and not to <span class="emphasis"><em>stable</em></span> or <span class="emphasis"><em>jessie</em></span>; see <a class="xref" href="ap-old-stuff.en.html#old-sources" title="A.2. Checking your sources list">Section A.2, “Checking your sources list”</a>.
</p><p>
To perform this review, launch <span class="command"><strong>aptitude</strong></span> in <span class="quote">“<span class="quote">visual mode</span>”</span> and
press <span class="keycap"><strong>g</strong></span> (<span class="quote">“<span class="quote">Go</span>”</span>).  If it shows any actions, you should review them and either fix
them or implement the suggested actions.  If no actions are suggested you will
be presented with a message saying <span class="quote">“<span class="quote">No packages are scheduled to be installed,
removed, or upgraded</span>”</span>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="disable-apt-pinning"></a>4.2.2. Disabling APT pinning</h3></div></div></div><p>
If you have configured APT to install certain packages from a distribution
other than stable (e.g.  from testing), you may have to change your APT pinning
configuration (stored in <code class="filename">/etc/apt/preferences</code> and <code class="filename">/etc/apt/preferences.d/</code>) to allow
the upgrade of packages to the versions in the new stable release.  Further
information on APT pinning can be found in <span class="citerefentry"><span class="refentrytitle">apt_preferences</span>(5)</span>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="package-status"></a>4.2.3. Checking packages status</h3></div></div></div><p>
Regardless of the method used for upgrading, it is recommended that you check
the status of all packages first, and verify that all packages are in an
upgradable state.  The following command will show any packages which have a
status of Half-Installed or Failed-Config, and those with any error status.
</p><pre class="screen">
# dpkg --audit
</pre><p>
You could also inspect the state of all packages on your system using
<span class="command"><strong>aptitude</strong></span> or with commands such
as
</p><pre class="screen">
# dpkg -l | pager
</pre><p>
or
</p><pre class="screen">
# dpkg --get-selections "*" &gt; ~/curr-pkgs.txt
</pre><p>
It is desirable to remove any holds before upgrading.  If any package that is
essential for the upgrade is on hold, the upgrade will fail.
</p><p>
Note that <span class="command"><strong>aptitude</strong></span> uses a different method for registering
packages that are on hold than <span class="command"><strong>apt-get</strong></span> and
<span class="command"><strong>dselect</strong></span>.  You can identify packages on hold for
<span class="command"><strong>aptitude</strong></span> with
</p><pre class="screen">
# aptitude search "~ahold" 
</pre><p>
If you want to check which packages you had on hold for
<span class="command"><strong>apt-get</strong></span>, you should use
</p><pre class="screen">
# dpkg --get-selections | grep 'hold$'
</pre><p>
If you changed and recompiled a package locally, and didn't rename it or put an
epoch in the version, you must put it on hold to prevent it from being
upgraded.
</p><p>
The <span class="quote">“<span class="quote">hold</span>”</span> package state for <span class="command"><strong>apt-get</strong></span> can be changed using:
</p><pre class="screen">
# echo <em class="replaceable"><code>package_name</code></em> hold | dpkg --set-selections
</pre><p>
Replace <code class="literal">hold</code> with <code class="literal">install</code> to unset the
<span class="quote">“<span class="quote">hold</span>”</span> state.
</p><p>
If there is anything you need to fix, it is best to make sure your
<code class="filename">sources.list</code> still refers to wheezy as explained in <a class="xref" href="ap-old-stuff.en.html#old-sources" title="A.2. Checking your sources list">Section A.2, “Checking your sources list”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proposed-updates"></a>4.2.4. The proposed-updates section</h3></div></div></div><p>
    If you have listed the <code class="literal">proposed-updates</code> section
    in your <code class="filename">/etc/apt/sources.list</code> file, you
    should remove it from that file before attempting to upgrade your
    system.  This is a precaution to reduce the likelihood of
    conflicts.
  </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="unofficial-sources"></a>4.2.5. Unofficial sources</h3></div></div></div><p>
If you have any non-Debian packages on your system, you should be aware that
these may be removed during the upgrade because of conflicting dependencies.
If these packages were installed by adding an extra package archive in your
<code class="filename">/etc/apt/sources.list</code>, you should check if that archive
also offers packages compiled for jessie and change the source line accordingly
at the same time as your source lines for Debian packages.
</p><p>
Some users may have <span class="emphasis"><em>unofficial</em></span> backported <span class="quote">“<span class="quote">newer</span>”</span> versions of packages that
<span class="emphasis"><em>are</em></span> in Debian installed on their wheezy system.  Such
packages are most likely to cause problems during an upgrade as they may result
in file conflicts<a href="#ftn.idp49380336" class="footnote" id="idp49380336"><sup class="footnote">[4]</sup></a>.
<a class="xref" href="ch-upgrading.en.html#trouble" title="4.5. Possible issues during upgrade">Section 4.5, “Possible issues during upgrade”</a> has some information on how to deal with file
conflicts if they should occur.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="upgrade-process"></a>4.3. Preparing sources for APT</h2></div></div></div><p>
Before starting the upgrade you must set up <code class="systemitem">apt</code><a id="idp49384256" class="indexterm"></a>'s configuration file for package lists,
<code class="filename">/etc/apt/sources.list</code>.
</p><p>
<code class="systemitem">apt</code><a id="idp49386992" class="indexterm"></a> will consider all packages that can
be found via any <span class="quote">“<span class="quote"><code class="literal">deb</code></span>”</span> line, and install the package with the
highest version number, giving priority to the first line in the
file (thus where you have multiple mirror locations, you'd typically first name a local
hard disk, then <acronym title="Compact Disc Read Only Memory">CD-ROM</acronym>s, and then HTTP/FTP mirrors).
</p><p>
A release can often be referred to both by its codename (e.g.
<code class="literal">wheezy</code>, <code class="literal">jessie</code>) and by
its status name (i.e. <code class="literal">oldstable</code>, <code class="literal">stable</code>,
<code class="literal">testing</code>, <code class="literal">unstable</code>).  Referring to
a release by its codename has the advantage that you will never be surprised by
a new release and for this reason is the approach taken here.  It does of
course mean that you will have to watch out for release announcements yourself.
If you use the status name instead, you will just see loads of updates for
packages available as soon as a release has happened.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="network"></a>4.3.1. Adding APT Internet sources</h3></div></div></div><p>
The default configuration is set up for installation from the main Debian Internet
servers, but you may wish to modify <code class="filename">/etc/apt/sources.list</code>
to use other mirrors, preferably a mirror that is closest to you in network terms.
</p><p>
Debian HTTP or FTP mirror addresses can be found at <a class="ulink" href="https://www.debian.org/distrib/ftplist" target="_top">https://www.debian.org/distrib/ftplist</a> (look at the <span class="quote">“<span class="quote">list of Debian
mirrors</span>”</span> section).  HTTP mirrors are generally speedier than FTP mirrors.
</p><p>
For example, suppose your closest Debian mirror is
<code class="literal">http://mirrors.kernel.org</code>.  When inspecting that
mirror with a web browser or FTP program, you will notice that the main
directories are organized like this:
</p><pre class="programlisting">
http://mirrors.kernel.org/debian/dists/jessie/main/binary-<span class="phrase">amd64</span>/...
http://mirrors.kernel.org/debian/dists/jessie/contrib/binary-<span class="phrase">amd64</span>/...
</pre><p>
To use this mirror with <code class="systemitem">apt</code><a id="idp49402912" class="indexterm"></a>, you add this line to your
<code class="filename">sources.list</code> file:
</p><pre class="programlisting">deb http://mirrors.kernel.org/debian jessie main contrib</pre><p>
Note that the <span class="quote">“<span class="quote"><code class="literal">dists</code></span>”</span> is added implicitly, and the arguments
after the release name are used to expand the path into multiple directories.
</p><p>
After adding your new sources, disable the previously existing
<span class="quote">“<span class="quote"><code class="literal">deb</code></span>”</span> lines in <code class="filename">sources.list</code> by placing a
hash sign (<code class="literal">#</code>) in front of them.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="localmirror"></a>4.3.2. Adding APT sources for a local mirror</h3></div></div></div><p>
Instead of using HTTP or FTP package mirrors, you may wish to modify
<code class="filename">/etc/apt/sources.list</code> to use a mirror on a local disk
(possibly mounted over <acronym title="Network File System">NFS</acronym>).
</p><p>
For example, your package mirror may be under
<code class="filename">/var/ftp/debian/</code>, and have main directories like this:
</p><pre class="programlisting">
/var/ftp/debian/dists/jessie/main/binary-<span class="phrase">amd64</span>/...
/var/ftp/debian/dists/jessie/contrib/binary-<span class="phrase">amd64</span>/...
</pre><p>
To use this with <code class="systemitem">apt</code><a id="idp49416576" class="indexterm"></a>, add this line to your
<code class="filename">sources.list</code> file:
</p><pre class="programlisting">deb file:/var/ftp/debian jessie main contrib</pre><p>
Note that the <span class="quote">“<span class="quote"><code class="literal">dists</code></span>”</span> is added implicitly, and the arguments
after the release name are used to expand the path into multiple directories.
</p><p>
After adding your new sources, disable the previously existing
<span class="quote">“<span class="quote"><code class="literal">deb</code></span>”</span> lines in <code class="filename">sources.list</code> by placing a
hash sign (<code class="literal">#</code>) in front of them.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="cdroms"></a>4.3.3. Adding APT sources from optical media</h3></div></div></div><p>
If you want to use <span class="emphasis"><em>only</em></span> CDs (or DVDs or Blu-ray Discs),
comment out the existing
<span class="quote">“<span class="quote"><code class="literal">deb</code></span>”</span> lines in <code class="filename">/etc/apt/sources.list</code> by
placing a hash sign (<code class="literal">#</code>) in front of them.
</p><p>
Make sure there is a line in <code class="filename">/etc/fstab</code> that enables
mounting your CD-ROM drive at the <code class="filename">/media/cdrom</code>
mount point.  For example, if <code class="filename">/dev/sr0</code>
is your CD-ROM drive, <code class="filename">/etc/fstab</code> should contain a line
like:
</p><pre class="programlisting">
/dev/sr0 /media/cdrom auto noauto,ro 0 0
</pre><p>
Note that there must be <span class="emphasis"><em>no spaces</em></span> between the words
<code class="literal">noauto,ro</code> in the fourth field.
</p><p>
To verify it works, insert a CD and try running
</p><pre class="screen">
# mount /media/cdrom    # this will mount the CD to the mount point
# ls -alF /media/cdrom  # this should show the CD's root directory
# umount /media/cdrom   # this will unmount the CD
</pre><p>
Next, run:
</p><pre class="screen">
# apt-cdrom add
</pre><p>
for each Debian Binary CD-ROM you have, to add the data about each CD to APT's
database.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="upgradingpackages"></a>4.4. Upgrading packages</h2></div></div></div><p>
The recommended way to upgrade from previous Debian releases is to
use the package management tool <span class="command"><strong>apt-get</strong></span>.  In previous
releases, <span class="command"><strong>aptitude</strong></span> was recommended for this purpose, but
recent versions of <span class="command"><strong>apt-get</strong></span> provide equivalent
functionality and also have shown to more consistently give the desired
upgrade results.
</p><p>
Don't forget to mount all needed partitions (notably the root and
<code class="filename">/usr</code> partitions) read-write, with a command like:
</p><pre class="screen">
# mount -o remount,rw /<em class="replaceable"><code>mountpoint</code></em>
</pre><p>
Next you should double-check that the APT source entries (in
<code class="filename">/etc/apt/sources.list</code>) refer either to
<span class="quote">“<span class="quote"><code class="literal">jessie</code></span>”</span> or to <span class="quote">“<span class="quote"><code class="literal">stable</code></span>”</span>.  There should not be
any sources entries pointing to wheezy.
</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
    Source lines for a CD-ROM might sometimes refer to
    <span class="quote">“<span class="quote"><code class="literal">unstable</code></span>”</span>; although this may be confusing, you
    should <span class="emphasis"><em>not</em></span> change it.
  </p></td></tr></table></div><p>
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="record-session"></a>4.4.1. Recording the session</h3></div></div></div><p>
It is strongly recommended that you use the <span class="command"><strong>/usr/bin/script</strong></span>
program to record a transcript of the upgrade session.  Then if a problem
occurs, you will have a log of what happened, and if needed, can provide exact
information in a bug report.  To start the recording, type:
</p><pre class="screen">
# script -t 2&gt;~/upgrade-jessie<em class="replaceable"><code>step</code></em>.time -a ~/upgrade-jessie<em class="replaceable"><code>step</code></em>.script
</pre><p>
or similar. If you have to rerun the typescript (e.g. if you have to reboot the
system) use different <em class="replaceable"><code>step</code></em> values to indicate which
step of the upgrade you are logging. Do not put the typescript file in a
temporary directory such as <code class="filename">/tmp</code> or
<code class="filename">/var/tmp</code> (files in those directories may be deleted during
the upgrade or during any restart).
</p><p>
The typescript will also allow you to review information that has scrolled
off-screen.  If you are at the system's console, just switch to VT2 (using
<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span>)
and, after logging in, use
<code class="literal">less -R ~root/upgrade-jessie.script</code> to view
the file.
</p><p>
After you have completed the upgrade, you can stop <span class="command"><strong>script</strong></span> by
typing <code class="literal">exit</code> at the prompt.
</p><p>
If you have used the <span class="emphasis"><em>-t</em></span> switch for
<span class="command"><strong>script</strong></span> you can use the <span class="command"><strong>scriptreplay</strong></span>
program to replay the whole session:
</p><pre class="screen">
# scriptreplay ~/upgrade-jessie.time ~/upgrade-jessie.script
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="updating-lists"></a>4.4.2. Updating the package list</h3></div></div></div><p>
First the list of available packages for the new release needs to be fetched.
This is done by executing:
</p><pre class="screen">
# apt-get update
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sufficient-space"></a>4.4.3. Make sure you have sufficient space for the upgrade</h3></div></div></div><p>
You have to make sure before upgrading your system that you will have sufficient
hard disk space when you start the full system upgrade described in <a class="xref" href="ch-upgrading.en.html#upgrading-full" title="4.4.5. Upgrading the system">Section 4.4.5, “Upgrading the system”</a>.  First, any package needed for installation that
is fetched from the network is stored in
<code class="filename">/var/cache/apt/archives</code> (and the
<code class="filename">partial/</code> subdirectory, during download), so you must make
sure you have enough space on the file system partition that holds
<code class="filename">/var/</code> to temporarily download the packages that will be
installed in your system.  After the download, you will probably need more
space in other file system partitions in order to both install upgraded
packages (which might contain bigger binaries or more data) and new packages
that will be pulled in for the upgrade.  If your system does not have
sufficient space you might end up with an incomplete upgrade that is
difficult to recover from.
</p><p>
<span class="command"><strong>apt-get</strong></span> can show you detailed information about the disk
space needed for the installation.  Before executing the upgrade, you can see
this estimate by running:
</p><pre class="screen">
# apt-get -o APT::Get::Trivial-Only=true dist-upgrade
[ ... ]
XXX upgraded, XXX newly installed, XXX to remove and XXX not upgraded.
Need to get xx.xMB of archives. 
After this operation, AAAMB of additional disk space will be used.
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
Running this command at the beginning of the upgrade process
may give an error, for the reasons described in the next sections.  In that
case you will need to wait until you've done the minimal system upgrade as in
<a class="xref" href="ch-upgrading.en.html#minimal-upgrade" title="4.4.4. Minimal system upgrade">Section 4.4.4, “Minimal system upgrade”</a> before running this command to estimate the
disk space.
</p></td></tr></table></div><p>
If you do not have enough space for the upgrade, <span class="command"><strong>apt-get</strong></span>
will warn you with a message like this:
</p><pre class="screen">
E: You don't have enough free space in /var/cache/apt/archives/.
</pre><p>In this situation, make sure you free up space
beforehand.  You can:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
Remove packages that have been previously downloaded for installation (at
<code class="filename">/var/cache/apt/archives</code>).  Cleaning up the package cache by
running <span class="command"><strong>apt-get clean</strong></span> will remove all previously downloaded
package files.
</p></li><li class="listitem"><p>
Remove forgotten packages.  If you have
used <span class="command"><strong>aptitude</strong></span> or <span class="command"><strong>apt-get</strong></span> to manually
install packages in wheezy it will have kept track of those packages
you manually installed, and will be able to mark as redundant those packages
pulled in by dependencies alone which are no longer needed due to a package
being removed. They will not mark for removal packages that you manually
installed. To remove automatically installed packages that are no longer used,
run:
</p><pre class="screen">
# apt-get autoremove
</pre><p>
You can also use <span class="command"><strong>deborphan</strong></span>, <span class="command"><strong>debfoster</strong></span>, or
<span class="command"><strong>cruft</strong></span> to find redundant packages.
Do not blindly remove the packages these tools present,
especially if you are using aggressive non-default options that are prone to
false positives.  It is highly recommended that you manually review the
packages suggested for removal (i.e.  their contents, sizes, and descriptions)
before you remove them.
</p></li><li class="listitem"><p>
Remove packages that take up too much space and are not currently
needed (you can always reinstall them after the upgrade).  If you have
<code class="systemitem">popularity-contest</code><a id="idp49485776" class="indexterm"></a> installed, you can use
<span class="command"><strong>popcon-largest-unused</strong></span> to list the packages you do not use
that occupy the most space.  You can find the packages that just
take up the most disk space with <span class="command"><strong>dpigs</strong></span> (available in the
<code class="systemitem">debian-goodies</code><a id="idp49489040" class="indexterm"></a> package) or with
<span class="command"><strong>wajig</strong></span> (running <code class="literal">wajig size</code>).
They can also be found with
<code class="systemitem">aptitude</code><a id="idp49492192" class="indexterm"></a>.  Start
<span class="command"><strong>aptitude</strong></span> in <span class="quote">“<span class="quote">visual mode</span>”</span>,
select <span class="guimenu">Views</span> → <span class="guimenuitem">New Flat Package
List</span>, press <span class="keycap"><strong>l</strong></span> and enter
<code class="literal">~i</code>, then press <span class="keycap"><strong>S</strong></span> and enter
<code class="literal">~installsize</code>.  This will give you a handy list to work
with. 
</p></li><li class="listitem"><p>
  Remove translations and localization files from the system if they
  are not needed.  You can install the <code class="systemitem">localepurge</code><a id="idp49500544" class="indexterm"></a> package and configure it so
  that only a few selected locales are kept in the system. This will
  reduce the disk space consumed at
  <code class="filename">/usr/share/locale</code>.
</p></li><li class="listitem"><p>
   Temporarily move to another system, or permanently remove, system logs
   residing under <code class="filename">/var/log/</code>.
</p></li><li class="listitem"><p>
    Use a temporary <code class="filename">/var/cache/apt/archives</code>: You
    can use a temporary cache directory from another filesystem
    (<acronym title="Universal Serial Bus">USB</acronym> storage device, temporary hard disk,
    filesystem already in use, ...)
  </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
      Do not use an <acronym title="Network File System">NFS</acronym> mount as the network
      connection could be interrupted during the upgrade.
    </p></td></tr></table></div><p>
  For example, if you have a <acronym title="Universal Serial Bus">USB</acronym> drive mounted on <code class="filename">/media/usbkey</code>:
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	remove the packages that have been previously downloaded for
	installation:

	</p><pre class="screen"># apt-get clean</pre><p>
      </p></li><li class="listitem"><p>
	copy the directory
	<code class="filename">/var/cache/apt/archives</code> to the
	<acronym title="Universal Serial Bus">USB</acronym> drive:

	</p><pre class="screen"># cp -ax /var/cache/apt/archives /media/usbkey/</pre><p>
      </p></li><li class="listitem"><p>
	mount the temporary cache directory on the current one:

	</p><pre class="screen"># mount --bind /media/usbkey/archives /var/cache/apt/archives</pre><p>
      </p></li><li class="listitem"><p>
	after the upgrade, restore the original
	<code class="filename">/var/cache/apt/archives</code> directory:

	</p><pre class="screen"># umount /media/usbkey/archives</pre><p>
      </p></li><li class="listitem"><p>
	remove the remaining <code class="filename">/media/usbkey/archives</code>.
      </p></li></ol></div><p>
  You can create the temporary cache directory on whatever filesystem
  is mounted on your system.
  </p></li><li class="listitem"><p>
    Do a minimal upgrade of the system (see <a class="xref" href="ch-upgrading.en.html#minimal-upgrade" title="4.4.4. Minimal system upgrade">Section 4.4.4, “Minimal system upgrade”</a>)
    or partial upgrades of the system followed by a full upgrade.
    This will make it possible to upgrade the system partially, and
    allow you to clean the package cache before the full upgrade.
  </p></li></ul></div><p>
Note that in order to safely remove packages, it is advisable to switch your
<code class="filename">sources.list</code> back to wheezy as described in <a class="xref" href="ap-old-stuff.en.html#old-sources" title="A.2. Checking your sources list">Section A.2, “Checking your sources list”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="minimal-upgrade"></a>4.4.4. Minimal system upgrade</h3></div></div></div><p>
In some cases, doing the full upgrade (as described below) directly might
remove large numbers of packages that you will want to keep.  We therefore
recommend a two-part upgrade process: first a minimal upgrade to overcome these
conflicts, then a full upgrade as described in <a class="xref" href="ch-upgrading.en.html#upgrading-full" title="4.4.5. Upgrading the system">Section 4.4.5, “Upgrading the system”</a>. 
</p><p>
To do this, first run:
</p><pre class="screen">
# apt-get upgrade
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
      The upgrade process for some previous releases recommended the
      use of <span class="command"><strong>aptitude</strong></span> for the upgrade. This
      tool is not recommended for upgrades from wheezy to
      jessie.
    </p></td></tr></table></div><p>
This has the effect of upgrading those packages which can be upgraded without
requiring any other packages to be removed or installed.
</p><p>
The minimal system upgrade can also be useful when the system is tight on space
and a full upgrade cannot be run due to space constraints.
</p><p>
  If the <code class="systemitem">apt-listchanges</code><a id="idp49530448" class="indexterm"></a> package is
  installed, it will (in its default configuration) show important information
  about upgraded packages in a pager.  Press <span class="keycap"><strong>q</strong></span> after reading
  to exit the pager and continue the upgrade.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="upgrading-full"></a>4.4.5. Upgrading the system</h3></div></div></div><p>
Once you have taken the previous steps, you are now ready to continue
with the main part of the upgrade.  Execute:
</p><pre class="screen">
# apt-get dist-upgrade
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.png" /></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>
      The upgrade process for some previous releases recommended the
      use of <span class="command"><strong>aptitude</strong></span> for the upgrade. This
      tool is not recommended for upgrades from wheezy to
      jessie.
    </p></td></tr></table></div><p>
This will perform a complete upgrade of the system, installing the newest
available versions of all packages, and resolving all possible dependency changes
between packages in different releases.  If necessary, it will install some new
packages (usually new library versions, or renamed packages), and remove any
conflicting obsoleted packages.
</p><p>
When upgrading from a set of CD-ROMs (or DVDs), you will be asked to insert specific CDs
at several points during the upgrade.  You might have to insert the same CD
multiple times; this is due to inter-related packages that have been spread out
over the CDs.
</p><p>
New versions of currently installed packages that cannot be upgraded without
changing the install status of another package will be left at their current
version (displayed as <span class="quote">“<span class="quote">held back</span>”</span>).  This can be resolved by either using
<span class="command"><strong>aptitude</strong></span> to choose these packages for installation or by
trying <code class="literal">apt-get install
<em class="replaceable"><code>package</code></em></code>.
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="trouble"></a>4.5. Possible issues during upgrade</h2></div></div></div><p>
The following sections describe known issues that might appear
during an upgrade to jessie.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="immediate-configure"></a>4.5.1. Dist-upgrade fails with <span class="quote">“<span class="quote">Could not perform immediate configuration</span>”</span></h3></div></div></div><p>
In some cases the <span class="command"><strong>apt-get dist-upgrade</strong></span> step can fail after
downloading packages with:
</p><pre class="screen">
E: Could not perform immediate configuration on '<em class="replaceable"><code>package</code></em>'.  Please see man 5 apt.conf under APT::Immediate-Configure for details.
</pre><p>
</p><p>
If that happens, running <span class="command"><strong>apt-get dist-upgrade -o
APT::Immediate-Configure=0</strong></span> instead should allow the upgrade
to proceed.
</p><p>
Another possible workaround for this problem is to temporarily add both
wheezy and jessie sources to your
<code class="filename">sources.list</code> and run <span class="command"><strong>apt-get update</strong></span>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="expected-removals"></a>4.5.2. Expected removals</h3></div></div></div><p>
The upgrade process to jessie might ask for the removal of
packages on the system. The precise list of packages will vary depending on the
set of packages that you have installed.  These release notes give general
advice on these removals, but if in doubt, it is recommended that you examine
the package removals proposed by each method before proceeding.
For more information about packages obsoleted in jessie, see <a class="xref" href="ch-upgrading.en.html#obsolete" title="4.10. Obsolete packages">Section 4.10, “Obsolete packages”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="conflicts-loops"></a>4.5.3. Conflicts or Pre-Depends loops</h3></div></div></div><p>
Sometimes it's necessary to enable the <code class="literal">APT::Force-LoopBreak</code>
option in APT to be able to temporarily remove an essential package due to a
Conflicts/Pre-Depends loop.  <span class="command"><strong>apt-get</strong></span> will alert you of this
and abort the upgrade.  You can work around this by specifying the option <code class="literal">-o
APT::Force-LoopBreak=1</code> on the <span class="command"><strong>apt-get</strong></span> command
line.
</p><p>
It is possible that a system's dependency structure can be so corrupt as to
require manual intervention.  Usually this means using
<span class="command"><strong>apt-get</strong></span> or
</p><pre class="screen">
# dpkg --remove <em class="replaceable"><code>package_name</code></em>
</pre><p>
to eliminate some of the offending packages, or
</p><pre class="screen">
# apt-get -f install
# dpkg --configure --pending
</pre><p>
In extreme cases you might have to force re-installation with a command like
</p><pre class="screen">
# dpkg --install <em class="replaceable"><code>/path/to/package_name.deb</code></em>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="file-conflicts"></a>4.5.4. File conflicts</h3></div></div></div><p>
File conflicts should not occur if you upgrade from a <span class="quote">“<span class="quote">pure</span>”</span> wheezy system, but
can occur if you have unofficial backports installed.  A file conflict will
result in an error like:
</p><pre class="screen">
Unpacking <em class="replaceable"><code>&lt;package-foo&gt;</code></em> (from <em class="replaceable"><code>&lt;package-foo-file&gt;</code></em>) ...
dpkg: error processing <em class="replaceable"><code>&lt;package-foo&gt;</code></em> (--install):
 trying to overwrite `<em class="replaceable"><code>&lt;some-file-name&gt;</code></em>',
 which is also in package <em class="replaceable"><code>&lt;package-bar&gt;</code></em>
dpkg-deb: subprocess paste killed by signal (Broken pipe)
 Errors were encountered while processing:
 <em class="replaceable"><code>&lt;package-foo&gt;</code></em>
</pre><p>
You can try to solve a file conflict by forcibly removing the package mentioned
on the <span class="emphasis"><em>last</em></span> line of the error message:
</p><pre class="screen">
# dpkg -r --force-depends <em class="replaceable"><code>package_name</code></em>
</pre><p>
After fixing things up, you should be able to resume the upgrade by repeating
the previously described <span class="command"><strong>apt-get</strong></span> commands.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-changes"></a>4.5.5. Configuration changes</h3></div></div></div><p>
During the upgrade, you will be asked questions regarding the configuration
or re-configuration of several packages.  When you are asked if any file in
the <code class="filename">/etc/init.d</code> directory, or the
<code class="filename">/etc/manpath.config</code> file should be replaced by the
package maintainer's version, it's usually necessary to answer <span class="quote">“<span class="quote">yes</span>”</span> to
ensure system consistency.  You can always revert to the old versions, since
they will be saved with a <code class="literal">.dpkg-old</code> extension.
</p><p>
If you're not sure what to do, write down the name of the package or file and
sort things out at a later time.  You can search in the typescript file to
review the information that was on the screen during the upgrade.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="console-change"></a>4.5.6. Change of session to console</h3></div></div></div><p>
If you are running the upgrade using the system's local console you
might find that at some points during the upgrade the console is shifted over
to a different view and you lose visibility of the upgrade
process.  For example, this may happen in desktop systems when
the display manager is restarted.
</p><p>
To recover the console where the upgrade was running you will have to use
<span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span>
(if in the graphical startup screen) or
<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span>
(if in the local text-mode console) to switch back to the virtual terminal 1.
Replace F1 with the function key with the
same number as the virtual terminal the upgrade was running in. You can also
use <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>Left Arrow</strong></span> or
<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>Right
Arrow</strong></span> to switch between the different text-mode terminals.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="package-specific-issues"></a>4.5.7. Special care for specific packages</h3></div></div></div><p>
In most cases, packages should upgrade smoothly between wheezy
and jessie.  There are a small number of cases where some intervention
may be required, either before or during the upgrade; these are detailed
below on a per-package basis.
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="issues-systemd"></a>4.5.7.1. systemd</h4></div></div></div><p>
    The Debian upgrade from wheezy to jessie
    will by default migrate your init system from the SysV to systemd.
    Depending on your system and setup, you may need to do some
    manual changes.  We have detailed known issues in <a class="xref" href="ch-information.en.html#systemd-upgrade-default-init-system" title="5.6. Upgrading installs the new default init system for Jessie">Section 5.6, “Upgrading installs the new default init system for Jessie”</a>.
  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="issues-lxc"></a>4.5.7.2. LXC</h4></div></div></div><p>
    If you have LXC installed, you may need special care when
    upgrading your system and your containers.  Please have a
    look at <a class="xref" href="ch-information.en.html#lxc-upgrade-issues" title="5.8. Upgrade considerations for LXC hosts and containers">Section 5.8, “Upgrade considerations for LXC hosts and containers”</a> for known
    issues and solutions.
  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="newkernel"></a>4.6. Upgrading your kernel and related packages</h2></div></div></div><p>
This section explains how to upgrade your kernel and identifies potential
issues related to this upgrade.  You can either install one of the <code class="systemitem">linux-image-*</code><a id="idp49594736" class="indexterm"></a> packages provided by Debian, or
compile a customized kernel from source.
</p><p>
Note that a lot of information in this section is based on the assumption that
you will be using one of the modular Debian kernels, together with <code class="systemitem">initramfs-tools</code><a id="idp49597040" class="indexterm"></a> and <code class="systemitem">udev</code><a id="idp49598736" class="indexterm"></a>.  If you choose to use a custom kernel that
does not require an initrd or if you use a different initrd generator, some of
the information may not be relevant for you.
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kernel-metapackage"></a>4.6.1. Installing a kernel metapackage</h3></div></div></div><p>
When you dist-upgrade from wheezy to jessie, it is
strongly recommended that you install a linux-image-* metapackage, if
you have not done so before.  These metapackages will automatically
pull in a newer version of the kernel during upgrades.  You can verify
whether you have one installed by running:
</p><pre class="screen">
# dpkg -l "linux-image*" | grep ^ii | grep -i meta
</pre><p>
If you do not see any output, then you will either need to install a
new linux-image package by hand or install a linux-image metapackage.
To see a list of available linux-image metapackages, run:
</p><pre class="screen">
# apt-cache search linux-image- | grep -i meta | grep -v transition
</pre><p>
If you are unsure about which package to select, run <code class="literal">uname
-r</code> and look for a package with a similar name.  For example, if you
see '<code class="literal">2.6.32-5-amd64</code>', it is recommended that you install
<code class="systemitem">linux-image-amd64</code><a id="idp49606256" class="indexterm"></a>.
You may also use <span class="command"><strong>apt-cache</strong></span> to see a long
description of each package in order to help choose the best one
available.  For example:
</p><pre class="screen">
# apt-cache show linux-image-amd64
</pre><p>
You should then use <code class="literal">apt-get install</code> to install it.
Once this new kernel is installed you should reboot at the next
available opportunity to get the benefits provided by the new kernel
version.  However, please have a look at <a class="xref" href="ch-upgrading.en.html#nownownow" title="4.7. Things to do before rebooting">Section 4.7, “Things to do before rebooting”</a>
before performing the first reboot after the upgrade.
</p><p>
For the more adventurous there is an easy way to compile your own custom
kernel on Debian.  Install the kernel sources, provided in the <code class="systemitem">linux-source</code><a id="idp49611920" class="indexterm"></a> package.  You can make use of the
<code class="literal">deb-pkg</code> target available in the sources' makefile for
building a binary package.  More information can be found in the <a class="ulink" href="http://kernel-handbook.alioth.debian.org/" target="_top">Debian Linux Kernel
Handbook</a>, which can also be found as the <code class="systemitem">debian-kernel-handbook</code><a id="idp49615232" class="indexterm"></a> package.
</p><p>
If possible, it is to your advantage to upgrade the kernel package separately
from the main <code class="literal">dist-upgrade</code> to reduce the chances of a
temporarily non-bootable system.
Note that this should only be done after the
minimal upgrade process described in <a class="xref" href="ch-upgrading.en.html#minimal-upgrade" title="4.4.4. Minimal system upgrade">Section 4.4.4, “Minimal system upgrade”</a>.
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="initramfs-tools-issues"></a>4.6.2. Changes to root and <code class="filename">/usr</code> filesystem mounting and checking</h3></div></div></div><p>
    <code class="systemitem">initramfs-tools</code><a id="idp49620992" class="indexterm"></a> will now also run
    <code class="literal">fsck</code> on the root filesystem before mounting it.
    If the chosen init program is <code class="literal">systemd</code> and there
    is a separate <code class="filename">/usr</code> filesystem, it will also
    fsck and mount <code class="filename">/usr</code>.
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	If <code class="filename">/usr</code> is a separate filesystem on a
	RAID device and the <code class="literal">INITRDSTART</code> setting in
	<code class="filename">/etc/default/mdadm</code> is not
	'<code class="literal">all</code>', you will need to change it to
	include that device.
      </p></li><li class="listitem"><p>
	If <code class="filename">/usr</code> is a separate filesystem on an
	LVM logical volume, and the line for <code class="filename">/usr</code>
	in <code class="filename">/etc/fstab</code> specifies the device by
	<code class="literal">UUID</code> or <code class="literal">LABEL</code>, you must
	change this line to specify the device using the format
	<code class="filename">/dev/mapper/<em class="replaceable"><code>VG</code></em>-<em class="replaceable"><code>LV</code></em></code>
	or
	<code class="filename">/dev/<em class="replaceable"><code>VG</code></em>/<em class="replaceable"><code>LV</code></em></code>.
      </p></li><li class="listitem"><p>
	It is no longer possible to bind-mount the
	<code class="filename">/usr</code> filesystem.
      </p></li><li class="listitem"><p>
	If the RTC (real time clock) is set to local time and the
	local time is ahead of UTC, <code class="literal">e2fsck</code> will
	print a warning during boot about the time changing backward
	(<a class="ulink" href="https://bugs.debian.org/767040" target="_top">bug
	#767040</a>).  You can disable this by putting the
	following lines in <code class="filename">/etc/e2fsck.conf</code>:
      </p><pre class="screen">
[options]
broken_system_clock=1
</pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nownownow"></a>4.7. Things to do before rebooting</h2></div></div></div><p>
When <code class="literal">apt-get dist-upgrade</code> has finished, the <span class="quote">“<span class="quote">formal</span>”</span> upgrade
is complete, but there are some other things that should be taken care of
<span class="emphasis"><em>before</em></span> the next reboot.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
      When upgrading from Wheezy to Jessie, it can be
      a good idea to purge old packages <span class="emphasis"><em>before</em></span>
      the first reboot.  In particular, obsolete init scripts may
      cause issues.  Please see <a class="xref" href="ch-upgrading.en.html#purge-removed-packages" title="4.8.1. Purging removed packages">Section 4.8.1, “Purging removed packages”</a> for details on finding and purging removed packages.
    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="for-next"></a>4.8. Preparing for the next release</h2></div></div></div><p>
After the upgrade there are several things you can do to prepare for the next
release.
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
Remove newly redundant or obsolete packages as described in
<a class="xref" href="ch-upgrading.en.html#sufficient-space" title="4.4.3. Make sure you have sufficient space for the upgrade">Section 4.4.3, “Make sure you have sufficient space for the upgrade”</a> and <a class="xref" href="ch-upgrading.en.html#obsolete" title="4.10. Obsolete packages">Section 4.10, “Obsolete packages”</a>.
You should review which configuration files they use and consider purging
the packages to remove their configuration files.  See also
<a class="xref" href="ch-upgrading.en.html#purge-removed-packages" title="4.8.1. Purging removed packages">Section 4.8.1, “Purging removed packages”</a>.
</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="purge-removed-packages"></a>4.8.1. Purging removed packages</h3></div></div></div><p>
    It is generally advisable to purge removed packages.  This is
    especially true if these have been removed in an earlier release
    upgrade (e.g. from the upgrade to wheezy) or they were
    provided by third-party vendors.  In particular, old init.d
    scripts have been known to cause issues.
  </p><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Caution]" src="images/caution.png" /></td><th align="left">Caution</th></tr><tr><td align="left" valign="top"><p>
      Purging a package will generally also purge its log files, so
      you might want to back them up first.
    </p></td></tr></table></div><p>
    The following command displays a list of all removed packages that
    may have configuration files left on the system (if any):
  </p><pre class="screen">
# dpkg -l | awk '/^rc/ { print $2 }'
</pre><p>
    The packages can be removed by using <span class="command"><strong>apt-get
    purge</strong></span>.  Assuming you want to purge all of them
    in one go, you can use the following command:
  </p><pre class="screen">
# apt-get purge $(dpkg -l | awk '/^rc/ { print $2 }')
</pre><p>
    If you use <code class="systemitem">aptitude</code><a id="idp49658928" class="indexterm"></a>, you
    can also use the following alternative to the commands above:
  </p><pre class="screen">
$ aptitude search '~c'
$ aptitude purge '~c'
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deprecated"></a>4.9. Deprecated components</h2></div></div></div><p>
With the next release of Debian 9 (codenamed
stretch) some features will be deprecated. Users
will need to migrate to other alternatives to prevent
trouble when updating to 9.
</p><p>
This includes the following features:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The <code class="systemitem">hardening-wrapper</code><a id="idp49664544" class="indexterm"></a> package
		is deprecated and is expected to be removed in Stretch.
		</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="obsolete"></a>4.10. Obsolete packages</h2></div></div></div><p>
Introducing lot of new packages, jessie also retires and omits quite some
old packages that were in wheezy.  It provides no upgrade path
for these obsolete packages.  While nothing prevents you from continuing to use
an obsolete package where desired, the Debian project will usually discontinue
security support for it a year after jessie's release<a href="#ftn.idp49667536" class="footnote" id="idp49667536"><sup class="footnote">[5]</sup></a>, and will
not normally provide other support in the meantime.  Replacing them with
available alternatives, if any, is recommended.
</p><p>
There are many reasons why packages might have been removed from the
distribution: they are no longer maintained upstream; there is no longer a
Debian Developer interested in maintaining the packages; the functionality they
provide has been superseded by different software (or a new version); or they
are no longer considered suitable for jessie due to bugs in them.  In the latter
case, packages might still be present in the <span class="quote">“<span class="quote">unstable</span>”</span> distribution.
</p><p>
Detecting which packages in an updated system are <span class="quote">“<span class="quote">obsolete</span>”</span> is easy since the
package management front-ends will mark them as such.  If you are using
<span class="command"><strong>aptitude</strong></span>, you will see a listing of these packages in the
<span class="quote">“<span class="quote">Obsolete and Locally Created Packages</span>”</span> entry.
</p><p>
The <a class="ulink" href="https://bugs.debian.org/" target="_top">Debian Bug Tracking System</a>
often provides additional information on why the package was removed.  You
should review both the archived bug reports for the package itself and the
archived bug reports for the <a class="ulink" href="https://bugs.debian.org/cgi-bin/pkgreport.cgi?pkg=ftp.debian.org&amp;archive=yes" target="_top">ftp.debian.org
pseudo-package</a>.
</p><p>
  The list of obsolete packages includes:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	<code class="systemitem">postgresql-9.1</code><a id="idp49676096" class="indexterm"></a>, successor is
	<code class="systemitem">postgresql-9.4</code><a id="idp49677792" class="indexterm"></a>.
	Once the operating system
	upgrade is finished, you should plan to also upgrade your PostgreSQL
	9.1 database clusters to the new PostgreSQL version 9.4 using the
	<span class="command"><strong>pg_upgradecluster</strong></span> tool.
	For users of the PL/perl procedural language, jessie provides an
	updated <code class="systemitem">postgresql-plperl-9.1</code><a id="idp49680416" class="indexterm"></a>
	package linked against jessie's version of libperl in order to enable
	upgrading to the new perl version in jessie while keeping
	the old PL/perl database functions usable until the database is
	upgraded as well.
      </p></li><li class="listitem"><p>
        
        <code class="systemitem">python3.2</code><a id="idp49683088" class="indexterm"></a>, successor is
        <code class="systemitem">python3.4</code><a id="idp49684784" class="indexterm"></a>. (Version 2.7 is supported in
        both wheezy and jessie.)
      </p></li><li class="listitem"><p>
        <code class="systemitem">ruby1.8</code><a id="idp49687296" class="indexterm"></a> and
        <code class="systemitem">ruby1.9.1</code><a id="idp49688992" class="indexterm"></a>; successor is
        <code class="systemitem">ruby2.1</code><a id="idp49690688" class="indexterm"></a>.  Please install the package
        <code class="systemitem">ruby</code><a id="idp49692400" class="indexterm"></a> to automatically track the current ruby version.
      </p></li><li class="listitem"><p>
        <code class="systemitem">mplayer</code><a id="idp49694912" class="indexterm"></a>; alternatives are
        <code class="systemitem">mplayer2</code><a id="idp49696624" class="indexterm"></a>,
        and <code class="systemitem">mpv</code><a id="idp49702352" class="indexterm"></a> (new in jessie).
        Whilst the former is mostly compatible with mplayer in terms of command-line
        arguments and configuration (and adds a few new features too), the
        latter adds a lot of new features and improvements, and it is actively
        maintained upstream.
      </p></li><li class="listitem"><p>
        <code class="systemitem">openoffice.org</code><a id="idp49705056" class="indexterm"></a>; please use
        <code class="systemitem">libreoffice</code><a id="idp49706752" class="indexterm"></a>.
      </p></li><li class="listitem"><p>
        <code class="systemitem">squid</code><a id="idp49709216" class="indexterm"></a>, successor is
        <code class="systemitem">squid3</code><a id="idp49710912" class="indexterm"></a>.
      </p></li><li class="listitem"><p>
        <code class="systemitem">libjpeg-progs</code><a id="idp49713376" class="indexterm"></a>, successor is
        <code class="systemitem">libjpeg-turbo-progs</code><a id="idp49715072" class="indexterm"></a>.
      </p></li><li class="listitem"><p>
        <code class="systemitem">openjdk-6-*</code><a id="idp49717536" class="indexterm"></a>, successor is
        <code class="systemitem">openjdk-7-*</code><a id="idp49719232" class="indexterm"></a>.
      </p></li></ul></div><p>
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dummy"></a>4.10.1. Dummy packages</h3></div></div></div><p>
Some packages from wheezy have been split into several packages in jessie, often
to improve system maintainability.  To ease the upgrade path in such cases,
jessie often provides <span class="quote">“<span class="quote">dummy</span>”</span> packages: empty packages that have the same name as
the old package in wheezy with dependencies that cause the new packages to be
installed.  These <span class="quote">“<span class="quote">dummy</span>”</span> packages are considered redundant after the
upgrade and can be safely removed.
</p><p>
Most (but not all) dummy packages' descriptions indicate their purpose.
Package descriptions for dummy packages are not uniform, however, so you might
also find <span class="command"><strong>deborphan</strong></span> with the
<code class="literal">--guess-<em class="replaceable"><code>*</code></em></code> options (e.g.
<code class="literal">--guess-dummy</code>) useful to detect them in your system.  Note
that some dummy packages are not intended to be removed after an upgrade but
are, instead, used to keep track of the current available version of a program
over time.
</p></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div id="ftn.idp49286960" class="footnote"><p><a href="#idp49286960" class="para"><sup class="para">[1] </sup></a>If the debconf
priority is set to a very high level you might prevent configuration prompts,
but services that rely on default answers that are not applicable to your
system will fail to start.</p></div><div id="ftn.idp49288208" class="footnote"><p><a href="#idp49288208" class="para"><sup class="para">[2] </sup></a>For example: DNS or DHCP services, especially when
there is no redundancy or failover. In the DHCP case end-users might be disconnected 
from the network if the lease time is lower than the time it takes for the
upgrade process to complete.</p></div><div id="ftn.idp49301296" class="footnote"><p><a href="#idp49301296" class="para"><sup class="para">[3] </sup></a> This feature can be disabled by adding the parameter
<code class="literal">panic=0</code> to your boot parameters.  </p></div><div id="ftn.idp49380336" class="footnote"><p><a href="#idp49380336" class="para"><sup class="para">[4] </sup></a> Debian's package management system normally
does not allow a package to remove or replace a file owned by another package
unless it has been defined to replace that package.  </p></div><div id="ftn.idp49667536" class="footnote"><p><a href="#idp49667536" class="para"><sup class="para">[5] </sup></a> Or for as
long as there is not another release in that time frame.  Typically only two
stable releases are supported at any given time.  </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch-installing.en.html"><img src="images/prev.png" alt="Prev" /></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch-information.en.html"><img src="images/next.png" alt="Next" /></a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 3. Installation System </td><td width="20%" align="center"><a accesskey="h" href="index.en.html"><img src="images/home.png" alt="Home" /></a></td><td width="40%" align="right" valign="top"> Chapter 5. Issues to be aware of for jessie</td></tr></table></div></body></html>