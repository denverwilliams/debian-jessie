<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>第4章 Debian 7 (wheezy) からのアップグレード</title><link rel="stylesheet" type="text/css" href="debian.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.ja.html" title="Debian 8 (jessie) リリースノート (64 ビット PC 用)" /><link rel="up" href="index.ja.html" title="Debian 8 (jessie) リリースノート (64 ビット PC 用)" /><link rel="prev" href="ch-installing.ja.html" title="第3章 インストールシステム" /><link rel="next" href="ch-information.ja.html" title="第5章 jessie で知っておくべき問題点" /><meta xmlns="" name="viewport" content="width=device-width, initial-scale=1" /><style xmlns="" type="text/css">
      body {
        background-repeat: no-repeat;
        background-image: none;
      }
    </style></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">第4章 Debian 7 (wheezy) からのアップグレード</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch-installing.ja.html"><img src="images/prev.png" alt="戻る" /></a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch-information.ja.html"><img src="images/next.png" alt="次へ" /></a></td></tr></table><hr /></div><div xml:lang="ja" class="chapter" lang="ja"><div class="titlepage"><div><div><h1 class="title"><a id="ch-upgrading"></a>第4章 Debian 7 (wheezy) からのアップグレード</h1></div></div></div><div class="toc"><p><strong>目次</strong></p><dl class="toc"><dt><span class="section"><a href="ch-upgrading.ja.html#backup">4.1. アップグレードの準備</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#data-backup">4.1.1. あらゆるデータや設定情報をバックアップする</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#inform-users">4.1.2. 事前にユーザに通知する</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#services-downtime">4.1.3. サービスのダウン期間の準備</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#recovery">4.1.4. 復旧の準備</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#upgrade-preparations">4.1.5. アップグレード用の安全な環境の準備</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.ja.html#system-status">4.2. システムの状態をチェックする</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#review-actions">4.2.1. パッケージマネージャにおいて中断しているアクションの確認</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#disable-apt-pinning">4.2.2. APT の pin 機能を無効にする</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#package-status">4.2.3. パッケージの状態をチェックする</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#proposed-updates">4.2.4. proposed-updates セクション</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#unofficial-sources">4.2.5. 非公式なソース</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.ja.html#upgrade-process">4.3. APT の取得先 (ソース) の準備</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#network">4.3.1. APT のインターネットソースの追加</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#localmirror">4.3.2. APT のローカルミラーソースの追加</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#cdroms">4.3.3. APT の光学メディアソースの追加</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.ja.html#upgradingpackages">4.4. パッケージのアップグレード</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#record-session">4.4.1. セッションの記録</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#updating-lists">4.4.2. パッケージリストの更新</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#sufficient-space">4.4.3. アップグレードするのに十分な領域があることを確認する</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#minimal-upgrade">4.4.4. システムの最小アップグレード</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#upgrading-full">4.4.5. システムのアップグレード</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.ja.html#trouble">4.5. アップグレード中の注意点</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#immediate-configure">4.5.1. 「即時設定は動作しません」で dist-upgrade が失敗する</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#expected-removals">4.5.2. 予期されるパッケージの削除</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#conflicts-loops">4.5.3. 衝突 (Conflicts) あるいは事前依存 (Pre-Depends) のループ</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#file-conflicts">4.5.4. ファイルの衝突</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#configuration-changes">4.5.5. 設定の変更</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#console-change">4.5.6. コンソール接続へセッションの変更</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#package-specific-issues">4.5.7. 特定のパッケージに対する特別な注意</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.ja.html#newkernel">4.6. カーネルと関連パッケージのアップグレード</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#kernel-metapackage">4.6.1. カーネルメタパッケージのインストール</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#initramfs-tools-issues">4.6.2. ルート (/) および <code class="filename">/usr</code> ファイルシステムのマウントとチェックに関する変更</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.ja.html#nownownow">4.7. 再起動の前にすべきこと</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#for-next">4.8. 次期リリースへの準備</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#purge-removed-packages">4.8.1. 削除したパッケージを完全削除する</a></span></dt></dl></dd><dt><span class="section"><a href="ch-upgrading.ja.html#deprecated">4.9. 廃止予定のコンポーネント</a></span></dt><dt><span class="section"><a href="ch-upgrading.ja.html#obsolete">4.10. 利用されなくなったパッケージ</a></span></dt><dd><dl><dt><span class="section"><a href="ch-upgrading.ja.html#dummy">4.10.1. ダミーパッケージ</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="backup"></a>4.1. アップグレードの準備</h2></div></div></div><p>
アップグレードの前には、<a class="xref" href="ch-information.ja.html" title="第5章 jessie で知っておくべき問題点">5章<em>jessie で知っておくべき問題点</em></a>
に書かれている情報も読むことをお勧めします。この章に書かれている問題点は、アップグレードの過程と直接は関係がないかもしれませんが、それでもアップグレードを開始する前に知っておくべき重要事項である可能性があります。
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="data-backup"></a>4.1.1. あらゆるデータや設定情報をバックアップする</h3></div></div></div><p>
システムをアップグレードする前に、完全なバックアップを取っておくよう強くお勧めします。少なくとも、失いたくないデータや設定情報だけでもバックアップしておきましょう。アップグレードのツールや処理はきわめて信頼性の高いものですが、アップグレードの最中にハードウェア障害が起こると、システムに大きなダメージを与えることがありえます。
</p><p>
バックアップしておくべき主な対象として、<code class="filename">/etc</code>、<code class="filename">/var/lib/dpkg</code>、<code class="filename">/var/lib/apt/extended_states</code>
の中身、<code class="literal">dpkg --get-selections "*"</code> (引用符を忘れてはいけません)
の出力などがあります。システムの管理に <span class="command"><strong>aptitude</strong></span>
を使っている場合は、<code class="filename">/var/lib/aptitude/pkgstates</code>
もバックアップしておくと良いでしょう。
</p><p>
アップグレードの過程自体は、<code class="filename">/home</code> ディレクトリ以下は一切変更しません。とはいえ、(Mozilla
スイートの一部や、GNOME・KDE といったデスクトップ環境のように)
ユーザが初めて新しいバージョンのアプリケーションを起動するときに、既存のユーザ設定を新たなデフォルト値で上書きしてしまうものがあるのも事実です。万一に備えて、ユーザのホームディレクトリにある隠しファイルと隠しディレクトリ
(いわゆる <span class="quote">「<span class="quote">ドットファイル</span>」</span>)
をバックアップしておくのがよいでしょう。古い状態に戻したり、再度設定する場合に役立つはずです。ユーザにもこのことについて知らせておいてください。
</p><p>
あらゆるパッケージのインストール処理はスーパーユーザ特権で実行されなければならないため、<code class="literal">root</code>
としてログインするか <span class="command"><strong>su</strong></span> や <span class="command"><strong>sudo</strong></span>
を使って、必要なアクセス権限を得てください。
</p><p>
アップグレードにあたって事前に整えなければならない条件がいくつかあります。実際にアップグレードを実行する前にそれらを確認してください。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="inform-users"></a>4.1.2. 事前にユーザに通知する</h3></div></div></div><p>
アップグレードの前には、その予定をすべてのユーザに知らせるとよいでしょう。ただ、システムに <span class="command"><strong>ssh</strong></span>
接続などでアクセスしてきているユーザが、アップグレードの最中にそうと気付くことはほとんどないはずで、また、作業を続行できるはずです。 
</p><p>
万一の対策をしたければ、アップグレードの前に <code class="filename">/home</code>
パーティションをバックアップするか、アンマウントしてしまいましょう。
</p><p>
jessie
にアップグレードするときはおそらくカーネルをアップグレードしなければならないので、通常は再起動が必要です。通常、これはアップグレード完了後に実施します。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="services-downtime"></a>4.1.3. サービスのダウン期間の準備</h3></div></div></div><p>
システムが提供しているサービスで、アップグレードに含まれるパッケージが関連するサービスがあるかもしれません。この場合、注意して欲しいのですが、アップグレード作業中に関連パッケージが置換・設定される際、これらのサービスが停止します。この間、サービスは利用できなくなります。
</p><p>
これらのサービスに対する実際のダウン期間は、システム中でアップグレードされるパッケージ数に応じて違いますし、このダウン期間には (もしあれば)
システム管理者が各パッケージのアップグレードに対する設定の質問への回答に費やす時間も含まれます。アップグレード作業が放置されたままでいて、システムがアップグレード中に入力を必要とした場合、非常に長期間サービスが利用ができなくなる可能性が非常に高いでしょう
<a href="#ftn.idp65062224" class="footnote" id="idp65062224"><sup class="footnote">[1]</sup></a>
</p><p>
アップグレードを行うシステムが、ユーザーやネットワークにとって最も重要なサービスを提供している場合<a href="#ftn.idp65063984" class="footnote" id="idp65063984"><sup class="footnote">[2]</sup></a>、<a class="xref" href="ch-upgrading.ja.html#minimal-upgrade" title="4.4.4. システムの最小アップグレード">「システムの最小アップグレード」</a>
で記述しているように最小限のシステムアップグレードを行い、次にカーネルのアップグレードと再起動をし、そしてもっとも重要なサービスに関連するパッケージをアップグレードします。これらのパッケージのアップグレードは、<a class="xref" href="ch-upgrading.ja.html#upgrading-full" title="4.4.5. システムのアップグレード">「システムのアップグレード」</a>
にある完全アップグレードより先に実施します。このようにすれば、これらの最重要サービスが動作しつづけ、そして完全アップグレード作業を行っても利用可能であることを保証し、サービスの停止時間を減らすことができます。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="recovery"></a>4.1.4. 復旧の準備</h3></div></div></div><p>
Debian
はシステムがブートできる状態を常に確保するように努めていますが、アップグレード後のシステム再起動で問題に遭遇する可能性は常にあります。既知の潜在的な問題点の多くは、このリリースノートの本章と次章で述べられています。
</p><p>
上述の理由により、システムが再起動に失敗したり、リモート管理されているシステムならネットワーク接続の確立に失敗した場合に備え、復旧できる手立てを整えておくことが大切です。
</p><p>
<span class="command"><strong>ssh</strong></span>
接続経由でリモートからアップグレードを行うのなら、リモートのシリアル端末からサーバにアクセスできるよう、必要な事前準備をしておくことをお勧めします。カーネルをアップグレードして再起動した後、ローカルコンソール経由でシステム設定を修正しなければならないことがあります。また、アップグレード中に誤ってシステムが再起動された場合にも、ローカルコンソールを使って復旧する必要に迫られることがあります。
</p><p>
通常、お勧めしているのは jessie 用 Debian
インストーラーの<span class="emphasis"><em>レスキューモード</em></span>の利用です。インストーラーを使う利点は、多くのインストール手段の中からあなたの状況に最適なものを選べることにあります。より詳しい情報は、<a class="ulink" href="https://www.debian.org/releases/jessie/installmanual" target="_top">インストールガイド</a>の第 8
章にある<span class="quote">「<span class="quote">壊れたシステムの復旧</span>」</span>セクションや、<a class="ulink" href="https://wiki.debian.org/DebianInstaller/FAQ" target="_top">Debian インストーラー FAQ</a> を参照してください。
</p><p>
古いカーネルでの再起動に失敗するなら、システムを起動してアクセス・修復するための代替手段が必要となるでしょう。1
つのオプションとしては、特別な復旧イメージや Linux ライブ CD
を使うことがあります。これらを使って起動した後は、ルートファイルシステムをマウントし、<code class="literal">chroot</code>
でその中に入って問題点を調査・解決できるはずです。
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="recovery-initrd"></a>4.1.4.1. initrd を使った起動中のデバッグシェル</h4></div></div></div><p>
<code class="systemitem">initramfs-tools</code><a id="idp65078784" class="indexterm"></a> パッケージは生成した initrd
にデバッグシェルを収録します<a href="#ftn.idp65079728" class="footnote" id="idp65079728"><sup class="footnote">[3]</sup></a>。例えば、initrd
がルートファイルシステムをマウントできなければ、デバッグシェル内に移るでしょう。このデバッグシェルは、問題の追跡、そしておそらくは修正の手助けとなる基本的なコマンドを備えています。
</p><p>
チェックすべき基本的事項としては、次のようなものがあります。<code class="filename">/dev</code>
内に適切なデバイスファイルが存在するか、どのモジュールがロードされているか (<code class="literal">cat
/proc/modules</code>)、<span class="command"><strong>dmesg</strong></span>
の出力にドライバのロード失敗のエラーが出ていないか、など。<span class="command"><strong>dmesg</strong></span>
の出力はまた、どのデバイスファイルがどのディスクに割り当てられているのかも示してくれます。ルートファイルシステムが期待通りのデバイス上にあるかを確認するために、<code class="literal">echo
$ROOT</code> の出力もチェックすべきでしょう。
</p><p>
問題点を何とか解決できたなら、<code class="literal">exit</code>
とタイプすることでデバッグシェルを終了させ、起動プロセスを失敗した時点から継続できます。もちろん次回の起動時に再び失敗することが無いよう、根本的な問題を修正して
initrd を再生成する必要があるでしょう。
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="recovery-shell-systemd"></a>4.1.4.2. systemd を使った起動中のデバッグシェル</h4></div></div></div><p>
    起動が systemd において失敗する場合、カーネルコマンドラインを変更することでデバッグ用の root
シェルを追加できます。基本的な起動は成功するがサービスが起動に失敗する場合は、カーネルパラメーターに
<code class="literal">systemd.unit=rescue.target</code> を追加すると解決の役に立つかもしれません。
  </p><p>
    それ以外の場合、カーネルパラメーターとして <code class="literal">systemd.unit=emergency.target</code>
を指定することによって、可能な限り早い段階で root シェルが使えるようになります。ですが、これは root
ファイルシステムを読み書き可能な権限でマウントする前に実行されます。以下を手動で実行する必要があるでしょう:
  </p><pre class="screen">
mount -o remount,rw /
</pre><p>
    systemd 環境下で起動がおかしいのをデバッグする詳細な情報については、<a class="ulink" href="http://freedesktop.org/wiki/Software/systemd/Debugging/" target="_top">Diagnosing
Boot Problems</a> という記事で参照できます。
  </p><p>
    それでも失敗する場合、以前の sysvinit システム経由で起動することができるかもしれません。これには <code class="systemitem">sysvinit</code><a id="idp65096288" class="indexterm"></a> がまだインストールされていて initramfs に
<code class="filename">/lib/sysvinit/init</code>
が含まれている必要があります。これらの必要条件を満たしている場合、カーネルコマンドラインに
<code class="literal">init=/lib/sysvinit/init</code> を追加すれば sysvinit バイナリを使って起動するでしょう。
  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="upgrade-preparations"></a>4.1.5. アップグレード用の安全な環境の準備</h3></div></div></div><p>
ディストリビューションのアップグレードは、ローカルのテキストモード仮想コンソール (あるいは直接接続されたシリアル端末) から行うか、リモートなら
<span class="command"><strong>ssh</strong></span> 接続経由で行いましょう。 
</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png" /></td><th align="left">重要</th></tr><tr><td align="left" valign="top"><p>
  (<code class="systemitem">tinc</code><a id="idp65103072" class="indexterm"></a> のような) VPN
サービスを使っている場合、アップグレード作業中に使えなくなるかもしれません。 <a class="xref" href="ch-upgrading.ja.html#services-downtime" title="4.1.3. サービスのダウン期間の準備">「サービスのダウン期間の準備」</a>
を参照してください。
  </p></td></tr></table></div><p>
リモートでのアップグレード時にさらなる安全マージンを得るため、<span class="command"><strong>screen</strong></span>
プログラムが提供する仮想コンソール内でアップグレード作業を行うことを提案します。このプログラムは安全な再接続を可能にし、リモート接続プロセスが切断された場合でもアップグレード作業が中断しないようにしてくれます。
</p><div class="important"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[重要]" src="images/important.png" /></td><th align="left">重要</th></tr><tr><td align="left" valign="top"><p>
    <span class="command"><strong>telnet</strong></span>、<span class="command"><strong>rlogin</strong></span>、<span class="command"><strong>rsh</strong></span>
を用いてアップグレードをしては<span class="emphasis"><em>いけません</em></span>。アップグレードするマシンの
<span class="command"><strong>xdm</strong></span>、<span class="command"><strong>gdm</strong></span>、<span class="command"><strong>kdm</strong></span>
などが管理している X
セッションからのアップグレードも行うべきではありません。これらのサービスはアップグレードの最中に切断されてしまう可能性が高く、そうなるとアップグレード途中のシステムへの<span class="emphasis"><em>接続が不可能になってしまう</em></span>からです。GNOME
アプリケーションの <span class="command"><strong>update-manager</strong></span>
の利用は、このツールはデスクトップのセッションが利用可能であるのが前提であるため、新しいリリースへのアップグレードには<span class="emphasis"><em>全く勧められません</em></span>。
  </p></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="system-status"></a>4.2. システムの状態をチェックする</h2></div></div></div><p>
この章で述べられているアップグレード手順は、サードパーティ製のパッケージが無い <span class="quote">「<span class="quote">純粋</span>」</span> な wheezy
システムからのアップグレード用です。アップグレードプロセスにおいて最大限の信頼性を確保するために、アップグレード開始前にシステムからサードパーティ製パッケージを削除しておいた方が良いでしょう。
</p><p>
7 (wheezy) より古い Debian
のリリースバージョンからの直接のアップグレードはサポートされていません。7 へのアップグレードは、まず<a class="ulink" href="http://www.debian.org/releases/wheezy/releasenotes" target="_top">Debian
7 のリリースノート</a>の指示に従ってください。
</p><p>
またこの手順は、システムが wheezy
の最新ポイントリリースにアップデート済みであるものと想定しています。そうではなかったり、アップグレード済みかどうか不明なら、<a class="xref" href="ap-old-stuff.ja.html#old-upgrade" title="A.1. wheezy システムのアップグレード">「wheezy システムのアップグレード」</a>内の指示に従ってください。
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="review-actions"></a>4.2.1. パッケージマネージャにおいて中断しているアクションの確認</h3></div></div></div><p>
パッケージをインストールするのに <span class="command"><strong>aptitude</strong></span> の代わりに
<span class="command"><strong>apt-get</strong></span> を使用すると、時として、<span class="command"><strong>aptitude</strong></span> がそのパッケージを
<span class="quote">「<span class="quote">使われていない</span>」</span>
とみなし、削除対象とすることがあります。一般的には、アップグレードを先に進める前に、システムが完全に最新かつ <span class="quote">「<span class="quote">クリーン</span>」</span>
な状態となっているかを確認するべきです。
</p><p>
そのため、パッケージマネージャ <span class="command"><strong>aptitude</strong></span>
において中断しているアクションがないか確認すべきでしょう。パッケージマネージャにおいて、あるパッケージが削除あるいは更新の対象となっているなら、アップグレード手順に好ましくない影響を与えるかもしれません。パッケージマネージャにおけるアクションの修正は、<code class="filename">sources.list</code>
に <span class="emphasis"><em>stable</em></span> や <span class="emphasis"><em>jessie</em></span>
ではなく、<span class="emphasis"><em>wheezy</em></span> が指定されている段階でのみ可能なことに注意してください。<a class="xref" href="ap-old-stuff.ja.html#old-sources" title="A.2. ソースリストのチェック">「ソースリストのチェック」</a> も参照してください。
</p><p>
この確認を行うには、<span class="command"><strong>aptitude</strong></span> を <span class="quote">「<span class="quote">ビジュアルモード</span>」</span> で起動して
<span class="keycap"><strong>g</strong></span> (<span class="quote">「<span class="quote">Go</span>」</span>)
を押してください。何らかのアクションが表示されたなら、その内容を確認して、修正するかあるいは提案されたアクションを実行すべきです。いかなるアクションの提案もない場合は、<span class="quote">「<span class="quote">インストール・削除・更新予定のパッケージがありません</span>」</span>
というメッセージを表示します。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="disable-apt-pinning"></a>4.2.2. APT の pin 機能を無効にする</h3></div></div></div><p>
特定のパッケージを安定版以外のディストリビューション (テスト版など) からインストールするように APT
を設定している場合、そのパッケージが新しい安定版リリース内のバージョンにアップグレードできるように、(<code class="filename">/etc/apt/preferences</code>
および <code class="filename">/etc/apt/preferences.d/</code> 内に保存されている) APT の pin
設定を変更しなければならないかもしれません。APT の pin 機能に関する、より詳しい情報は、<span class="citerefentry"><span class="refentrytitle">apt_preferences</span>(5)</span> にあります。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="package-status"></a>4.2.3. パッケージの状態をチェックする</h3></div></div></div><p>
アップグレードの方法に関係なく、まず全パッケージの状態を調べ、全パッケージがアップグレード可能な状態にあるのを確認することをお勧めします。次のコマンドは、インストールが未完了のパッケージ
(Half-Installed) や設定に失敗したパッケージ (Failed-Config)、何らかのエラー状態にあるパッケージを表示します:
</p><pre class="screen">
# dpkg --audit
</pre><p>
<span class="command"><strong>aptitude</strong></span> や次のようなコマンドを使ってシステムの全パッケージの状態を検査することもできます。
</p><pre class="screen">
# dpkg -l | pager
</pre><p>
または
</p><pre class="screen">
# dpkg --get-selections "*" &gt; ~/curr-pkgs.txt
</pre><p>
アップグレード前に、あらゆる hold 状態を解除しておいたほうがよいでしょう。アップグレードに不可欠なパッケージが hold
状態にある場合、アップグレードに失敗します。
</p><p>
hold 状態にあるパッケージを記録するのに、<span class="command"><strong>aptitude</strong></span> は
<span class="command"><strong>apt-get</strong></span> や <span class="command"><strong>dselect</strong></span>
とは異なる手法を用いることに注意してください。<span class="command"><strong>aptitude</strong></span> で hold
状態にあるパッケージを確認するには、以下のように実行します。
</p><pre class="screen">
# aptitude search "~ahold" 
</pre><p>
<span class="command"><strong>apt-get</strong></span> でどのパッケージが hold 状態にあるのかを調べたければ、以下のように実行してください。
</p><pre class="screen">
# dpkg --get-selections | grep 'hold$'
</pre><p>
パッケージをローカルで変更・再コンパイルしており、パッケージの名前を変えたりバージョン番号に epoch
フィールドを追加していないなら、アップグレードしないよう hold 状態にしておかなければなりません。
</p><p>
<span class="command"><strong>apt-get</strong></span> でパッケージを <span class="quote">「<span class="quote">hold</span>」</span>
状態に変更するには、以下のように実行してください。
</p><pre class="screen">
# echo <em class="replaceable"><code>パッケージ名</code></em> hold | dpkg --set-selections
</pre><p>
<span class="quote">「<span class="quote">hold</span>」</span> 状態を解除するには <code class="literal">hold</code> の代わりに
<code class="literal">install</code> を使用してください。
</p><p>
修正が必要なことがあるなら、<a class="xref" href="ap-old-stuff.ja.html#old-sources" title="A.2. ソースリストのチェック">「ソースリストのチェック」</a>で説明するように
<code class="filename">sources.list</code> が wheezy を指定したままにしておくべきです。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="proposed-updates"></a>4.2.4. proposed-updates セクション</h3></div></div></div><p>
    <code class="filename">/etc/apt/sources.list</code> ファイルに
<code class="literal">proposed-updates</code>
セクションを含めている場合は、システムのアップグレードを試みる前に、それらのセクションをファイルから削除してください。これは、衝突の可能性を減らすための予防策です。
  </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="unofficial-sources"></a>4.2.5. 非公式なソース</h3></div></div></div><p>
システムに Debian
以外のパッケージがインストールされている場合、依存関係の衝突のためアップグレード中に削除されるかもしれないことに注意してください。当該パッケージが
<code class="filename">/etc/apt/sources.list</code> に Debian
以外のパッケージアーカイブを追加することでインストールされたのなら、そのアーカイブが jessie
用にコンパイルされたパッケージも提供しているかをチェックし、Debian パッケージ用のソース行と一緒にそのソース行も適切に修正してください。
</p><p>
<span class="emphasis"><em>非公式に</em></span> バックポートされた <span class="quote">「<span class="quote">より新しい</span>」</span>
バージョンのパッケージが<span class="emphasis"><em>存在している</em></span> wheezy がインストールされている Debian
システムを使っているユーザもいることでしょう。そのようなパッケージはファイルが競合する可能性があるので、まず間違いなくアップグレード中に問題を起こします<a href="#ftn.idp65169664" class="footnote" id="idp65169664"><sup class="footnote">[4]</sup></a>。<a class="xref" href="ch-upgrading.ja.html#trouble" title="4.5. アップグレード中の注意点">「アップグレード中の注意点」</a>には、もしそのような競合が起きた場合にどうやって対処するのか、という情報があります。
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="upgrade-process"></a>4.3. APT の取得先 (ソース) の準備</h2></div></div></div><p>
アップグレードを始める前に、<code class="systemitem">apt</code><a id="idp65174112" class="indexterm"></a> の設定ファイル
<code class="filename">/etc/apt/sources.list</code> を編集して、パッケージ一覧の取得先を設定する必要があります。
</p><p>
<code class="systemitem">apt</code><a id="idp65177056" class="indexterm"></a> は、あらゆる
<span class="quote">「<span class="quote"><code class="literal">deb</code></span>」</span>
行を通して見つかったすべてのパッケージを見比べ、最も大きなバージョン番号のパッケージをインストールします。同じパッケージが取得可能な場合は、ファイルで最初に現れた行を優先します
(したがって、複数のミラーを指定する場合は、最初にローカルのハードディスクを、次に <acronym title="Compact Disc Read Only Memory">CD-ROM</acronym> を、最後に
HTTP/FTP ミラーを指定するといいでしょう)。
</p><p>
リリースを指定するのに、コードネーム (<code class="literal">wheezy</code> や
<code class="literal">jessie</code>) と状態名
(<code class="literal">oldstable</code>、<code class="literal">stable</code>、<code class="literal">testing</code>、<code class="literal">unstable</code>)
のどちらもよく使用されます。コードネームによる指定には、新しいリリースが出たときに驚かずに済むという利点があるため、ここではコードネームを使用しています。当然ですが、コードネームを使用している場合は自分でリリースアナウンスに注意を払わなければいけません。代わりに状態名を使用している場合は、リリースが行われた直後に、パッケージが大量に更新可能になったことに気づくでしょう。
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="network"></a>4.3.1. APT のインターネットソースの追加</h3></div></div></div><p>
デフォルトの設定では、メインの Debian
インターネットサーバを使ってインストールするようになっています。ですが、<code class="filename">/etc/apt/sources.list</code>
を編集して、他のミラー (できればネットワーク的に最も近いミラー) を使うようにするほうがよいでしょう。
</p><p>
Debian の HTTP/FTP ミラーのアドレスは、<a class="ulink" href="https://www.debian.org/distrib/ftplist" target="_top">https://www.debian.org/distrib/ftplist</a> にあります
(<span class="quote">「<span class="quote">Debian ミラーサイト一覧</span>」</span> のセクションを参照してください)。一般には HTTP ミラーのほうが FTP
ミラーよりも高速です。
</p><p>
例えば、一番近くにある Debian ミラーが <code class="literal">http://mirrors.kernel.org/</code>
だったとしましょう。このミラーをウェブブラウザや FTP プログラムで見てみると、主なディレクトリが以下のような構成になっていることがわかります。
</p><pre class="programlisting">
http://mirrors.kernel.org/debian/dists/jessie/main/binary-<span class="phrase">amd64</span>/...
http://mirrors.kernel.org/debian/dists/jessie/contrib/binary-<span class="phrase">amd64</span>/...
</pre><p>
このミラーを <code class="systemitem">apt</code><a id="idp65195056" class="indexterm"></a> で使うには、次の行を
<code class="filename">sources.list</code> ファイルに追加します。
</p><pre class="programlisting">deb http://mirrors.kernel.org/debian jessie main contrib</pre><p>
<span class="quote">「<span class="quote"><code class="literal">dists</code></span>」</span>
を書かなくても、暗黙のうちに追加します。リリース名の後の各引数は、パスの末尾につけて、複数のディレクトリに展開するのに用います。
</p><p>
新しいソースを追加した後、<code class="filename">sources.list</code> 内の既存の
<span class="quote">「<span class="quote"><code class="literal">deb</code></span>」</span> 行の先頭に、ハッシュ記号 (<code class="literal">#</code>)
を追加して無効にしてください。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="localmirror"></a>4.3.2. APT のローカルミラーソースの追加</h3></div></div></div><p>
HTTP や FTP のパッケージミラーを使うのではなく、ローカルディスク (おそらくは <acronym title="ネットワークファイルシステム">NFS</acronym>
マウントされたもの) にあるミラーを使うよう、<code class="filename">/etc/apt/sources.list</code>
を変更したいことがあるかもしれません。
</p><p>
例えばパッケージのミラーが <code class="filename">/var/ftp/debian/</code>
にあり、主なディレクトリの配置が次のようになっているとします。
</p><pre class="programlisting">
/var/ftp/debian/dists/jessie/main/binary-<span class="phrase">amd64</span>/...
/var/ftp/debian/dists/jessie/contrib/binary-<span class="phrase">amd64</span>/...
</pre><p>
これを <code class="systemitem">apt</code><a id="idp65209904" class="indexterm"></a> で使うには、次の行を
<code class="filename">sources.list</code> ファイルに追加します。
</p><pre class="programlisting">deb file:/var/ftp/debian jessie main contrib</pre><p>
<span class="quote">「<span class="quote"><code class="literal">dists</code></span>」</span>
を書かなくても、暗黙のうちに追加します。リリース名の後の各引数は、パスの末尾につけて、複数のディレクトリに展開するのに用います。
</p><p>
新しいソースを追加した後、<code class="filename">sources.list</code> 内の既存の
<span class="quote">「<span class="quote"><code class="literal">deb</code></span>」</span> 行の先頭に、ハッシュ記号 (<code class="literal">#</code>)
を追加して無効にしてください。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="cdroms"></a>4.3.3. APT の光学メディアソースの追加</h3></div></div></div><p>
CD (や DVD、Blu-ray Disc)
<span class="emphasis"><em>だけ</em></span>でインストールをしたい場合は、<code class="filename">/etc/apt/sources.list</code>
内の <span class="quote">「<span class="quote"><code class="literal">deb</code></span>」</span> 行の先頭にハッシュ記号 (<code class="literal">#</code>)
を置き、それらを無効にしてください。
</p><p>
CD-ROM ドライブをマウントポイント <code class="filename">/media/cdrom</code> にマウントできるようにしている行が
<code class="filename">/etc/fstab</code> にあるかどうかを確認してください。例えば
<code class="filename">/dev/sr0</code> が CD-ROM
ドライブなら、<code class="filename">/etc/fstab</code> には次のような行が必要です。
</p><pre class="programlisting">
/dev/sr0 /media/cdrom auto noauto,ro 0 0
</pre><p>
第 4 フィールドの <code class="literal">noauto,ro</code> の単語の間には、スペースを入れてはいけません。
</p><p>
これが正しく機能しているか調べるには、CD を挿入して以下を実行してみてください。
</p><pre class="screen">
# mount /media/cdrom    # マウントポイントに CD をマウントします
# ls -alF /media/cdrom  # CD のルートディレクトリを表示します
# umount /media/cdrom   # CD をアンマウントします
</pre><p>
問題がなければ
</p><pre class="screen">
# apt-cdrom add
</pre><p>
を、Debian Binary CD-ROM それぞれに対して実行してください。各 CD に関するデータが APT のデータベースに追加されます。
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="upgradingpackages"></a>4.4. パッケージのアップグレード</h2></div></div></div><p>
Debian の前回のリリースからのお勧めのアップグレード方法は、パッケージ管理ツール <span class="command"><strong>apt-get</strong></span>
を用いる方法です。以前のリリースでは、この作業には <span class="command"><strong>aptitude</strong></span>
が推奨されていましたが、<span class="command"><strong>apt-get</strong></span>
の最近のバージョンでは同等の機能が提供されており、さらにより高い整合性により望ましいアップグレード結果をもたらします。
</p><p>
まず、必要なすべてのパーティション (特にルートパーティションと <code class="filename">/usr</code> パーティション) を
read-write モードでマウントするのを忘れずに行いましょう。それには以下のようなコマンドを使います。
</p><pre class="screen">
# mount -o remount,rw /<em class="replaceable"><code>マウントポイント</code></em>
</pre><p>
次に、(<code class="filename">/etc/apt/sources.list</code> 内の) APT ソースのエントリが
<span class="quote">「<span class="quote"><code class="literal">jessie</code></span>」</span> と
<span class="quote">「<span class="quote"><code class="literal">stable</code></span>」</span>
のいずれか一方を指定していることを念入りにチェックしてください。wheezy を指し示すソースエントリが含まれてはいけません。
</p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png" /></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>
    CD-ROM のソース行は <span class="quote">「<span class="quote"><code class="literal">unstable</code></span>」</span>
を指定していることがよくあります。これは混乱の元かもしれませんが、変更すべきでは<span class="emphasis"><em>ありません</em></span>。
  </p></td></tr></table></div><p>
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="record-session"></a>4.4.1. セッションの記録</h3></div></div></div><p>
ここで強くお勧めしたいのですが、<span class="command"><strong>/usr/bin/script</strong></span>
プログラムを使って、このアップグレードセッションの記録を取るようにしましょう。こうすれば、何らかの問題が生じたときに何が起こったかを記録しておくことができ、必要に応じてバグ報告に正確な情報を含めることができます。記録を開始するには次のように入力します。
</p><pre class="screen">
# script -t 2&gt;~/upgrade-jessie<em class="replaceable"><code>手順</code></em>.time -a ~/upgrade-jessie<em class="replaceable"><code>手順</code></em>.script
</pre><p>
typescript を再度実行する必要がある場合 (例: システムを再起動する必要がある場合)
は、どのアップグレード手順のログを取っているのかを示すため、別の<em class="replaceable"><code>手順</code></em>番号を使ってください。typescript
ファイルは <code class="filename">/tmp</code> や <code class="filename">/var/tmp</code>
のような一時ディレクトリには置かないでください (これらのディレクトリ内のファイルはアップグレードや再起動の際に削除されることがありますから)。
</p><p>
また、typescript
ファイルに記録することで、スクロールしてスクリーンから消えた情報をもう一度見ることができるようにもなります。システムのコンソールの前に居る場合は、(<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F2</strong></span> を使って) 2
番の仮想コンソールに切り替えて、ログインしてから <code class="literal">less -R
~root/upgrade-jessie.script</code> と実行すれば当該ファイルを見ることができます。
</p><p>
アップグレード完了後に <span class="command"><strong>script</strong></span> を停止するには、プロンプトから
<code class="literal">exit</code> と入力してください。
</p><p>
<span class="command"><strong>script</strong></span> に <span class="emphasis"><em>-t</em></span> スイッチをつけておいた場合は、以下のように
<span class="command"><strong>scriptreplay</strong></span> プログラムでセッション全体をリプレイできます。
</p><pre class="screen">
# scriptreplay ~/upgrade-jessie.time ~/upgrade-jessie.script
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="updating-lists"></a>4.4.2. パッケージリストの更新</h3></div></div></div><p>
まず、新しいリリースで利用可能なパッケージの一覧を取得する必要があります。そのためには以下のコマンドを実行してください。
</p><pre class="screen">
# apt-get update
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sufficient-space"></a>4.4.3. アップグレードするのに十分な領域があることを確認する</h3></div></div></div><p>
システムアップグレードの前には、<a class="xref" href="ch-upgrading.ja.html#upgrading-full" title="4.4.5. システムのアップグレード">「システムのアップグレード」</a>
で説明するシステム全体のアップグレードを開始するときに、十分なハードディスク領域があるかどうかを確認してください。まず、ネットワーク経由で取得してインストールする必要があるパッケージは、すべて
<code class="filename">/var/cache/apt/archives</code> (およびダウンロード中には
<code class="filename">partial/</code> サブディレクトリ)
に保存されます。したがって、システムにインストールされるパッケージをダウンロードして一時的に保存できるよう、<code class="filename">/var/</code>
を保持しているファイルシステムパーティションに十分な空き領域があることを確認しなければなりません。ダウンロード後にはおそらく、アップグレードされるパッケージ
(これらには、より大きなバイナリやより多くのデータが含まれている可能性があります)
と、アップグレードに伴って依存関係に引きずられて新たにインストールされるパッケージの両方のインストールのために、他のファイルシステムパーティションにさらに領域が必要になるでしょう。システムに十分な空き領域がない場合、アップグレードが不完全な状態で終わり、復旧が困難になる可能性があります。
</p><p>
<span class="command"><strong>apt-get</strong></span>
で、インストールに必要なディスク領域の詳細な情報が表示できます。アップグレードを実行する前に、次のように実行して必要な領域の推定値を見ることができます。
</p><pre class="screen">
# apt-get -o APT::Get::Trivial-Only=true dist-upgrade
[ ... ]
アップグレード: XXX 個、新規インストール: XXX 個、削除: XXX 個、保留: XXX 個。
xx.x MB のアーカイブを取得する必要があります。
この操作後に追加で AAA MB のディスク容量が消費されます。
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png" /></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>
アップグレード手順の初めにこのコマンドを実行すると、以降のセクションで説明するような理由でエラーが発生する可能性があります。その場合、このコマンドを実行してディスク領域の推定値を見る前に、まず<a class="xref" href="ch-upgrading.ja.html#minimal-upgrade" title="4.4.4. システムの最小アップグレード">「システムの最小アップグレード」</a>で説明しているシステムの最小アップグレードを行う必要があります。
</p></td></tr></table></div><p>
アップグレードをするのに十分な領域がない場合は、<span class="command"><strong>apt-get</strong></span> が以下のような警告メッセージを出します。
</p><pre class="screen">
エラー: /var/cache/apt/archives/ に充分な空きスペースがありません。
</pre><p>この場合、事前に領域を解放するのを忘れないようにしてください。以下のことを実行するとよいでしょう。
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
インストールのために、以前 (<code class="filename">/var/cache/apt/archives</code> に)
ダウンロードしたパッケージを削除する。<span class="command"><strong>apt-get clean</strong></span>
を実行してパッケージキャッシュを一掃すると、以前ダウンロードしたパッケージファイルをすべて削除できます。
</p></li><li class="listitem"><p>
忘れ去られたパッケージを削除する。さらに、wheezy で手作業でパッケージをインストールするのに
<span class="command"><strong>aptitude</strong></span> や
<span class="command"><strong>apt-get</strong></span>を使っていたのなら、手作業でインストールされたパッケージの記録が取られています。依存関係のみによって引きずられてインストールされたパッケージに対して、依存元パッケージが削除されたためにもう不要となった場合に、余分だというマークをつけることができるでしょう。手作業でインストールしたパッケージには削除されるマークをつけません。自動的にインストールされたがもはや使われていないパッケージを削除するには、以下を実行してください:
</p><pre class="screen">
# apt-get autoremove
</pre><p>
余分なパッケージを見つけるのに、<span class="command"><strong>deborphan</strong></span> や
<span class="command"><strong>debfoster</strong></span>、<span class="command"><strong>cruft</strong></span>
も使えます。これらのツールが表示したパッケージをやみくもに削除しないでください。特に、誤検出しやすい非デフォルトの凶暴なオプションを使っている場合はなおさらです。実際に削除する前に、削除を提案されたパッケージ
(の内容やサイズ、説明など) を手作業で調べなおすことを強くお勧めします。
</p></li><li class="listitem"><p>
多くの容量を占めていて現在必要のないパッケージを削除する (アップグレード後にいつでもインストールし直せます)。<code class="systemitem">popularity-contest</code><a id="idp65310320" class="indexterm"></a>
をインストールしていれば、<span class="command"><strong>popcon-largest-unused</strong></span>
を使うことにより、容量の多くを占めていて使うことのないパッケージの一覧が得られます。<span class="command"><strong>dpigs</strong></span>
(<code class="systemitem">debian-goodies</code><a id="idp65313728" class="indexterm"></a> パッケージに収録) や
<span class="command"><strong>wajig</strong></span> (<code class="literal">wajig size</code> を実行)
により、ディスク容量を消費するだけのパッケージを検索することができます。こういった情報は <code class="systemitem">aptitude</code><a id="idp65317152" class="indexterm"></a>
を使って検索することもできます。<span class="command"><strong>aptitude</strong></span>
を<span class="emphasis"><em>ビジュアルモード</em></span>で起動します。<span class="guimenu">表示</span> → <span class="guimenuitem">平坦なパッケージ一覧を新規に作成</span>を実行し、<span class="keycap"><strong>l</strong></span>
を押して、<code class="literal">~i</code> と入力します。<span class="keycap"><strong>S</strong></span> を押して
<code class="literal">~installsize</code> と入力します。すると、作業しやすい一覧が得られます。 
</p></li><li class="listitem"><p>
  翻訳や地域化用ファイルが不要なら、それらをシステムから削除する。<code class="systemitem">localepurge</code><a id="idp65325680" class="indexterm"></a>
パッケージをインストールして設定すれば、選んだ少数のロケールのみがシステムに残るようにすることが可能です。これによって、<code class="filename">/usr/share/locale</code>
の消費するディスク領域を減らせるでしょう。
</p></li><li class="listitem"><p>
   <code class="filename">/var/log/</code> の下にあるシステムログを、一時的に他のシステムに移動するか、永久に削除する。
</p></li><li class="listitem"><p>
    仮設の <code class="filename">/var/cache/apt/archives</code> を使用する。すなわち、別のファイルシステム
(<acronym title="ユニバーサルシリアルバス (Universal Serial Bus)">USB</acronym> ストレージデバイス、一時的なハードディスク、既に使用されているファイルシステムなど)
を仮設のキャッシュディレクトリとして拝借することができます。
  </p><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png" /></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>
      アップグレード中にネットワーク接続が途切れる可能性があるので、<acronym title="ネットワークファイルシステム">NFS</acronym> マウントは使用しないでください。
    </p></td></tr></table></div><p>
  以下は、<code class="filename">/media/usbkey</code> にマウントされた <acronym title="ユニバーサルシリアルバス (Universal Serial Bus)">USB</acronym>
ドライブがある場合を例とします。
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	今までに、インストールのためにダウンロードされたパッケージを削除します。

	</p><pre class="screen"># apt-get clean</pre><p>
      </p></li><li class="listitem"><p>
	ディレクトリ <code class="filename">/var/cache/apt/archives</code> を、<acronym title="ユニバーサルシリアルバス (Universal Serial Bus)">USB</acronym>
ドライブにコピーします。

	</p><pre class="screen"># cp -ax /var/cache/apt/archives /media/usbkey/</pre><p>
      </p></li><li class="listitem"><p>
	現在のキャッシュディレクトリに、仮のキャッシュディレクトリをマウントします。

	</p><pre class="screen"># mount --bind /media/usbkey/archives /var/cache/apt/archives</pre><p>
      </p></li><li class="listitem"><p>
	アップグレード後に、元々の <code class="filename">/var/cache/apt/archives</code> ディレクトリを復活させます。

	</p><pre class="screen"># umount /media/usbkey/archives</pre><p>
      </p></li><li class="listitem"><p>
	残っている <code class="filename">/media/usbkey/archives</code> を削除します。
      </p></li></ol></div><p>
  仮設のキャッシュディレクトリは、システムにマウントされているファイルシステムであれば何にでも作成できます。
  </p></li><li class="listitem"><p>
    システムの最小アップグレードを行う (<a class="xref" href="ch-upgrading.ja.html#minimal-upgrade" title="4.4.4. システムの最小アップグレード">「システムの最小アップグレード」</a>
参照)、あるいは完全アップグレードにしたがって、システムの部分的なアップグレードを行う。これによって、システムを部分的にアップグレードが可能になり、完全アップグレード前にパッケージキャッシュの削除ができます。
  </p></li></ul></div><p>
パッケージを安全に削除するための注意として、<a class="xref" href="ap-old-stuff.ja.html#old-sources" title="A.2. ソースリストのチェック">「ソースリストのチェック」</a>で説明するように、<code class="filename">sources.list</code> が
wheezy を指し示すよう設定を戻しておくことが望ましいです。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="minimal-upgrade"></a>4.4.4. システムの最小アップグレード</h3></div></div></div><p>
完全アップグレード (以下に記述しています)
を直接行った場合、残しておきたいパッケージが大量に削除されてしまうことが時折あります。そのため、まずはこれらの競合状態を打開するための最小アップグレードを行い、その上で
<a class="xref" href="ch-upgrading.ja.html#upgrading-full" title="4.4.5. システムのアップグレード">「システムのアップグレード」</a> にあるような完全な <code class="literal">dist-upgrade</code>
を行う、という 2 段階のアップグレード過程を踏むことをお勧めします。 
</p><p>
これをまず行うには、以下のコマンドを実行してください。
</p><pre class="screen">
# apt-get upgrade
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png" /></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>
      以前のリリースの一部では、アップグレード作業に <span class="command"><strong>aptitude</strong></span> の利用を推奨していました。このツールは
wheezy から jessie へのアップグレードには推奨されません。
    </p></td></tr></table></div><p>
このコマンドには、アップグレードしても他のパッケージをインストール・削除する必要がないパッケージだけをアップグレードする、という効果があります。
</p><p>
システムの容量が少なく、容量による制約のため完全アップグレードが実行できない場合にも、システムの最小アップグレードは有用です。
</p><p>
  <code class="systemitem">apt-listchanges</code><a id="idp65360016" class="indexterm"></a>
パッケージがインストールされていれば、(デフォルト設定で) アップグレードされるパッケージについての重要な情報をページャで表示します。読み終わったら
<span class="keycap"><strong>q</strong></span> を押してページャを終了し、アップグレードを続けてください。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="upgrading-full"></a>4.4.5. システムのアップグレード</h3></div></div></div><p>
これまでの手順を実行し終わったら、アップグレードの主要な部分を続ける準備ができています。以下のコマンドを実行してください。
</p><pre class="screen">
# apt-get dist-upgrade
</pre><div class="note"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注記]" src="images/note.png" /></td><th align="left">注記</th></tr><tr><td align="left" valign="top"><p>
      以前のリリースの一部では、アップグレード作業に <span class="command"><strong>aptitude</strong></span> の利用を推奨していました。このツールは
wheezy から jessie へのアップグレードには推奨されません。
    </p></td></tr></table></div><p>
これによってシステムの完全なアップグレードが行われ、すべてのパッケージの最新版がインストールされ、リリース間で発生しうるパッケージの依存関係の変化すべてが解決されます。必要に応じて、新しいパッケージ
(通常は、新しいバージョンのライブラリや、名前の変わったパッケージ) がインストールされたり、衝突した古いパッケージが削除されたりもします。
</p><p>
CD-ROM (または DVD) のセットからアップグレードする場合には、アップグレードの最中に、特定の CD
を入れるよう何回か指示されることになります。同じ CD を複数回入れなければならないかもしれません。これは、相互に依存しているパッケージが別々の CD
に分散しているためです。
</p><p>
現在インストールされているパッケージを新しいバージョンへとアップグレードする際に、他のパッケージのインストール状態を変更しなければならないような場合には、そのパッケージは現在のバージョンのままになります
(<span class="quote">「<span class="quote">固定されている</span>」</span> と表示されます)。この状態は、<span class="command"><strong>aptitude</strong></span>
でこれらのパッケージをインストール対象として選択するか、または <code class="literal">apt-get install
<em class="replaceable"><code>パッケージ名</code></em></code> を実行してみると、解決できます。
</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="trouble"></a>4.5. アップグレード中の注意点</h2></div></div></div><p>
以下の章では、jessie へのアップグレードの最中に現れるかもしれない既知の問題を記述しています
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="immediate-configure"></a>4.5.1. 「即時設定は動作しません」で dist-upgrade が失敗する</h3></div></div></div><p>
<span class="command"><strong>apt-get dist-upgrade</strong></span> の途中でパッケージをダウンロードした後に失敗となり、
</p><pre class="screen">
「<em class="replaceable"><code>パッケージ</code></em>」の即時設定は動作しません。詳細については man 5 apt.conf の APT::Immediate-Configure の項を参照してください。
</pre><p>
</p><p>
と表示することがあります。これが起きた場合は、代わりに <span class="command"><strong>apt-get dist-upgrade -o
APT::Immediate-Configure=0</strong></span> を実行することでアップグレードを進められるはずです。
</p><p>
この問題の暫定的な別の対処の可能性として、wheezy と jessie の両方のソースを一時的に
<code class="filename">sources.list</code> に追加して <span class="command"><strong>apt-get update</strong></span>
を実行する方法があります。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="expected-removals"></a>4.5.2. 予期されるパッケージの削除</h3></div></div></div><p>
jessie
へのアップグレード作業では、システム中のパッケージ削除を尋ねてくるかもしれません。実際のパッケージ一覧は、インストールしてあるパッケージの構成によって異なってくるでしょう。このリリースノートでは、どのような方法をとるべきかに関する一般的なアドバイスをします。しかし、確信がもてない場合は、それぞれの方法でアップグレードを先に進める前に、どのパッケージを削除するよう提案されているのか、きちんと調べることをお勧めします。jessie
で時代遅れ (obsoleted) となったパッケージの詳細については、<a class="xref" href="ch-upgrading.ja.html#obsolete" title="4.10. 利用されなくなったパッケージ">「利用されなくなったパッケージ」</a> を参照してください
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="conflicts-loops"></a>4.5.3. 衝突 (Conflicts) あるいは事前依存 (Pre-Depends) のループ</h3></div></div></div><p>
場合によっては衝突や事前依存のループのために、APT の <code class="literal">APT::Force-LoopBreak</code>
オプションを有効にして、必須パッケージを一時的に削除しなければならないかもしれません。その場合 <span class="command"><strong>apt-get</strong></span>
はこのことを警告してアップグレードを中断します。<span class="command"><strong>apt-get</strong></span> のコマンドラインにオプション
<code class="literal">-o APT::Force-LoopBreak=1</code> を指定すれば、この状態を回避できます。
</p><p>
システムの依存関係の構造があまりに問題だらけで、手動での介入が必要となることもあります。通常、手動での介入とは、<span class="command"><strong>apt-get</strong></span>
を用いるか、あるいは
</p><pre class="screen">
# dpkg --remove <em class="replaceable"><code>パッケージ名</code></em>
</pre><p>
で問題の原因となるパッケージを消す作業になります。または次の方法を用いてもよいかもしれません。
</p><pre class="screen">
# apt-get -f install
# dpkg --configure --pending
</pre><p>
極端な場合には、コマンドラインから次のように入力して、再インストールしなければならないかもしれません。
</p><pre class="screen">
# dpkg --install <em class="replaceable"><code>/path/to/パッケージ名.deb</code></em>
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="file-conflicts"></a>4.5.4. ファイルの衝突</h3></div></div></div><p>
<span class="quote">「<span class="quote">純粋</span>」</span> な wheezy
システムからのアップグレードでは、ファイルの衝突は起こらないはずですが、非公式のバックポートパッケージをインストールしているなら起こるかもしれません。ファイルの競合が起こると、次のようなエラーになります:
</p><pre class="screen">
(<em class="replaceable"><code>&lt;package-foo-file&gt;</code></em> から) <em class="replaceable"><code>&lt;package-foo&gt;</code></em> を展開しています...
dpkg: <em class="replaceable"><code>&lt;package-foo&gt;</code></em> の処理中にエラーが発生しました (--install):
 `<em class="replaceable"><code>&lt;some-file-name&gt;</code></em>' を上書きしようとしています。これはパッケージ <em class="replaceable"><code>&lt;package-bar&gt;</code></em>
 にも含まれています
dpkg-deb: サブプロセス paste がシグナル (Broken pipe) によって強制終了しました
 以下のパッケージの処理中にエラーが発生しました:
 <em class="replaceable"><code>&lt;package-foo&gt;</code></em>
</pre><p>
ファイルの衝突を解消するには、エラーメッセージの<span class="emphasis"><em>最後の</em></span>行に表示されたパッケージを強制的に削除します:
</p><pre class="screen">
# dpkg -r --force-depends <em class="replaceable"><code>パッケージ名</code></em>
</pre><p>
問題が修正できたら、先程説明した <span class="command"><strong>apt-get</strong></span> のコマンドを再度入力すれば、アップグレードを再開できます。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="configuration-changes"></a>4.5.5. 設定の変更</h3></div></div></div><p>
アップグレードの最中に、いくつかのパッケージの設定・再設定に関する質問が表示されます。<code class="filename">/etc/init.d</code>
ディレクトリと <code class="filename">/etc/manpath.config</code>
ファイルに関しては、パッケージメンテナのバージョンに置き換えるようにしてください。システムの整合性を保つためには <span class="quote">「<span class="quote">yes</span>」</span>
と答えることが必要になります。古いバージョンも <code class="literal">.dpkg-old</code>
という拡張子をつけられて保存されていますので、戻すのはいつでもできます。
</p><p>
どうすればよいかわからなくなったら、そのパッケージやファイルの名前を書き留めておいて、その問題解決は後回しにしましょう。typescript
ファイルを検索すれば、アップグレードの最中に画面に表示された情報をもう一度見ることもできます。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="console-change"></a>4.5.6. コンソール接続へセッションの変更</h3></div></div></div><p>
システムのローカルコンソールを使ってアップグレードを実行している場合、アップグレードの最中に何回かコンソールが別の画面へ移動してしまい、アップグレード作業が見えなくなることに気づくかもしれません。例えば、デスクトップシステムでディスプレイマネージャが再起動した際に起こります。
</p><p>
仮想ターミナル 1 に戻るには (グラフィカルの起動画面の場合は) <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span>、あるいは
(ローカルのテキストモードコンソールの場合には) <span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>F1</strong></span>を使う必要があります。F1
は、アップグレードが実行されている仮想ターミナルの番号と同じ番号のファンクションキーと置き換えてください。異なったテキストモードのターミナル間で切り替えを行うには、<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>左矢印</strong></span> か
<span class="keycap"><strong>Alt</strong></span>+<span class="keycap"><strong>右矢印</strong></span>
も使えます。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="package-specific-issues"></a>4.5.7. 特定のパッケージに対する特別な注意</h3></div></div></div><p>
ほとんどの場合、wheezy と jessie
間でパッケージのアップグレードは順調に行われるはずです。稀なケースとして、アップグレード前、あるいはアップグレード中に調整が必要なものがあります。以下にパッケージごとの詳細を記述します。
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="issues-systemd"></a>4.5.7.1. systemd</h4></div></div></div><p>
    Debian を wheezy から jessie へとアップグレードする場合、デフォルトで SysV から
systemd へと init システムを移行します。システムと設定に応じて、変更を手動で行う必要があるかもしれません。<a class="xref" href="ch-information.ja.html#systemd-upgrade-default-init-system" title="5.6. Jessie での既存 init システムから新しい標準 init システムへのアップグレードについて">「Jessie での既存 init システムから新しい標準 init システムへのアップグレードについて」</a> に既知の問題を詳細に記載しています。
  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="issues-lxc"></a>4.5.7.2. LXC</h4></div></div></div><p>
    LXC をインストールしてある場合、システムとコンテナをアップグレードする際に特に注意を払う必要があるでしょう。既知の問題と対処について <a class="xref" href="ch-information.ja.html#lxc-upgrade-issues" title="5.8. LXC ホストおよびコンテナのアップグレードについての検討">「LXC ホストおよびコンテナのアップグレードについての検討」</a> を参照してください。
  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="newkernel"></a>4.6. カーネルと関連パッケージのアップグレード</h2></div></div></div><p>
このセクションでは、カーネルのアップグレード方法を説明し、このアップグレードに際して生じる可能性がある問題点を明確にします。Debian
で提供されている <code class="systemitem">linux-image-*</code><a id="idp65432720" class="indexterm"></a>
パッケージのいずれかをインストールしても、カスタマイズしたカーネルをソースからコンパイルしてもかまいません。
</p><p>
このセクションに書かれている多くの情報は、ユーザが Debian のモジュラーカーネルのいずれかを <code class="systemitem">initramfs-tools</code><a id="idp65435408" class="indexterm"></a> や <code class="systemitem">udev</code><a id="idp65437104" class="indexterm"></a> とともに使用しているのを前提にしている、ということに注意してください。initrd
を必要としないカスタムカーネルを使用するのを選択した場合や、initrd
生成ユーティリティとして異なるものを使用している場合は、このセクションの情報の一部は適切ではないかもしれません。
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="kernel-metapackage"></a>4.6.1. カーネルメタパッケージのインストール</h3></div></div></div><p>
wheezy から jessie への dist-upgrade を実行する際、新しい linux-image-*
メタパッケージを、過去にインストールしていない場合にはインストールすることを強くお勧めします。これらのメタパッケージは、アップグレードの最中に自動的に新しいバージョンのパッケージを取得します。次のように実行すると、どのパッケージがインストールされているのかを確認できます:
</p><pre class="screen">
# dpkg -l "linux-image*" | grep ^ii | grep -i meta
</pre><p>
何も出力されない場合は、新しい linux-image パッケージを手作業でインストールするか、linux-image
メタパッケージをインストールする必要があります。利用可能な linux-image メタパッケージの一覧を見るには次のように実行してください:
</p><pre class="screen">
# apt-cache search linux-image- | grep -i meta | grep -v transition
</pre><p>
どのパッケージを選択すればよいのかわからない場合は、<code class="literal">uname -r</code>
を実行し、似た名前をもつパッケージを探してください。例えば、コマンドの出力が '<code class="literal">2.6.32-5-amd64</code>'
の場合は <code class="systemitem">linux-image-amd64</code><a id="idp65446096" class="indexterm"></a>
をインストールすることをお勧めします。利用可能なパッケージのうち最良のものを選ぶ手助けとして、次のように
<span class="command"><strong>apt-cache</strong></span> を用いて各パッケージのパッケージ説明の詳細版を参照してもよいでしょう。
</p><pre class="screen">
# apt-cache show linux-image-amd64
</pre><p>
インストールするカーネルイメージが決まったら、<code class="literal">apt-get install</code>
でインストールします。次回、再起動可能になった際に新しいカーネルバージョンが提供するメリットを得るために再起動を実行する必要があります。ですが、アップグレード後の最初の再起動を実行する前に
<a class="xref" href="ch-upgrading.ja.html#nownownow" title="4.7. 再起動の前にすべきこと">「再起動の前にすべきこと」</a> を参照してください。
</p><p>
少し勇気のある人には、Debian 上で簡単に自分のカスタムカーネルをコンパイルするやり方があります。<code class="systemitem">linux-source</code><a id="idp65452784" class="indexterm"></a>
パッケージで提供されるカーネルソースをインストールしてください。バイナリパッケージの構築には、ソース中の Makefile 中の
<code class="literal">deb-pkg</code> ターゲットが使えます。さらなる情報は、<a class="ulink" href="http://kernel-handbook.alioth.debian.org/" target="_top">Debian Linux Kernel
Handbook</a> にあります。<code class="systemitem">debian-kernel-handbook</code><a id="idp65456368" class="indexterm"></a> パッケージからも利用できます。
</p><p>
可能なら、カーネルパッケージのアップグレードをメインの <code class="literal">dist-upgrade</code>
と分けることで、一時的にでも起動不能なシステムにしてしまうことを極力避けられます。カーネルパッケージのアップグレードは、<a class="xref" href="ch-upgrading.ja.html#minimal-upgrade" title="4.4.4. システムの最小アップグレード">「システムの最小アップグレード」</a>で説明した最小アップグレードの手順の後以外では行うべきでないことに注意してください。
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="initramfs-tools-issues"></a>4.6.2. ルート (/) および <code class="filename">/usr</code> ファイルシステムのマウントとチェックに関する変更</h3></div></div></div><p>
    <code class="systemitem">initramfs-tools</code><a id="idp65462720" class="indexterm"></a> は
ルートファイルシステムをマウントする間に <code class="literal">fsck</code> を実行するようになりました。init プログラムとして
<code class="literal">systemd</code> が選択されていて分割された <code class="filename">/usr</code>
ファイルシステムがある場合、<code class="filename">/usr</code> に対しても fsck を実行してからマウントします。
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	<code class="filename">/usr</code> がファイルシステムとして分割されている RAID デバイス上にあり、かつ
<code class="filename">/etc/default/mdadm</code> での <code class="literal">INITRDSTART</code>
設定が 'all' ではない場合、RAID デバイスに含めるように変更する必要があります。
      </p></li><li class="listitem"><p>
	<code class="filename">/usr</code> がファイルシステムとして分割されている LVM 論理ボリューム上にあり、かつ
<code class="filename">/etc/fstab</code> 内で <code class="filename">/usr</code> 行がデバイスを
<code class="literal">UUID</code> あるいは <code class="literal">LABEL</code>
で指定している場合、<code class="filename">/dev/mapper/<em class="replaceable"><code>VG</code></em>-<em class="replaceable"><code>LV</code></em></code>
または
<code class="filename">/dev/<em class="replaceable"><code>VG</code></em>/<em class="replaceable"><code>LV</code></em></code>
形式を使ってデバイスを指定するようにこの行を変更する必要があります。
      </p></li><li class="listitem"><p>
	<code class="filename">/usr</code> ファイルシステムを bind-mount することはできなくなりました。
      </p></li><li class="listitem"><p>
	RTC (real time clock) がローカル時間に設定されていて、ローカル時間が UTC
より進んでいる場合、<code class="literal">e2fsck</code> は起動時に時間を巻き戻すことに関する警告を表示します (<a class="ulink" href="https://bugs.debian.org/767040" target="_top">bug #767040</a>参照)。以下の行を
<code class="filename">/etc/e2fsck.conf</code> に追加すれば、この警告を無効にできます:
      </p><pre class="screen">
[options]
broken_system_clock=1
</pre></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="nownownow"></a>4.7. 再起動の前にすべきこと</h2></div></div></div><p>
<code class="literal">apt-get dist-upgrade</code>
が終了したら、<span class="quote">「<span class="quote">形式的には</span>」</span>アップグレードは完了したことになります。しかし、次に再起動する<span class="emphasis"><em>前に</em></span>面倒を見てやらなければならないことがいくつかあります。
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
      Wheezy から Jessie
へアップグレードする際、初回起動時の<span class="emphasis"><em>前に</em></span>古いパッケージを完全に削除するのは良い考えです。特に、時代遅れ
(obusolete) な init
スクリプトが問題を起こす可能性があります。削除したパッケージを見つけて、完全な削除を実行することについての詳細は、<a class="xref" href="ch-upgrading.ja.html#purge-removed-packages" title="4.8.1. 削除したパッケージを完全削除する">「削除したパッケージを完全削除する」</a> を参照してください。
    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="for-next"></a>4.8. 次期リリースへの準備</h2></div></div></div><p>
アップグレードの後で、次期リリースに向けてできるいくつかの準備があります。
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
<a class="xref" href="ch-upgrading.ja.html#sufficient-space" title="4.4.3. アップグレードするのに十分な領域があることを確認する">「アップグレードするのに十分な領域があることを確認する」</a> や <a class="xref" href="ch-upgrading.ja.html#obsolete" title="4.10. 利用されなくなったパッケージ">「利用されなくなったパッケージ」</a>
で説明するように、余分、あるいは時代遅れ (obsolete)
のパッケージを削除してください。それらのパッケージが使用する設定ファイルを確認し、パッケージの完全削除 (purge)
によって、設定ファイルも含めて削除することを検討してください。<a class="xref" href="ch-upgrading.ja.html#purge-removed-packages" title="4.8.1. 削除したパッケージを完全削除する">「削除したパッケージを完全削除する」</a>
についても参照をお願いします。
</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="purge-removed-packages"></a>4.8.1. 削除したパッケージを完全削除する</h3></div></div></div><p>
    一般的に、削除したパッケージを完全に削除 (purge) するのは賢明なことです。以前のリリースアップグレード (つまりは
wheezy へのアップグレード)
の際に削除されているパッケージである、あるいはパッケージがサードパーティベンダーから提供されたものである場合、尚のこととなります。特に、古い
init.d スクリプトは問題を起こすことが知られています。
  </p><div class="caution"><table border="0" summary="Caution"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[注意]" src="images/caution.png" /></td><th align="left">注意</th></tr><tr><td align="left" valign="top"><p>
      パッケージの完全削除 (purge) は通常ログファイルについても完全に削除を行うので、まずはこのバックアップを行ったほうが良いでしょう。
    </p></td></tr></table></div><p>
    以下のコマンドは、設定ファイルをシステムに残して削除されたパッケージの一覧を (もしあれば) 表示します:
  </p><pre class="screen">
# dpkg -l | awk '/^rc/ { print $2 }'
</pre><p>
    <span class="command"><strong>apt-get purge</strong></span>
を実行すればパッケージを削除できます。一度でこれらのパッケージを削除したい場合は、以下のコマンドで実施できます:
  </p><pre class="screen">
# apt-get purge $(dpkg -l | awk '/^rc/ { print $2 }')
</pre><p>
    <code class="systemitem">aptitude</code><a id="idp65503248" class="indexterm"></a>　を利用している場合、上記のコマンドの代わりに以下を使うこともできます:
  </p><pre class="screen">
$ aptitude search '~c'
$ aptitude purge '~c'
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="deprecated"></a>4.9. 廃止予定のコンポーネント</h2></div></div></div><p>
Debian の次期リリース 9 (コードネーム stretch)
では、いくつかの機能が廃止されます。システムを 9 へと更新する際の手間を省くため、ユーザは他の代替へ移行する必要があります。
</p><p>
以下の機能が廃止予定となっています:
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="systemitem">hardening-wrapper</code><a id="idp65509200" class="indexterm"></a>
パッケージは非推奨となっており、Stretch で削除される予定です。
		</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="obsolete"></a>4.10. 利用されなくなったパッケージ</h2></div></div></div><p>
jessie では大量の新規パッケージが導入された一方で、wheezy
に存在していた極めて古いパッケージの破棄や削除が行われています。これら時代遅れのパッケージをアップグレードする手段は提供されていません。時代遅れのパッケージを使い続けても構いませんが、Debian
プロジェクトでは通常、jessie がリリースされてから 1 年後にセキュリティサポートを終了します <a href="#ftn.idp65512624" class="footnote" id="idp65512624"><sup class="footnote">[5]</sup></a>。そして、その時点から他のサポートも提供しません。利用可能な代替手段で置き換えれるのであれば、そうすることをお勧めします。
</p><p>
パッケージがディストリビューションから削除された理由は、数多くあります――もう上流で保守されていない、そのパッケージの保守作業に興味を抱く Debian
開発者がもういない、提供していた機能が別のソフトウェア (または新しいバージョン) に取って代わられた、バグのために jessie
にはもう適さないと見なされた、などです。最後の場合では、当該パッケージが <span class="quote">「<span class="quote">不安定版</span>」</span>
ディストリビューション内にはまだ存在していることがあります。
</p><p>
更新が完了したシステム内のどのパッケージが <span class="quote">「<span class="quote">時代遅れ</span>」</span>
なのかを検出するのは、パッケージ管理用フロントエンドが当該パッケージにその旨のマークをつけてくれるので簡単です。<span class="command"><strong>aptitude</strong></span>
を使っているのなら、当該パッケージが <span class="quote">「<span class="quote">廃止された、またはローカルで作成されたパッケージ</span>」</span>
欄に列記されているのに気づくでしょう。
</p><p>
<a class="ulink" href="https://bugs.debian.org/" target="_top">Debian
バグ追跡システム</a>は、パッケージが削除された理由についての追加情報を提供してくれることがよくあります。そのパッケージ自体と <a class="ulink" href="https://bugs.debian.org/cgi-bin/pkgreport.cgi?pkg=ftp.debian.org&amp;archive=yes" target="_top">ftp.debian.org
擬似パッケージ</a>の両方の、アーカイブ化されたバグ報告を調べてください。
</p><p>
  利用されなくなったパッケージの一覧:
  </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
	<code class="systemitem">postgresql-9.1</code><a id="idp65522528" class="indexterm"></a>: 後継となるパッケージは
<code class="systemitem">postgresql-9.4</code><a id="idp65524288" class="indexterm"></a> です。一旦 OS
のアップグレードが完了したら、<span class="command"><strong>pg_upgradecluster</strong></span> ツールを使って PostgreSQL 9.1
クラスターを新しい PostgreSQL バージョン 9.4 にアップグレードするのについても検討する必要があるでしょう。PL/perl
手続き言語のユーザーに対しては、jessie での新しい perl バージョンにアップグレードするのを可能にするため、jessie では jessie
に存在するバージョンの libperl にリンクされた <code class="systemitem">postgresql-plperl-9.1</code><a id="idp65527408" class="indexterm"></a>
パッケージを提供する一方で、データベースが同様にアップグレードされるまで以前の PL/perl データベース関数を使えるようにしています。
      </p></li><li class="listitem"><p>
        
        
<code class="systemitem">python3.2</code><a id="idp65530304" class="indexterm"></a>: 後継となるパッケージは <code class="systemitem">python3.4</code><a id="idp65532064" class="indexterm"></a> です (Version 2.7　は wheezy および
jessie　の双方でサポートされています)。
      </p></li><li class="listitem"><p>
        <code class="systemitem">ruby1.8</code><a id="idp65534720" class="indexterm"></a> および <code class="systemitem">ruby1.9.1</code><a id="idp65536416" class="indexterm"></a>: 後継となるパッケージは <code class="systemitem">ruby2.1</code><a id="idp65538176" class="indexterm"></a> です。 現在の ruby バージョンを追いかけるため、<code class="systemitem">ruby</code><a id="idp65540000" class="indexterm"></a> パッケージをインストールしてください。
      </p></li><li class="listitem"><p>
        <code class="systemitem">mplayer</code><a id="idp65542576" class="indexterm"></a>: 代替は <code class="systemitem">mplayer2</code><a id="idp65544288" class="indexterm"></a> および <code class="systemitem">mpv</code><a id="idp65545952" class="indexterm"></a> (jessie で新規に追加)。前者のパッケージは mplayer
とはコマンドライン引数についてや設定についてほぼ互換 (に加えて新規機能も追加)
となっているのに対し、後者については大量の新機能と改善が行われており、開発元 (upstream) によって活発にメンテナンスされています。
      </p></li><li class="listitem"><p>
        <code class="systemitem">openoffice.org</code><a id="idp65548992" class="indexterm"></a>: <code class="systemitem">libreoffice</code><a id="idp65550656" class="indexterm"></a> を利用してください。
      </p></li><li class="listitem"><p>
        <code class="systemitem">squid</code><a id="idp65553184" class="indexterm"></a>: 後継となるパッケージは <code class="systemitem">squid3</code><a id="idp65554944" class="indexterm"></a> です。
      </p></li><li class="listitem"><p>
        <code class="systemitem">libjpeg-progs</code><a id="idp65557424" class="indexterm"></a>: 後継となるパッケージは
<code class="systemitem">libjpeg-turbo-progs</code><a id="idp65559184" class="indexterm"></a> です。
      </p></li><li class="listitem"><p>
        <code class="systemitem">openjdk-6-*</code><a id="idp65561664" class="indexterm"></a>: 後継となるパッケージは <code class="systemitem">openjdk-7-*</code><a id="idp65563424" class="indexterm"></a> です。
      </p></li></ul></div><p>
</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="dummy"></a>4.10.1. ダミーパッケージ</h3></div></div></div><p>
wheezy の一部のパッケージは jessie
では複数のパッケージに分割されていますが、これは大半がシステムの保守性を改善するためです。このような場合のアップグレード手順を容易にするために、jessie
はしばしば <span class="quote">「<span class="quote">ダミーの</span>」</span> パッケージ―― wheezy
での古いパッケージと同じ名前で、新規パッケージが自動的にインストールされるような依存関係を備えた空のパッケージ――を提供しています。これらの
<span class="quote">「<span class="quote">ダミー</span>」</span> パッケージはアップグレード後は余計なパッケージ扱いとされ、安全に削除することができます。
</p><p>
(すべてではないのですが)
大半のダミーパッケージの説明には、その目的が記されています。しかしダミーパッケージの説明文は統一されていないので、自分のシステム内のダミーパッケージを検出するには、<span class="command"><strong>deborphan</strong></span>
を <code class="literal">--guess<em class="replaceable"><code>*</code></em></code> オプションつきで使うのが便利でしょう
(例:
<code class="literal">--guess-dummy</code>)。一部のダミーパッケージは、アップグレード後に削除されることを意図したものではなく、プログラムのどのバージョンが現在利用可能な最新版かを長期にわたって追跡するのに使われる、ということに注意してください。
</p></div></div><div class="footnotes"><br /><hr width="100" align="left" /><div id="ftn.idp65062224" class="footnote"><p><a href="#idp65062224" class="para"><sup class="para">[1] </sup></a>debconf
の優先度を、とても高いレベルに設定していると設定プロンプトを抑制できますが、デフォルト値があなたのシステムに合わない場合、サービスはそのままでは起動に失敗することでしょう。</p></div><div id="ftn.idp65063984" class="footnote"><p><a href="#idp65063984" class="para"><sup class="para">[2] </sup></a>例: DNS や DHCP サービス、特に冗長性やフェイルオーバー機能が無い場合。DHCP
の例では、リースタイムがアップグレード作業が完了する時間よりも短い場合、エンドユーザはネットワークから切り離されるでしょう。</p></div><div id="ftn.idp65079728" class="footnote"><p><a href="#idp65079728" class="para"><sup class="para">[3] </sup></a> この機能は、ブートパラメータに <code class="literal">panic=0</code> を付加することで無効にできます。  </p></div><div id="ftn.idp65169664" class="footnote"><p><a href="#idp65169664" class="para"><sup class="para">[4] </sup></a> Debian
のパッケージ管理システムにおいて、別のパッケージを置き換えるように指定されていないパッケージは、通常、別のパッケージの所有ファイルを削除したり置き換えたりすることはできません。  </p></div><div id="ftn.idp65512624" class="footnote"><p><a href="#idp65512624" class="para"><sup class="para">[5] </sup></a> あるいは、1 年以内でも別のリリースが出るときに。一般に、どの時点でも、サポートされる安定版リリースは 2 つだけです。  </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch-installing.ja.html"><img src="images/prev.png" alt="戻る" /></a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch-information.ja.html"><img src="images/next.png" alt="次へ" /></a></td></tr><tr><td width="40%" align="left" valign="top">第3章 インストールシステム </td><td width="20%" align="center"><a accesskey="h" href="index.ja.html"><img src="images/home.png" alt="ホーム" /></a></td><td width="40%" align="right" valign="top"> 第5章 jessie で知っておくべき問題点</td></tr></table></div></body></html>